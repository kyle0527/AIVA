# AIVA 模型權重管理與載入指南

## 📑 目錄

- [📋 指南概述](#-指南概述)
- [🧠 核心概念：程式碼與資料分離](#-核心概念程式碼與資料分離)
  - [程式碼定義與特性](#程式碼定義與特性)
  - [權重檔案定義與特性](#權重檔案定義與特性)
  - [分離的重要性](#分離的重要性)
- [📁 目錄結構與管理策略](#-目錄結構與管理策略)
- [🔧 模型載入機制](#-模型載入機制)
- [⚡ 性能優化建議](#-性能優化建議)
- [🛠️ 最佳實踐](#-最佳實踐)
- [📊 檔案大小管理](#-檔案大小管理)

---

## 📋 指南概述

本指南旨在說明 AIVA 專案中 AI 模型權重檔案的管理策略，以及核心程式碼如何與這些權重檔案互動。

## 🧠 核心概念：程式碼與資料分離 (Code vs. Data)

在 AI 專案中，我們嚴格區分「程式碼」和「資料」，這是一個關鍵的最佳實踐。

*   **核心程式碼 (Core Code)**:
    *   **定義**: 這些是定義模型結構、訓練邏輯和推論流程的原始碼檔案（通常是 `.py` 檔案）。
    *   **位置**: 存放於 `src/` 或類似的原始碼目錄。
    *   **比喻**: 程式碼是 AI 的「**大腦骨架**」或「**藍圖**」，它定義了思考的方式，但本身沒有知識。

*   **權重檔案 (Weight Files)**:
    *   **定義**: 這些是模型經過大量資料訓練後產生的二進位檔案（例如 `.pth`, `.pkl`）。它們包含了神經網路中所有神經元的具體參數值。
    *   **位置**: 存放於 `models/weights/` 目錄。
    *   **比喻**: 權重是 AI 的「**記憶**」或「**知識**」，是後天學習到的結果。

### 為什麼要分離？

1.  **版本控制效率**:
    *   Git 等版本控制系統擅長處理文字檔案（程式碼），但對於大型二進位檔案（權重）的處理效能不佳，會導致儲存庫臃腫、操作緩慢。
    *   透過分離，程式碼可以由 Git 高效管理，而權重檔案可以使用 **Git LFS (Large File Storage)** 或從雲端儲存（如 Azure Blob, AWS S3）下載。

2.  **模組化與彈性**:
    *   模型架構（程式碼）可能保持不變，但我們可以針對不同任務或使用不同資料集訓練出多個版本的權重。
    *   將權重分離存放，使得更換、更新或測試不同版本的模型變得非常簡單，只需修改載入路徑，無需更動任何核心程式碼。

3.  **清晰的專案結構**:
    *   一個清晰的目錄結構讓團隊成員更容易理解專案的組成，知道在哪裡可以找到程式碼、資料、設定檔和產出的模型。

## 權重載入流程

核心腳本在執行時，會動態地將權重載入到模型架構中。這個過程通常包含以下三個步驟：

### 步驟一：定義模型架構 (Define Architecture)

在核心程式碼中，首先會用程式碼（例如 PyTorch）建立一個空的模型結構。此刻，它只是一個定義了網路層次和計算流程的「空殼」。

```python
# 範例：定義一個簡單的神經網路
import torch.nn as nn

class SimpleModel(nn.Module):
    def __init__(self):
        super(SimpleModel, self).__init__()
        self.layer1 = nn.Linear(784, 128)
        self.layer2 = nn.Linear(128, 10)

    def forward(self, x):
        x = torch.relu(self.layer1(x))
        return self.layer2(x)

# 此時，模型尚未載入任何訓練好的權重
model = SimpleModel()
```

### 步驟二：指定權重路徑 (Specify Weight Path)

程式碼需要知道從哪裡讀取權重檔案。這個路徑通常是透過設定檔來管理，以增加靈活性。

```python
# 範例：從設定檔或變數中獲取路徑
# 在真實專案中，這個路徑會從 config 檔案讀取
WEIGHTS_PATH = "models/weights/aiva_real_ai_core.pth"
```

### 步驟三：載入權重 (Load Weights)

最後，使用框架提供的函式（如 `torch.load()`）讀取權重檔案，並將其載入到先前建立的模型實例中。

```python
import torch

# 載入權重檔案
state_dict = torch.load(WEIGHTS_PATH)

# 將權重應用到模型上
model.load_state_dict(state_dict)

# 設定為評估模式，準備進行推論
model.eval()
```

完成以上步驟後，`model` 物件就從一個「空殼」變成了擁有預測能力的「完整 AI」，可以開始接收輸入並產生輸出了。
