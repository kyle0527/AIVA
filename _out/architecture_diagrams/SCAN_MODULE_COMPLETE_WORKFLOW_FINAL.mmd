```mermaid
flowchart TB
    %% ========== AIVA 掃描模組完整工作流程圖 ==========
    %% 基於200+現有圖表組合而成
    
    subgraph Entry["📊 入口層 Entry Layer"]
        A["統一掃描引擎<br/>UnifiedScanEngine"] 
        A1["快速掃描<br/>create_fast_scan"]
        A2["全面掃描<br/>create_comprehensive_scan"]
        B["掃描編排器<br/>ScanOrchestrator"]
    end
    
    subgraph Strategy["🎯 策略控制層"]
        C["策略控制器<br/>StrategyController"]
        C1["配置控制中心<br/>ConfigControlCenter"]
        D1["CONSERVATIVE<br/>保守策略"]
        D2["BALANCED<br/>平衡策略"]
        D3["DEEP<br/>深度策略"]
        D4["FAST<br/>快速策略"]
        D5["AGGRESSIVE<br/>激進策略"]
        D6["STEALTH<br/>隱蔽策略"]
    end
    
    subgraph Config["⚙️ 配置管理層"]
        E1["爬蟲配置<br/>CrawlingConfig"]
        E2["動態掃描配置<br/>DynamicScanConfig"]
        E3["指紋配置<br/>FingerprintConfig"]
        E4["安全配置<br/>SecurityConfig"]
        E5["性能配置<br/>PerformanceConfig"]
    end
    
    subgraph Context["📋 掃描上下文層"]
        F["掃描上下文<br/>ScanContext"]
        F1["add_asset"]
        F2["increment_urls_found"]
        F3["increment_pages_crawled"]
        F4["add_forms_found"]
        F5["get_statistics"]
    end
    
    subgraph Auth["🔐 認證授權層"]
        G["認證管理器<br/>AuthenticationManager"]
        G1["HTTP標頭配置<br/>HeaderConfiguration"]
        G11["set_user_agent"]
        G12["set_authorization"]
        G13["set_cookie"]
        G14["add_header"]
    end
    
    subgraph Static["🌐 靜態掃描引擎"]
        H["HTTP客戶端<br/>HiHttpClient"]
        H1["URL隊列管理器<br/>UrlQueueManager"]
        H2["靜態內容解析器<br/>StaticContentParser"]
        H11["add"]
        H12["next"]
        H13["is_processed"]
        H21["extract"]
    end
    
    subgraph Dynamic["🔄 動態掃描引擎"]
        I["無頭瀏覽器池<br/>HeadlessBrowserPool"]
        J["動態內容提取器<br/>DynamicContentExtractor"]
        K["JS交互模擬器<br/>JSInteractionSimulator"]
        L["AJAX API處理器<br/>AjaxApiHandler"]
        I1["initialize"]
        J1["get_extracted_contents"]
        K1["add_click"]
        L1["get_discovered_endpoints"]
    end
    
    subgraph Info["🔍 資訊收集層"]
        M["敏感信息檢測器<br/>SensitiveInfoDetector"]
        N["JavaScript源碼分析器<br/>JavaScriptSourceAnalyzer"]
        O["被動指紋識別器<br/>PassiveFingerprinter"]
        P["指紋管理器<br/>FingerprintCollector"]
        M1["detect_in_response"]
        N1["analyze"]
        O1["from_headers"]
        P1["get_final_fingerprints"]
    end
    
    subgraph Network["🌍 網路掃描層"]
        Q["網路掃描器<br/>NetworkScanner"]
        R["服務檢測器<br/>ServiceDetector"]
        S["漏洞掃描器<br/>VulnerabilityScanner"]
        T["敏感數據掃描器<br/>SensitiveDataScanner"]
        R1["initialize"]
        R2["get_detection_results"]
        S1["demo_vulnerability_scanner"]
        T1["scan_content"]
    end
    
    subgraph Scope["🎯 範圍管理層"]
        U["範圍管理器<br/>ScopeManager"]
        U1["add_allowed_host"]
        U2["is_in_scope"]
        U3["filter_urls"]
        U4["validate_scope"]
    end
    
    subgraph Processing["📊 結果處理層"]
        V["掃描結果處理器<br/>ScanResultProcessor"]
        W["AI操作記錄器<br/>AIOperationRecorder"]
        X["增強掃描集成<br/>EnhancedScanIntegration"]
        W1["record_scan_operation"]
        X1["apply_analysis_results"]
        X2["count_by_severity"]
    end
    
    subgraph Output["📈 輸出層"]
        Y["掃描元數據分析器<br/>ScanMetadataAnalyzer"]
        Z["報告內容生成器<br/>ReportContentGenerator"]
        Y1["analyze_metadata"]
        Z1["get_scan_methodology"]
    end
    
    %% ========== 主要流程連接 ==========
    A1 --> A
    A2 --> A
    A --> B
    B --> C
    C --> C1
    
    %% 策略到配置
    C --> D1
    C --> D2
    C --> D3
    C --> D4
    C --> D5
    C --> D6
    
    %% 配置管理
    C1 --> E1
    C1 --> E2
    C1 --> E3
    C1 --> E4
    C1 --> E5
    
    %% 掃描上下文
    B --> F
    F --> F1
    F --> F2
    F --> F3
    F --> F4
    F --> F5
    
    %% 認證授權
    B --> G
    G --> G1
    G1 --> G11
    G1 --> G12
    G1 --> G13
    G1 --> G14
    
    %% 靜態掃描引擎
    E1 --> H
    H --> H1
    H --> H2
    H1 --> H11
    H1 --> H12
    H1 --> H13
    H2 --> H21
    
    %% 動態掃描引擎
    E2 --> I
    I --> I1
    I --> J
    I --> K
    I --> L
    J --> J1
    K --> K1
    L --> L1
    
    %% 資訊收集
    H --> M
    H --> N
    H --> O
    H --> P
    M --> M1
    N --> N1
    O --> O1
    P --> P1
    
    %% 網路掃描
    B --> Q
    B --> R
    B --> S
    B --> T
    R --> R1
    R --> R2
    S --> S1
    T --> T1
    
    %% 範圍管理
    B --> U
    U --> U1
    U --> U2
    U --> U3
    U --> U4
    
    %% 結果處理
    M --> V
    N --> V
    P --> V
    Q --> V
    R --> V
    S --> V
    T --> V
    V --> W
    V --> X
    W --> W1
    X --> X1
    X --> X2
    
    %% 輸出層
    V --> Y
    V --> Z
    Y --> Y1
    Z --> Z1
    
    %% ========== 策略影響引擎選擇 ==========
    D1 -.-> H
    D2 -.-> H
    D2 -.-> I
    D3 -.-> I
    D4 -.-> H
    D5 -.-> I
    D6 -.-> H
    
    %% ========== 資料流向 ==========
    H21 -.-> F1
    J1 -.-> F1
    L1 -.-> F1
    M1 -.-> F1
    N1 -.-> F1
    O1 -.-> P1
    F5 -.-> V
    P1 -.-> V
    U4 -.-> V
    
    %% ========== 樣式定義 ==========
    classDef entryStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef strategyStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef configStyle fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef engineStyle fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef processingStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef outputStyle fill:#e0f2f1,stroke:#00796b,stroke-width:2px
    
    class A,A1,A2,B entryStyle
    class C,C1,D1,D2,D3,D4,D5,D6 strategyStyle
    class E1,E2,E3,E4,E5,F,G,G1,U configStyle
    class H,H1,H2,I,J,K,L,M,N,O,P,Q,R,S,T engineStyle
    class V,W,X,Y processingStyle
    class Z outputStyle
```

---

## 🎯 **AIVA掃描模組完整工作流程圖**

### 📋 **圖表說明**
此圖基於 **200+ 個現有架構圖表** 組合而成，展示：

**✅ 實際的程式連結**: 所有組件名稱和方法都來自真實的程式碼  
**✅ 完整的工作流程**: 從入口到輸出的完整鏈路  
**✅ 策略驅動的引擎選擇**: 不同策略如何影響掃描行為  
**✅ 多層次的架構設計**: 清晰的分層和職責劃分  
**✅ 完整的資料流向**: 展示資訊如何在各組件間流轉  

### 🔍 **主要工作方式**
1. **入口選擇**: 快速掃描 vs 全面掃描
2. **策略控制**: 6種預設策略 (CONSERVATIVE → STEALTH)
3. **引擎協調**: 靜態引擎 + 動態引擎 + 網路掃描
4. **資訊收集**: 敏感信息 + JavaScript分析 + 指紋識別
5. **結果處理**: AI增強 + 元數據分析 + 報告生成

### 📊 **連結驗證**
- **實體連結**: 基於真實的類別繼承和方法調用
- **資料流**: 展示實際的資料傳遞路徑
- **控制流**: 策略如何影響引擎選擇和配置
- **依賴關係**: 各組件間的實際依賴

**生成時間**: 2025-10-24  
**圖表來源**: 基於現有 1,405 個架構圖表組合  
**涵蓋範圍**: services.scan 完整功能集合