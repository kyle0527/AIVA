# ğŸ“Š Mermaid 11.11.0+ æ›´æ–°å ±å‘Š

**æ›´æ–°æ—¥æœŸ**: 2025-10-17  
**æ›´æ–°è€…**: AIVA Development Team  
**åƒè€ƒ**: Mermaid.js 11.11.0 å®˜æ–¹æ–‡æª”

---

## ğŸ“‹ æ›´æ–°æ‘˜è¦

æˆåŠŸå°‡ AIVA å°ˆæ¡ˆä¸­çš„æ‰€æœ‰ Mermaid åœ–è¡¨ç”Ÿæˆè…³æœ¬æ›´æ–°è‡³ **Mermaid 11.11.0+** æ¨™æº–èªæ³•ã€‚

### âœ… å·²å®Œæˆçš„æ›´æ–°

| è…³æœ¬ | æ›´æ–°å…§å®¹ | ç‹€æ…‹ |
|------|----------|------|
| `py2mermaid.py` | ä½¿ç”¨ `flowchart` æ›¿ä»£ `graph`ï¼Œæ›´æ–°ç¯€é»å½¢ç‹€èªæ³• | âœ… å®Œæˆ |
| `mermaid_optimizer.py` | åŠ å…¥ v11.3.0+ æ–°å½¢ç‹€èªæ³•ï¼Œæ”¯æ´ icon/image | âœ… å®Œæˆ |
| `generate_mermaid_diagrams.py` | ä¿®æ­£ emoji èªæ³•ï¼Œæ›´æ–°æ‰€æœ‰åœ–è¡¨é…ç½® | âœ… å®Œæˆ |
| `test_mermaid_v11.py` | å‰µå»ºå®Œæ•´æ¸¬è©¦å¥—ä»¶ | âœ… å®Œæˆ |

### ğŸ“Š æ¸¬è©¦çµæœ

```
ç¸½è¨ˆ: 7/7 æ¸¬è©¦é€šé (100.0%)
âœ“ åŸºæœ¬æµç¨‹åœ–
âœ“ æ–°ç¯€é»å½¢ç‹€
âœ“ æ™‚åºåœ–
âœ“ é…ç½®é ­éƒ¨
âœ“ Emoji æ”¯æ´
âœ“ æ¨£å¼å’Œé¡åˆ¥
âœ“ ä¿å­˜æ¸¬è©¦åœ–è¡¨
```

---

## ğŸ”§ ä¸»è¦æ›´æ–°å…§å®¹

### 1. **ä½¿ç”¨ `flowchart` æ›¿ä»£ `graph`**

**åŸèªæ³• (å·²æ£„ç”¨):**
```mermaid
graph TB
    A[ç¯€é»] --> B[ç¯€é»]
```

**æ–°èªæ³• (æ¨è–¦):**
```mermaid
flowchart TB
    A["ç¯€é»"] --> B["ç¯€é»"]
```

**åŸå› **: Mermaid å®˜æ–¹æ–‡æª”æ¨è–¦ä½¿ç”¨ `flowchart`ï¼Œ`graph` èªæ³•å·²è¢«æ¨™è¨˜ç‚ºéæ™‚ã€‚

---

### 2. **ç¯€é»æ¨™ç±¤ä½¿ç”¨å¼•è™Ÿ**

**åŸèªæ³•:**
```mermaid
A[ç¯€é»æ–‡å­—]
```

**æ–°èªæ³•:**
```mermaid
A["ç¯€é»æ–‡å­—"]
```

**å„ªé»**: 
- æ›´å¥½åœ°æ”¯æ´ç‰¹æ®Šå­—å…ƒ
- é¿å…æ‹¬è™Ÿè¡çª
- æå‡æ¸²æŸ“ç©©å®šæ€§

---

### 3. **é€£ç·šæ¨™ç±¤ä½¿ç”¨å¼•è™Ÿ**

**åŸèªæ³•:**
```mermaid
A -->|æ¨™ç±¤| B
```

**æ–°èªæ³•:**
```mermaid
A -->|"æ¨™ç±¤"| B
```

**å„ªé»**: ç¢ºä¿ä¸­æ–‡å’Œç‰¹æ®Šå­—å…ƒæ­£ç¢ºæ¸²æŸ“

---

### 4. **Emoji èªæ³•ä¿®æ­£**

**åŸèªæ³• (éŒ¯èª¤):**
```mermaid
subgraph "[U+1F40D] Python Layer"
```

**æ–°èªæ³• (æ­£ç¢º):**
```mermaid
subgraph "ğŸ Python Layer"
```

**å„ªé»**: ç›´æ¥ä½¿ç”¨ Unicode emojiï¼Œä¸éœ€è¦è½‰ç¾©

---

### 5. **é…ç½®åˆå§‹åŒ–**

**æ–°å¢é…ç½®é ­éƒ¨:**
```mermaid
%%{init: {'theme':'default', 'themeVariables': {'fontSize':'14px'}}}%%
flowchart TB
```

**æ”¯æ´çš„é…ç½®é …:**
- `theme`: default, forest, dark, neutral, base
- `look`: classic, handDrawn
- `flowchart.htmlLabels`: true/false
- `flowchart.curve`: basis, linear, cardinal, catmullRom, etc.
- `flowchart.useMaxWidth`: true/false

---

### 6. **æ–°ç¯€é»å½¢ç‹€èªæ³• (Mermaid 11.3.0+)**

**å‚³çµ±èªæ³•:**
```mermaid
A[çŸ©å½¢]
B((åœ“å½¢))
C{è±å½¢}
```

**æ–°èªæ³• (@{} æ ¼å¼):**
```mermaid
A@{ shape: rect, label: "çŸ©å½¢" }
B@{ shape: circle, label: "åœ“å½¢" }
C@{ shape: diamond, label: "è±å½¢" }
```

**æ”¯æ´çš„å½¢ç‹€:**
- `rect`: çŸ©å½¢
- `rounded`: åœ“è§’çŸ©å½¢
- `stadium`: é«”è‚²å ´å½¢
- `circle`: åœ“å½¢
- `diamond`: è±å½¢
- `hexagon`: å…­è§’å½¢
- `cylinder`: åœ“æŸ±å½¢ (è³‡æ–™åº«)
- `trap-t`: æ¢¯å½¢
- ä»¥åŠ 30+ ç¨®å…¶ä»–å½¢ç‹€

---

### 7. **åœ–æ¨™å’Œåœ–ç‰‡æ”¯æ´**

**åœ–æ¨™ç¯€é»:**
```mermaid
A@{ icon: "fa:user", label: "ä½¿ç”¨è€…", form: "square", h: 60 }
```

**åœ–ç‰‡ç¯€é»:**
```mermaid
B@{ img: "https://example.com/image.png", label: "åœ–ç‰‡", h: 60, w: 60 }
```

---

### 8. **å¢å¼·çš„æ¨£å¼èªæ³•**

**åŸèªæ³•:**
```mermaid
style A fill:#3776ab
```

**æ–°èªæ³• (æ›´å®Œæ•´):**
```mermaid
style A fill:#3776ab,stroke:#2C5F8D,stroke-width:2px,color:#fff
```

**æ–°å¢å±¬æ€§:**
- `stroke`: é‚Šæ¡†é¡è‰²
- `stroke-width`: é‚Šæ¡†å¯¬åº¦
- `color`: æ–‡å­—é¡è‰²

---

## ğŸ“ ç”Ÿæˆçš„æª”æ¡ˆ

### æ¸¬è©¦æª”æ¡ˆ
- `c:\F\AIVA\_out\mermaid_v11_tests\mermaid_v11_syntax_test.md`
  - åŒ…å«æ‰€æœ‰æ–°èªæ³•çš„æ¸¬è©¦ç¯„ä¾‹
  - 7 å€‹å®Œæ•´çš„æ¸¬è©¦æ¡ˆä¾‹
  - å¯ç›´æ¥åœ¨ VS Code ä¸­é è¦½

### æ¶æ§‹åœ–
- `c:\F\AIVA\_out\ARCHITECTURE_DIAGRAMS.md`
  - æ›´æ–°æ‰€æœ‰ 7 å€‹ç³»çµ±æ¶æ§‹åœ–
  - ä½¿ç”¨æœ€æ–° Mermaid 11.11.0+ èªæ³•
  - åŒ…å« emoji å’Œå®Œæ•´æ¨£å¼

---

## ğŸ¯ èªæ³•é©—è­‰

æ‰€æœ‰ç”Ÿæˆçš„åœ–è¡¨å·²é€šéä»¥ä¸‹é©—è­‰ï¼š

1. **Mermaid èªæ³•é©—è­‰å™¨**: âœ… é€šé
2. **æ‹¬è™ŸåŒ¹é…æª¢æŸ¥**: âœ… é€šé
3. **åœ–è¡¨é¡å‹è²æ˜**: âœ… é€šé
4. **Emoji æ¸²æŸ“**: âœ… é€šé
5. **æ¨£å¼æ‡‰ç”¨**: âœ… é€šé

---

## ğŸ”„ å‘å¾Œå…¼å®¹æ€§

### ä¿ç•™çš„åŠŸèƒ½
- âœ… å‚³çµ±ç¯€é»å½¢ç‹€èªæ³•ä»ç„¶æ”¯æ´
- âœ… èˆŠçš„é€£ç·šèªæ³•å¯ä»¥æ­£å¸¸å·¥ä½œ
- âœ… ç¾æœ‰åœ–è¡¨ç„¡éœ€ç«‹å³æ›´æ–°

### å»ºè­°æ›´æ–°
- ğŸ”„ æ–°åœ–è¡¨ä½¿ç”¨ `flowchart` è€Œé `graph`
- ğŸ”„ ç¯€é»æ¨™ç±¤ä½¿ç”¨å¼•è™Ÿ
- ğŸ”„ é€£ç·šæ¨™ç±¤ä½¿ç”¨å¼•è™Ÿ
- ğŸ”„ ç›´æ¥ä½¿ç”¨ emoji è€Œé Unicode ä»£ç¢¼

---

## ğŸ“š åƒè€ƒè³‡æº

### å®˜æ–¹æ–‡æª”
- [Flowcharts èªæ³•](https://mermaid.js.org/syntax/flowchart.html)
- [Sequence Diagrams](https://mermaid.js.org/syntax/sequenceDiagram.html)
- [é…ç½®é¸é …](https://mermaid.js.org/config/setup/modules/mermaidAPI.html)

### å·¥å…·ä½¿ç”¨

#### æ¸¬è©¦è…³æœ¬
```bash
python tools/test_mermaid_v11.py
```

#### ç”Ÿæˆåœ–è¡¨
```bash
python tools/generate_mermaid_diagrams.py
```

#### Python ä»£ç¢¼è½‰åœ–è¡¨
```bash
python tools/py2mermaid.py --input services/ --output docs/diagrams/
```

---

## ğŸ’¡ æœ€ä½³å¯¦è¸

### 1. ä½¿ç”¨é…ç½®é ­éƒ¨
å§‹çµ‚åœ¨åœ–è¡¨é–‹é ­åŠ å…¥é…ç½®ï¼š
```mermaid
%%{init: {'theme':'default', 'flowchart': {'htmlLabels': false}}}%%
flowchart TB
```

### 2. ç¯€é» ID å‘½å
- ä½¿ç”¨æœ‰æ„ç¾©çš„ ID
- é¿å…ä½¿ç”¨ä¿ç•™å­— (`end`, `class`, etc.)
- ä½¿ç”¨ camelCase æˆ– snake_case

### 3. æ¨£å¼ç®¡ç†
- å®šç¾© `classDef` ä»¥é‡ç”¨æ¨£å¼
- ä½¿ç”¨èªæ„åŒ–çš„é¡å
- ä¿æŒé¡è‰²ä¸€è‡´æ€§

### 4. Emoji ä½¿ç”¨
- ç›´æ¥è²¼ä¸Š emoji å­—ç¬¦
- é¿å…ä½¿ç”¨ HTML å¯¦é«”æˆ– Unicode ä»£ç¢¼
- æ¸¬è©¦è·¨å¹³å°æ¸²æŸ“

### 5. å­åœ–çµ„ç¹”
- ä½¿ç”¨æœ‰æ„ç¾©çš„æ¨™é¡Œ
- åˆç†åˆ†çµ„ç›¸é—œç¯€é»
- é¿å…éåº¦åµŒå¥—

---

## âš ï¸ å¸¸è¦‹å•é¡Œ

### Q1: ç‚ºä»€éº¼ emoji ä¸é¡¯ç¤ºï¼Ÿ
**A**: ç¢ºä¿ä½¿ç”¨ç›´æ¥çš„ emoji å­—ç¬¦ï¼Œè€Œé `[U+xxxx]` æ ¼å¼ã€‚

### Q2: ç¯€é»æ–‡å­—åŒ…å«æ‹¬è™Ÿæ€éº¼è¾¦ï¼Ÿ
**A**: ä½¿ç”¨å¼•è™ŸåŒ…è£¹æ¨™ç±¤: `A["æ–‡å­—(åŒ…å«æ‹¬è™Ÿ)"]`

### Q3: å¦‚ä½•ä½¿ç”¨å¤šè¡Œæ–‡å­—ï¼Ÿ
**A**: ä½¿ç”¨ `<br/>` æ¨™ç±¤:
```mermaid
A["ç¬¬ä¸€è¡Œ<br/>ç¬¬äºŒè¡Œ<br/>ç¬¬ä¸‰è¡Œ"]
```

### Q4: æ¨£å¼ä¸ç”Ÿæ•ˆï¼Ÿ
**A**: æª¢æŸ¥ï¼š
- ç¯€é» ID æ˜¯å¦æ­£ç¢º
- æ¨£å¼èªæ³•æ˜¯å¦å®Œæ•´
- æ˜¯å¦åœ¨åœ–è¡¨æœ«å°¾å®šç¾©

---

## ğŸ‰ ç¸½çµ

âœ… **æ‰€æœ‰æ¸¬è©¦é€šé**  
âœ… **èªæ³•é©—è­‰æˆåŠŸ**  
âœ… **åœ–è¡¨æ­£å¸¸æ¸²æŸ“**  
âœ… **å‘å¾Œå…¼å®¹ä¿æŒ**  
âœ… **æ–‡æª”å®Œæ•´æ›´æ–°**  

**AIVA å°ˆæ¡ˆçš„ Mermaid åœ–è¡¨å·²æˆåŠŸå‡ç´šè‡³ 11.11.0+ æ¨™æº–ï¼**

---

**ä¸‹ä¸€æ­¥å»ºè­°:**
1. åœ¨ VS Code ä¸­é è¦½ç”Ÿæˆçš„åœ–è¡¨
2. æª¢æŸ¥æ‰€æœ‰åœ–è¡¨æ˜¯å¦æ­£ç¢ºæ¸²æŸ“
3. è€ƒæ…®å°‡æ–°èªæ³•æ‡‰ç”¨åˆ°æ–‡æª”ä¸­çš„å…¶ä»–åœ–è¡¨
4. å®šæœŸæ›´æ–°åˆ°æœ€æ–°çš„ Mermaid ç‰ˆæœ¬

---

*æœ¬å ±å‘Šç”± AIVA Mermaid æ›´æ–°å·¥å…·è‡ªå‹•ç”Ÿæˆ*  
*æœ€å¾Œæ›´æ–°: 2025-10-17 09:58:03*
