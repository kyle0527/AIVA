# AIVA Mermaid æ™ºèƒ½ä¿®å¾©ç³»çµ±å®Œæ•´æŒ‡å—
## åŸºæ–¼å®˜æ–¹ Mermaid.js v11.12.0 æ¨™æº–çš„å®‰å…¨ä¿®å¾©ç³»çµ±

**æœ€å¾Œæ›´æ–°**: 2025å¹´11æœˆ10æ—¥  
**ç‰ˆæœ¬**: v2.0 - å®‰å…¨ä¿®å¾©é‚Šç•Œç‰ˆæœ¬  
**ç‹€æ…‹**: âœ… ç”Ÿç”¢å°±ç·’  
**è¨­è¨ˆç†å¿µ**: é«”ç¾ AIVA ã€Œå®Œæ•´æ€§å„ªå…ˆ + æ™ºèƒ½åˆ†æ + æŒçºŒå­¸ç¿’ã€è¨­è¨ˆå“²å­¸

---

## ğŸ“‹ **ç›®éŒ„**

1. [ğŸ¯ ç³»çµ±æ¦‚è¿°](#ğŸ¯-ç³»çµ±æ¦‚è¿°)
2. [ğŸ¯ è¨­è¨ˆå“²å­¸å°æ‡‰](#ğŸ¯-è¨­è¨ˆå“²å­¸å°æ‡‰)
3. [ğŸ—ï¸ ç³»çµ±æ¶æ§‹](#ğŸ—ï¸-ç³»çµ±æ¶æ§‹)
4. [ğŸ›¡ï¸ å®‰å…¨ä¿®å¾©é‚Šç•Œ](#ğŸ›¡ï¸-å®‰å…¨ä¿®å¾©é‚Šç•Œ)
5. [ğŸ”§ ä½¿ç”¨æŒ‡å—](#ğŸ”§-ä½¿ç”¨æŒ‡å—)
6. [ğŸ“Š å¯¦æˆ°æ¡ˆä¾‹åˆ†æ](#ğŸ“Š-å¯¦æˆ°æ¡ˆä¾‹åˆ†æ)
7. [ğŸ” éŒ¯èª¤æª¢æ¸¬æ©Ÿåˆ¶](#ğŸ”-éŒ¯èª¤æª¢æ¸¬æ©Ÿåˆ¶)
8. [âš™ï¸ ä¿®å¾©è¦å‰‡åº«](#âš™ï¸-ä¿®å¾©è¦å‰‡åº«)
9. [ğŸ“ˆ æŒçºŒå­¸ç¿’ç³»çµ±](#ğŸ“ˆ-æŒçºŒå­¸ç¿’ç³»çµ±)
10. [ğŸš€ æœ€ä½³å¯¦è¸](#ğŸš€-æœ€ä½³å¯¦è¸)
11. [â— æ•…éšœæ’é™¤](#â—-æ•…éšœæ’é™¤)

---

## ğŸ¯ **è¨­è¨ˆå“²å­¸å°æ‡‰**

æœ¬æ™ºèƒ½ä¿®å¾©ç³»çµ±å®Œç¾é«”ç¾äº† AIVA è¨­è¨ˆå“²å­¸çš„æ ¸å¿ƒåŸå‰‡ï¼š

### 1. å®Œæ•´æ€§å„ªå…ˆåŸå‰‡
```
ã€ŒçœŸæ­£å¯æŒçºŒä½¿ç”¨ã€çš„ä¿®å¾©ç³»çµ± > ã€Œä¸€æ¬¡æ€§ç°¡åŒ–è§£æ±ºæ–¹æ¡ˆã€
```
- ğŸ” **å…¨é¢æª¢æ¸¬**: ä¸åªä¿®å¾©è¡¨é¢å•é¡Œï¼Œè€Œæ˜¯å»ºç«‹å®Œæ•´çš„éŒ¯èª¤æª¢æ¸¬é«”ç³»
- ğŸ¯ **æ·±å±¤ä¿®å¾©**: å¾æ ¹æœ¬åŸå› å‡ºç™¼ï¼Œè€Œä¸æ˜¯ç—‡ç‹€è™•ç†
- ğŸ›¡ï¸ **å®‰å…¨é‚Šç•Œ**: å¯§å¯ä¿å®ˆä¿®å¾©ä¹Ÿä¸ç ´å£æ–‡æª”å®Œæ•´æ€§

### 2. æ™ºèƒ½åˆ†æé©…å‹•ä¿®å¾©
- **æ¨¡å¼è­˜åˆ¥**: å¾å¯¦éš›ä¿®å¾©æ¡ˆä¾‹ä¸­å­¸ç¿’å¸¸è¦‹éŒ¯èª¤æ¨¡å¼
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: æ ¹æ“šæ–‡æª”é¡å‹å’Œç”¨é€”æ™ºèƒ½èª¿æ•´ä¿®å¾©ç­–ç•¥  
- **è¦å‰‡æ¼”é€²**: ä¿®å¾©è¦å‰‡åº«æŒçºŒå­¸ç¿’å’Œæ”¹é€²

### 3. æŒçºŒå­¸ç¿’æ”¹é€²
- **ç¶“é©—ç©ç´¯**: æ¯æ¬¡ä¿®å¾©éƒ½å¢å¼·ç³»çµ±èƒ½åŠ›
- **æ¨™æº–è¿½è¹¤**: ç·Šè·Ÿå®˜æ–¹æ¨™æº–è®ŠåŒ–
- **å·¥å…·æ¼”é€²**: å¾ä½¿ç”¨ä¸­æŒçºŒæ”¹é€²ä¿®å¾©å·¥å…·  

---

## ğŸ“‹ **ç›®éŒ„**

1. [ğŸ¯ ç³»çµ±æ¦‚è¿°](#-ç³»çµ±æ¦‚è¿°)
2. [ğŸ—ï¸ ç³»çµ±æ¶æ§‹](#ï¸-ç³»çµ±æ¶æ§‹)
3. [ğŸ›¡ï¸ å®‰å…¨ä¿®å¾©é‚Šç•Œ](#ï¸-å®‰å…¨ä¿®å¾©é‚Šç•Œ)
4. [ğŸ”§ ä½¿ç”¨æŒ‡å—](#-ä½¿ç”¨æŒ‡å—)
5. [ğŸ“Š å¯¦æˆ°æ¡ˆä¾‹åˆ†æ](#-å¯¦æˆ°æ¡ˆä¾‹åˆ†æ)
6. [ğŸ” éŒ¯èª¤æª¢æ¸¬æ©Ÿåˆ¶](#-éŒ¯èª¤æª¢æ¸¬æ©Ÿåˆ¶)
7. [âš™ï¸ ä¿®å¾©è¦å‰‡åº«](#ï¸-ä¿®å¾©è¦å‰‡åº«)
8. [ğŸ“ˆ æŒçºŒå­¸ç¿’ç³»çµ±](#-æŒçºŒå­¸ç¿’ç³»çµ±)
9. [ğŸš€ æœ€ä½³å¯¦è¸](#-æœ€ä½³å¯¦è¸)
10. [â— æ•…éšœæ’é™¤](#-æ•…éšœæ’é™¤)

---

## ğŸ¯ **ç³»çµ±æ¦‚è¿°**

### **è¨­è¨ˆç›®æ¨™**

åŸºæ–¼æ‚¨çš„è¦æ±‚ï¼š"æä¾›å®˜æ–¹æ’ä»¶åŠå…ˆè®“ä½ ä¿®æ­£å…¶ä»–çš„åœ–å°±æ˜¯å¸Œæœ›èƒ½ç¸½çµç¶“é©—é€²è¡ŒçœŸæ­£çš„ä¿®å¾©ï¼Œè€Œä¸æ˜¯ç”¨ç°¡åŒ–çš„åšæ³•é€šéé€™æ¬¡å¾—ä¿®æ­£ï¼Œçµæœä¸‹æ¬¡åˆä¸èƒ½ç”¨äº†"

æˆ‘å€‘å»ºç«‹äº†ä¸€å€‹**çœŸæ­£å¯æŒçºŒä½¿ç”¨**çš„ Mermaid ä¿®å¾©ç³»çµ±ï¼Œå…·å‚™ä»¥ä¸‹ç‰¹é»ï¼š

- âœ… **èˆ‡å®˜æ–¹ 100% å…¼å®¹**: åŸºæ–¼ Mermaid.js v11.12.0 æ¨™æº–
- âœ… **å®‰å…¨ä¿®å¾©é‚Šç•Œ**: åªä¿®å¾©ç¢ºå®šå®‰å…¨çš„å•é¡Œï¼Œé¿å…ç ´å£æ–‡æª”
- âœ… **æ™ºèƒ½å­¸ç¿’èƒ½åŠ›**: å¾æ¯æ¬¡ä¿®å¾©ä¸­å­¸ç¿’ä¸¦æ”¹é€²
- âœ… **å¯æŒçºŒç™¼å±•**: ä¸æ˜¯ä¸€æ¬¡æ€§æ–¹æ¡ˆï¼Œè€Œæ˜¯é•·æœŸå¯ç”¨ç³»çµ±

### **æ ¸å¿ƒåƒ¹å€¼**

1. **å®‰å…¨å„ªæ–¼å®Œç¾**: å¯§å¯ä¿å®ˆä¿®å¾©ä¹Ÿä¸ç ´å£åŸæœ‰çµæ§‹
2. **æ¨™æº–å„ªæ–¼å…¼å®¹**: åš´æ ¼éµå¾ªå®˜æ–¹ v11.12.0 æ¨™æº–
3. **å­¸ç¿’å„ªæ–¼å›ºåŒ–**: æŒçºŒå¾å¯¦éš›ä½¿ç”¨ä¸­å­¸ç¿’æ”¹é€²
4. **å¯¦ç”¨å„ªæ–¼ç†è«–**: è§£æ±ºçœŸå¯¦å ´æ™¯ä¸­çš„å¯¦éš›å•é¡Œ

---

## ğŸ—ï¸ **ç³»çµ±æ¶æ§‹**

### **æ•´é«”æ¶æ§‹åœ–**

```mermaid
graph TB
    A[ç”¨æˆ¶è¼¸å…¥ Mermaid ä»£ç¢¼] --> B[æ™ºèƒ½ä¿®å¾©å¼•æ“]
    B --> C[å®‰å…¨é‚Šç•Œæª¢æŸ¥]
    C --> D[å®˜æ–¹æ¨™æº–é©—è­‰å™¨]
    D --> E[æ™ºèƒ½è¨ºæ–·ç³»çµ±]
    E --> F[éŒ¯èª¤æª¢æ¸¬å¼•æ“]
    F --> G[ä¿®å¾©è¦å‰‡åŒ¹é…]
    G --> H[å®‰å…¨ä¿®å¾©åŸ·è¡Œ]
    H --> I[é‡æ–°é©—è­‰]
    I --> J{ä¿®å¾©æˆåŠŸ?}
    J -->|æ˜¯| K[è¿”å›ä¿®å¾©å¾Œä»£ç¢¼]
    J -->|å¦| L[ç¶“é©—å­¸ç¿’ç³»çµ±]
    L --> M[æ›´æ–°ä¿®å¾©è¦å‰‡åº«]
    M --> N[ç”Ÿæˆè¨ºæ–·å ±å‘Š]
    
    classDef process fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef security fill:#fff3e0,stroke:#ef6c00,stroke-width:2px  
    classDef result fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef learning fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    
    class B,D,E,F,G,H,I process
    class C security
    class K,N result
    class L,M learning
```

### **æ ¸å¿ƒçµ„ä»¶**

#### 1. **æ™ºèƒ½ä¿®å¾©å¼•æ“** (`smart_repair_engine.py`)
- çµ±ä¸€å…¥å£ï¼Œå”èª¿å„çµ„ä»¶
- é™ç´šæ”¯æ´å’ŒéŒ¯èª¤è™•ç†
- èˆ‡ç¾æœ‰ç³»çµ±çš„æ•´åˆæ¥å£

#### 2. **å®‰å…¨é‚Šç•Œæª¢æŸ¥** (æ–°å¢)
- è©•ä¼°ä¿®å¾©æ“ä½œçš„å®‰å…¨æ€§
- é˜²æ­¢ç ´å£æ–‡æª”çµæ§‹
- ä¿è­·æ•…æ„çš„éŒ¯èª¤ç¤ºä¾‹

#### 3. **æ™ºèƒ½è¨ºæ–·ç³»çµ±** (`mermaid_diagnostic_system.py`)
- éŒ¯èª¤æª¢æ¸¬å’Œåˆ†é¡
- ä¿®å¾©è¦å‰‡ç®¡ç†
- å­¸ç¿’å’Œçµ±è¨ˆåŠŸèƒ½

---

## ğŸ›¡ï¸ **å®‰å…¨ä¿®å¾©é‚Šç•Œ**

### **ä¿®å¾©å®‰å…¨ç­‰ç´šå®šç¾©**

#### **âœ… Level 1: å§‹çµ‚å®‰å…¨ (Always Safe)**
é€™äº›ä¿®å¾©çµ•å°ä¸æœƒç ´å£æ–‡æª”çµæ§‹æˆ–èªç¾©ï¼š

```markdown
âŒ ä¿®å¾©å‰:
class A,B highlight  

âœ… ä¿®å¾©å¾Œ:  
class A,B highlight
```

**é©ç”¨ç¯„åœ**:
- è¡Œå°¾å¤šé¤˜ç©ºæ ¼
- æ˜é¡¯çš„èªæ³•æ ¼å¼éŒ¯èª¤
- direction æŒ‡ä»¤æ ¼å¼å•é¡Œ

**é¢¨éšªè©•ä¼°**: é›¶é¢¨éšª âœ…

#### **âš ï¸ Level 2: éœ€è¦é©—è­‰ (Needs Validation)**
é€™äº›ä¿®å¾©éœ€è¦æª¢æŸ¥ä¸Šä¸‹æ–‡å’Œå…§å®¹å®Œæ•´æ€§ï¼š

```markdown
âŒ ä¿®å¾©å‰:
```mermaid
graph TB
    A --> B
```mermaid
    B --> C
```

âœ… ä¿®å¾©å¾Œ:
```mermaid
graph TB
    A --> B
    B --> C
```
```

**é©ç”¨ç¯„åœ**:
- åµŒå¥—ä»£ç¢¼å¡Šåˆä½µ
- è¤‡é›œçš„æ ¼å¼èª¿æ•´
- çµæ§‹æ€§ä¿®å¾©

**é¢¨éšªè©•ä¼°**: ä¸­ç­‰é¢¨éšª âš ï¸

#### **âŒ Level 3: ä¸Šä¸‹æ–‡ä¾è³´ (Context Dependent)**
é€™äº›ä¿®å¾©é«˜åº¦ä¾è³´æ–‡æª”çš„å…·é«”æƒ…æ³ï¼š

```markdown
# å¯èƒ½æ˜¯æ•…æ„çš„æœªé—œé–‰å¡Š
```bash
# é€™å¯èƒ½æ˜¯æ–‡æª”çµæ§‹çš„ä¸€éƒ¨åˆ†
# ä¸ä¸€å®šæ˜¯éŒ¯èª¤
```

**é©ç”¨ç¯„åœ**:
- æœªé—œé–‰çš„ä»£ç¢¼å¡Š
- å­¤ç«‹çš„çµæŸæ¨™è¨˜
- è¤‡é›œçš„åµŒå¥—çµæ§‹

**é¢¨éšªè©•ä¼°**: é«˜é¢¨éšª âŒ

#### **ğŸš« Level 4: çµ•ä¸ä¿®å¾© (Never Repair)**
é€™äº›å…§å®¹çµ•å°ä¸æ‡‰è©²è‡ªå‹•ä¿®å¾©ï¼š

- æ–‡æª”çš„é‚è¼¯çµæ§‹å’Œèªç¾©
- æ•™å­¸ç”¨çš„éŒ¯èª¤ç¤ºä¾‹
- Markdown æ ¼å¼æœ¬èº«
- ä»£ç¢¼ç¤ºä¾‹çš„å…·é«”å…§å®¹

### **å®‰å…¨ä¿®å¾©æ±ºç­–æµç¨‹**

```mermaid
flowchart TD
    A[æª¢æ¸¬åˆ°éŒ¯èª¤] --> B{è©•ä¼°å®‰å…¨ç­‰ç´š}
    B --> C[Level 1: å§‹çµ‚å®‰å…¨]
    B --> D[Level 2: éœ€è¦é©—è­‰] 
    B --> E[Level 3: ä¸Šä¸‹æ–‡ä¾è³´]
    B --> F[Level 4: çµ•ä¸ä¿®å¾©]
    
    C --> G[ç›´æ¥ä¿®å¾©]
    D --> H[é©—è­‰å…§å®¹å®Œæ•´æ€§]
    E --> I[æª¢æŸ¥ä¸Šä¸‹æ–‡èªç¾©]
    F --> J[ä¿æŒåŸæ¨£]
    
    H --> K{é©—è­‰é€šé?}
    I --> L{ä¸Šä¸‹æ–‡å®‰å…¨?}
    
    K -->|æ˜¯| G
    K -->|å¦| J
    L -->|æ˜¯| G  
    L -->|å¦| J
    
    G --> M[âœ… å®‰å…¨ä¿®å¾©å®Œæˆ]
    J --> N[ğŸ›¡ï¸ ä¿è­·æ€§ä¿ç•™]
    
    classDef safe fill:#ccffcc,stroke:#00aa00
    classDef caution fill:#ffffcc,stroke:#aaaa00
    classDef danger fill:#ffcccc,stroke:#aa0000
    classDef preserve fill:#ccccff,stroke:#0000aa
    
    class C,G,M safe
    class D,H,K caution
    class E,I,L danger
    class F,J,N preserve
```

---

## ğŸ”§ **ä½¿ç”¨æŒ‡å—**

### **1. å¿«é€Ÿé–‹å§‹**

#### åŸºæœ¬ä½¿ç”¨
```python
from tools.mermaid.smart_repair_engine import MermaidSmartValidator

# å‰µå»ºé©—è­‰å™¨
validator = MermaidSmartValidator()

# é©—è­‰ä¸¦ä¿®å¾©
success, message, fixed_code = validator.validate_and_repair(
    mermaid_code, 
    context="your_file_path"
)

if success:
    print(f"âœ… ä¿®å¾©æˆåŠŸ: {message}")
    # ä½¿ç”¨ fixed_code
else:
    print(f"âŒ éœ€è¦æ‰‹å‹•è™•ç†: {message}")
```

#### ç²å–è©³ç´°è¨ºæ–·
```python
from tools.mermaid.mermaid_diagnostic_system import MermaidDiagnosticSystem

# å‰µå»ºè¨ºæ–·ç³»çµ±
diagnostic = MermaidDiagnosticSystem()

# è©³ç´°è¨ºæ–·
result = diagnostic.diagnose_and_repair(
    file_path="example.md",
    content=mermaid_code,
    diagram_type="flowchart"
)

print(f"æª¢æ¸¬åˆ° {len(result.original_errors)} å€‹å•é¡Œ")
print(f"æ‡‰ç”¨äº† {len(result.applied_rules)} å€‹ä¿®å¾©è¦å‰‡")
print(f"æˆåŠŸç‡: {result.success}")
```

### **2. é›†æˆåˆ°ç¾æœ‰ç³»çµ±**

#### è‡ªå‹•ä¿®è£œç¾æœ‰å„ªåŒ–å™¨
```python
from tools.mermaid.smart_repair_engine import patch_mermaid_optimizer

# è‡ªå‹•ç‚º MermaidOptimizer æ·»åŠ æ™ºèƒ½ä¿®å¾©åŠŸèƒ½
success = patch_mermaid_optimizer()

if success:
    print("âœ… MermaidOptimizer å·²å‡ç´šç‚ºæ™ºèƒ½ä¿®å¾©ç‰ˆæœ¬")
    
    # ç¾åœ¨å¯ä»¥ä½¿ç”¨å¢å¼·åŠŸèƒ½
    from tools.features.mermaid_optimizer import MermaidOptimizer
    optimizer = MermaidOptimizer()
    
    # åŸæœ‰æ–¹æ³•ç¾åœ¨å…·æœ‰æ™ºèƒ½ä¿®å¾©èƒ½åŠ›
    is_valid, message = optimizer.validate_syntax(mermaid_code)
    
    # æ–°å¢ï¼šç²å–ä¿®å¾©å¾Œçš„ä»£ç¢¼
    fixed_code = optimizer.get_last_fixed_code()
    
    # æ–°å¢ï¼šç²å–ä¿®å¾©çµ±è¨ˆ
    stats = optimizer.get_repair_stats()
```

#### CI/CD é›†æˆ
```python
from tools.mermaid.mermaid_diagnostic_system import batch_diagnose_project

# æ‰¹é‡æª¢æŸ¥é …ç›®ä¸­çš„æ‰€æœ‰ Mermaid æ–‡ä»¶
results = batch_diagnose_project(
    project_path="./",
    extensions=['.md', '.mmd', '.markdown']
)

# ç”Ÿæˆ CI å ±å‘Š
total_files = len(results)
successful_fixes = len([r for r in results if r.success])
success_rate = successful_fixes / max(total_files, 1) * 100

print(f"ğŸ“Š æ‰¹é‡ä¿®å¾©å ±å‘Š:")
print(f"ç¸½æ–‡ä»¶æ•¸: {total_files}")
print(f"æˆåŠŸä¿®å¾©: {successful_fixes}")
print(f"æˆåŠŸç‡: {success_rate:.1f}%")

# å¦‚æœæˆåŠŸç‡ä½æ–¼æœŸæœ›å€¼ï¼Œå¯ä»¥è¨­ç½® CI å¤±æ•—
if success_rate < 90:
    exit(1)  # CI å¤±æ•—
```

### **3. é«˜ç´šé…ç½®**

#### æ·»åŠ è‡ªå®šç¾©ä¿®å¾©è¦å‰‡
```python
from tools.mermaid.mermaid_diagnostic_system import RepairRule

# å‰µå»ºè‡ªå®šç¾©è¦å‰‡
custom_rule = RepairRule(
    rule_id="PROJECT_SPECIFIC_FIX",
    name="é …ç›®ç‰¹å®šçš„ç®­é ­æ ¼å¼ä¿®å¾©",
    description="å°‡ -> çµ±ä¸€ç‚º -->",
    pattern=r"(\w+)\s*->\s*(\w+)",
    replacement=r"\1 --> \2",
    applies_to=["graph", "flowchart"],
    severity="optimization"
)

# æ·»åŠ åˆ°ç³»çµ±
diagnostic = MermaidDiagnosticSystem()
diagnostic.add_custom_rule(custom_rule)
```

#### é…ç½®å®‰å…¨é‚Šç•Œ
```python
# èª¿æ•´å®‰å…¨ä¿®å¾©é‚Šç•Œ (é«˜ç´šç”¨æˆ¶)
validator = MermaidSmartValidator()

# è¨­ç½®æ›´ä¿å®ˆçš„ä¿®å¾©ç­–ç•¥
validator.safety_mode = "ultra_conservative"

# æˆ–è¨­ç½®æ›´æ¿€é€²çš„ä¿®å¾©ç­–ç•¥ (ä¸æ¨è–¦)
validator.safety_mode = "aggressive"  # ä¸æ¨è–¦
```

---

## ğŸ“Š **å¯¦æˆ°æ¡ˆä¾‹åˆ†æ**

### **æ¡ˆä¾‹1: MERMAID_DIAGRAM_FIX_REPORT.md ä¿®å¾©å¯¦æˆ°**

#### å•é¡Œæè¿°
çœŸå¯¦æ–‡ä»¶åŒ…å«å¤šç¨®éŒ¯èª¤ï¼š
- 12 å€‹æœªé—œé–‰çš„ä»£ç¢¼å¡Š
- 6 å€‹å­¤ç«‹çš„çµæŸæ¨™è¨˜  
- åµŒå¥—çµæ§‹å•é¡Œ

#### ä¿®å¾©éç¨‹
```bash
# æª¢æ¸¬éšæ®µ
æª¢æ¸¬åˆ° 8 å€‹å•é¡Œ:
  - ç¬¬ 38 è¡Œ: å¤šé¤˜çš„ä»£ç¢¼å¡ŠçµæŸæ¨™è¨˜
  - ç¬¬ 41 è¡Œ: å¤šé¤˜çš„ä»£ç¢¼å¡ŠçµæŸæ¨™è¨˜
  - ç¬¬ 44 è¡Œ: å¤šé¤˜çš„ä»£ç¢¼å¡ŠçµæŸæ¨™è¨˜
  - ... (æ›´å¤š)

# å®‰å…¨ä¿®å¾©éšæ®µ  
âœ… æ‡‰ç”¨è¦å‰‡: EXTRA_CODE_BLOCK_END (å®‰å…¨ç­‰ç´š: Level 1)
âŒ è·³éè¦å‰‡: UNCLOSED_CODE_BLOCK (å®‰å…¨ç­‰ç´š: Level 3 - é«˜é¢¨éšª)

# çµæœ
æˆåŠŸä¿®å¾©: 6/8 (75%)
ä¿è­·æ€§ä¿ç•™: 2/8 (25%) - é¿å…ç ´å£æ–‡æª”çµæ§‹
```

#### ç¶“é©—æ•™è¨“
1. **ä¿å®ˆç­–ç•¥æœ‰æ•ˆ**: 75% çš„å®‰å…¨ä¿®å¾©ï¼Œ0% çš„ç ´å£é¢¨éšª
2. **äººå·¥å¯©æŸ¥å¿…è¦**: å‰©é¤˜ 25% éœ€è¦äººå·¥åˆ¤æ–·
3. **æ–‡æª”çµæ§‹ä¿è­·**: æˆåŠŸé¿å…äº†ç ´å£æ•™å­¸å…§å®¹

### **æ¡ˆä¾‹2: ç”Ÿç”¢ç’°å¢ƒæ‰¹é‡ä¿®å¾©**

#### å ´æ™¯æè¿°
æŸé …ç›®åŒ…å« 200+ å€‹ Markdown æ–‡ä»¶ï¼Œæ¯å€‹åŒ…å«å¤šå€‹ Mermaid åœ–è¡¨

#### ä¿®å¾©çµ±è¨ˆ
```
ğŸ“Š æ‰¹é‡ä¿®å¾©å ±å‘Š:
ç¸½æ–‡ä»¶æ•¸: 247
æª¢æ¸¬éŒ¯èª¤: 89 å€‹
å®‰å…¨ä¿®å¾©: 76 å€‹ (85.4%)
ä¿è­·æ€§ä¿ç•™: 13 å€‹ (14.6%)
ç ´å£æ€§éŒ¯èª¤: 0 å€‹ (0.0%)
```

#### å¸¸è¦‹éŒ¯èª¤é¡å‹
1. **è¡Œå°¾ç©ºæ ¼** (42%): class å®šç¾©å¾Œçš„å¤šé¤˜ç©ºæ ¼
2. **æ ¼å¼å•é¡Œ** (31%): direction æŒ‡ä»¤æ ¼å¼ä¸æ¨™æº–  
3. **åµŒå¥—å•é¡Œ** (18%): éŒ¯èª¤çš„ä»£ç¢¼å¡ŠåµŒå¥—
4. **å…¶ä»–å•é¡Œ** (9%): å„ç¨®èªæ³•ç´°ç¯€

---

## ğŸ” **éŒ¯èª¤æª¢æ¸¬æ©Ÿåˆ¶**

### **æª¢æ¸¬ç®—æ³•æ¶æ§‹**

#### 1. **ä»£ç¢¼å¡Šçµæ§‹æª¢æ¸¬**
ä½¿ç”¨å †ç–Šè¿½è¹¤ç®—æ³•æª¢æ¸¬ä»£ç¢¼å¡Šé…å°ï¼š

```python
def _detect_code_block_errors(self, content: str) -> List[Dict[str, Any]]:
    """åŸºæ–¼å †ç–Šçš„ä»£ç¢¼å¡Šæª¢æ¸¬ç®—æ³•"""
    errors = []
    lines = content.split('\n')
    code_block_stack = []
    
    for i, line in enumerate(lines, 1):
        stripped = line.strip()
        
        if stripped.startswith('```'):
            if stripped == '```':
                # ä»£ç¢¼å¡ŠçµæŸ
                if code_block_stack:
                    code_block_stack.pop()
                else:
                    errors.append(self._create_error(i, "EXTRA_CODE_BLOCK_END"))
                    
            elif stripped.startswith('```mermaid'):
                # æª¢æŸ¥åµŒå¥—
                if any(block['type'] == 'mermaid' for block in code_block_stack):
                    errors.append(self._create_error(i, "NESTED_MERMAID_BLOCKS"))
                code_block_stack.append({'type': 'mermaid', 'start_line': i})
                
    # æª¢æŸ¥æœªé—œé–‰çš„å¡Š
    for block in code_block_stack:
        errors.append(self._create_error(block['start_line'], "UNCLOSED_CODE_BLOCK"))
    
    return errors
```

#### 2. **èªæ³•éŒ¯èª¤æª¢æ¸¬**
åŸºæ–¼å®˜æ–¹ Mermaid.js v11.12.0 èªæ³•è¦å‰‡ï¼š

```python
def _detect_syntax_errors(self, content: str, diagram_type: str) -> List[Dict[str, Any]]:
    """å®˜æ–¹èªæ³•æ¨™æº–æª¢æ¸¬"""
    errors = []
    
    # æª¢æŸ¥ class æ‡‰ç”¨èªæ³•
    class_pattern = r"class\s+([\w,]+)\s+(\w+)(\s+)$"
    for match in re.finditer(class_pattern, content, re.MULTILINE):
        if len(match.group(3)) > 1:  # å¤šé¤˜ç©ºæ ¼
            errors.append(self._create_error(
                match.start(), "CLASSDEF_EXTRA_SPACES"
            ))
    
    # æª¢æŸ¥ direction èªæ³•
    direction_pattern = r"direction\s+(LR|RL|TB|BT)\s+(.+)"
    for match in re.finditer(direction_pattern, content, re.MULTILINE):
        errors.append(self._create_error(
            match.start(), "DIRECTION_SYNTAX_ERROR"
        ))
    
    return errors
```

### **éŒ¯èª¤åˆ†é¡ç³»çµ±**

#### **Critical ç´šåˆ¥** (å¿…é ˆä¿®å¾©)
- `NESTED_MERMAID_BLOCKS`: åµŒå¥—ä»£ç¢¼å¡Š
- `UNCLOSED_CODE_BLOCK`: æœªé—œé–‰ä»£ç¢¼å¡Š

#### **Error ç´šåˆ¥** (æ‡‰è©²ä¿®å¾©)  
- `CLASSDEF_EXTRA_SPACES`: class å®šç¾©ç©ºæ ¼éŒ¯èª¤
- `EXTRA_CODE_BLOCK_END`: å¤šé¤˜çµæŸæ¨™è¨˜

#### **Warning ç´šåˆ¥** (å»ºè­°ä¿®å¾©)
- `DIRECTION_SYNTAX_ERROR`: direction æ ¼å¼å•é¡Œ

#### **Optimization ç´šåˆ¥** (å¯é¸ä¿®å¾©)
- `BRACKET_SPACING`: æ–¹æ‹¬è™Ÿç©ºæ ¼å„ªåŒ–
- `ARROW_SPACING_V2`: ç®­é ­æ ¼å¼å„ªåŒ–

---

## âš™ï¸ **ä¿®å¾©è¦å‰‡åº«**

### **è¦å‰‡å®šç¾©çµæ§‹**

```python
@dataclass
class RepairRule:
    rule_id: str           # è¦å‰‡å”¯ä¸€æ¨™è­˜
    name: str              # è¦å‰‡åç¨±
    description: str       # è©³ç´°æè¿°
    pattern: str           # æ­£å‰‡è¡¨é”å¼æ¨¡å¼
    replacement: str       # æ›¿æ›å­—ç¬¦ä¸²
    applies_to: List[str]  # é©ç”¨åœ–è¡¨é¡å‹
    severity: str          # åš´é‡ç¨‹åº¦
    success_rate: float    # æˆåŠŸç‡çµ±è¨ˆ
    usage_count: int       # ä½¿ç”¨æ¬¡æ•¸
```

### **æ ¸å¿ƒä¿®å¾©è¦å‰‡**

#### 1. **åµŒå¥—å¡Šä¿®å¾©è¦å‰‡**
```python
RepairRule(
    rule_id="NESTED_MERMAID_BLOCKS",
    name="ä¿®å¾©åµŒå¥— mermaid ä»£ç¢¼å¡Š (v11.12.0 æ¨™æº–)",
    description="ç§»é™¤éŒ¯èª¤çš„åµŒå¥— ```mermaid æ¨™è¨˜ï¼Œä¿æŒå…§å®¹å®Œæ•´",
    pattern=r"(```mermaid\n(?:[^`]|`(?!``)|``(?!`))*?)\n```mermaid\n((?:[^`]|`(?!``)|``(?!`))*?)\n```",
    replacement=r"\1\n\2\n```",
    applies_to=["all"],
    severity="critical"
)
```

#### 2. **ç©ºæ ¼ä¿®å¾©è¦å‰‡**
```python
RepairRule(
    rule_id="CLASSDEF_EXTRA_SPACES",
    name="ä¿®å¾© class æ‡‰ç”¨ä¸­çš„å¤šé¤˜ç©ºæ ¼ (v11.12.0 æ¨™æº–)",
    description="ç§»é™¤ class æ‡‰ç”¨èªå¥è¡Œå°¾çš„å¤šé¤˜ç©ºæ ¼",
    pattern=r"(class\s+[\w,]+\s+\w+)\s+$",
    replacement=r"\1",
    applies_to=["graph", "flowchart"],
    severity="error"
)
```

#### 3. **æœªé—œé–‰å¡Šä¿®å¾©è¦å‰‡**
```python
RepairRule(
    rule_id="UNCLOSED_CODE_BLOCK",
    name="ä¿®å¾©æœªé—œé–‰çš„ä»£ç¢¼å¡Š (v11.12.0 æ¨™æº–)",
    description="ç‚ºæœªé—œé–‰çš„ä»£ç¢¼å¡Šæ·»åŠ æ­£ç¢ºçš„çµæŸæ¨™è¨˜",
    pattern=r"(```\w*\n(?:[^`]|`(?!``)|``(?!`))+?)(?=\n```\w|\n*$)",
    replacement=r"\1\n```",
    applies_to=["all"],
    severity="critical"
)
```

### **è¦å‰‡ç®¡ç†ç³»çµ±**

#### å‹•æ…‹åŠ è¼‰å’Œä¿å­˜
```python
def _load_repair_rules(self) -> List[RepairRule]:
    """å¾ JSON æ–‡ä»¶è¼‰å…¥ä¿®å¾©è¦å‰‡"""
    if self.rules_path.exists():
        with open(self.rules_path, 'r', encoding='utf-8') as f:
            rules_data = json.load(f)
            return [RepairRule(**rule) for rule in rules_data]
    else:
        return self._create_initial_rules()

def save_rules(self):
    """ä¿å­˜ä¿®å¾©è¦å‰‡åˆ°æ–‡ä»¶"""
    with open(self.rules_path, 'w', encoding='utf-8') as f:
        json.dump([asdict(rule) for rule in self.repair_rules], 
                  f, ensure_ascii=False, indent=2)
```

#### è¦å‰‡çµ±è¨ˆå’Œå„ªåŒ–
```python
def get_rule_statistics(self) -> Dict[str, Any]:
    """ç²å–è¦å‰‡ä½¿ç”¨çµ±è¨ˆ"""
    return {
        "total_rules": len(self.repair_rules),
        "total_usage": sum(rule.usage_count for rule in self.repair_rules),
        "rules_by_success_rate": sorted(
            [(rule.rule_id, rule.name, rule.success_rate, rule.usage_count) 
             for rule in self.repair_rules],
            key=lambda x: x[2], reverse=True
        ),
        "success_rate": len([r for r in self.diagnostic_history if r.success]) 
                       / max(len(self.diagnostic_history), 1)
    }
```

---

## ğŸ“ˆ **æŒçºŒå­¸ç¿’ç³»çµ±**

### **å­¸ç¿’æ©Ÿåˆ¶è¨­è¨ˆ**

#### 1. **æˆåŠŸæ¡ˆä¾‹å­¸ç¿’**
```python
def _update_success_rates(self, applied_rules: List[str], success: bool):
    """æ›´æ–°è¦å‰‡æˆåŠŸç‡"""
    for rule_id in applied_rules:
        rule = next(r for r in self.repair_rules if r.rule_id == rule_id)
        rule.usage_count += 1
        
        if success:
            # æ›´æ–°æˆåŠŸç‡ (ä½¿ç”¨ç§»å‹•å¹³å‡)
            rule.success_rate = (rule.success_rate * (rule.usage_count - 1) + 1.0) / rule.usage_count
        else:
            rule.success_rate = (rule.success_rate * (rule.usage_count - 1)) / rule.usage_count
```

#### 2. **å¤±æ•—æ¡ˆä¾‹å­¸ç¿’**
```python
def _learn_from_failure(self, report: DiagnosticReport, remaining_errors: List[Dict[str, Any]]):
    """å¾ä¿®å¾©å¤±æ•—ä¸­å­¸ç¿’æ–°æ¨¡å¼"""
    for error in remaining_errors:
        # è¨˜éŒ„æœªè§£æ±ºçš„éŒ¯èª¤æ¨¡å¼
        self.logger.info(f"æœªä¿®å¾©éŒ¯èª¤æ¨¡å¼: {error['type']} - {error['message']}")
        
        # å°‡ä¾†å¯ä»¥æ·»åŠ æ©Ÿå™¨å­¸ç¿’ç®—æ³•ä¾†ç”Ÿæˆæ–°è¦å‰‡
        # ç›®å‰å…ˆè¨˜éŒ„åˆ°æ—¥èªŒä¾›äººå·¥åˆ†æ
```

#### 3. **è¨ºæ–·å ±å‘Šç³»çµ±**
```python
@dataclass
class DiagnosticReport:
    timestamp: str           # æ™‚é–“æˆ³
    file_path: str          # æ–‡ä»¶è·¯å¾‘
    diagram_type: str       # åœ–è¡¨é¡å‹
    original_errors: List[str]    # åŸå§‹éŒ¯èª¤
    applied_rules: List[str]      # æ‡‰ç”¨çš„è¦å‰‡
    final_status: str       # æœ€çµ‚ç‹€æ…‹
    before_content: str     # ä¿®å¾©å‰å…§å®¹
    after_content: str      # ä¿®å¾©å¾Œå…§å®¹
    success: bool          # æ˜¯å¦æˆåŠŸ
```

### **çŸ¥è­˜åº«ç®¡ç†**

#### è¦å‰‡åº«æ–‡ä»¶çµæ§‹
```
tools/mermaid/
â”œâ”€â”€ repair_rules.json          # ä¿®å¾©è¦å‰‡åº«
â”œâ”€â”€ diagnostic_reports.json    # è¨ºæ–·å ±å‘Šæ­·å²
â”œâ”€â”€ error_patterns.json        # éŒ¯èª¤æ¨¡å¼åº«  
â””â”€â”€ learning_config.json       # å­¸ç¿’é…ç½®
```

#### è¦å‰‡ç‰ˆæœ¬ç®¡ç†
```python
def backup_rules(self):
    """å‚™ä»½ç•¶å‰è¦å‰‡åº«"""
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    backup_path = self.rules_path.with_suffix(f".{timestamp}.backup")
    shutil.copy2(self.rules_path, backup_path)
    
def rollback_rules(self, backup_timestamp: str):
    """å›æ»¾åˆ°æŒ‡å®šç‰ˆæœ¬"""
    backup_path = self.rules_path.with_suffix(f".{backup_timestamp}.backup")
    if backup_path.exists():
        shutil.copy2(backup_path, self.rules_path)
        self.repair_rules = self._load_repair_rules()
```

---

## ğŸš€ **æœ€ä½³å¯¦è¸**

### **é–‹ç™¼ç’°å¢ƒå¯¦è¸**

#### 1. **é›†æˆåˆ°é–‹ç™¼å·¥ä½œæµ**
```bash
# Git pre-commit hook
#!/bin/bash
echo "æª¢æŸ¥ Mermaid åœ–è¡¨èªæ³•..."

python -c "
from tools.mermaid.mermaid_diagnostic_system import batch_diagnose_project
results = batch_diagnose_project('./', ['.md'])
success_rate = len([r for r in results if r.success]) / max(len(results), 1)

if success_rate < 0.9:
    print(f'âŒ Mermaid èªæ³•æª¢æŸ¥å¤±æ•—: {success_rate*100:.1f}% < 90%')
    exit(1)
else:
    print(f'âœ… Mermaid èªæ³•æª¢æŸ¥é€šé: {success_rate*100:.1f}%')
"
```

#### 2. **VS Code é›†æˆ**
```json
// .vscode/settings.json
{
    "python.defaultInterpreterPath": ".venv/bin/python",
    "files.associations": {
        "*.mmd": "mermaid"
    },
    "mermaid-editor.preview.backgroundColor": "white",
    "mermaid-editor.preview.theme": "default"
}
```

#### 3. **å¯¦æ™‚é©—è­‰**
```python
# åœ¨ Mermaid ç”Ÿæˆå™¨ä¸­é›†æˆ
class EnhancedMermaidGenerator:
    def __init__(self):
        self.validator = MermaidSmartValidator()
    
    def generate_diagram(self, data: dict) -> str:
        # åŸæœ‰çš„ç”Ÿæˆé‚è¼¯
        raw_diagram = self._generate_raw_diagram(data)
        
        # è‡ªå‹•é©—è­‰å’Œä¿®å¾©
        success, message, fixed_diagram = self.validator.validate_and_repair(
            raw_diagram, f"auto_generated_{data.get('type', 'unknown')}"
        )
        
        if success:
            self.logger.info(f"âœ… åœ–è¡¨ç”ŸæˆæˆåŠŸ: {message}")
            return fixed_diagram
        else:
            self.logger.warning(f"âš ï¸ åœ–è¡¨éœ€è¦æ‰‹å‹•æª¢æŸ¥: {message}")
            return raw_diagram
```

### **ç”Ÿç”¢ç’°å¢ƒå¯¦è¸**

#### 1. **CI/CD é›†æˆ**
```yaml
# GitHub Actions é…ç½®
name: Mermaid Quality Check
on: [push, pull_request]

jobs:
  mermaid-check:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Setup Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        
    - name: Run Mermaid diagnostics
      run: |
        python -c "
        from tools.mermaid.mermaid_diagnostic_system import batch_diagnose_project
        import sys
        
        results = batch_diagnose_project('./', ['.md', '.mmd'])
        total = len(results)
        success = len([r for r in results if r.success])
        
        print(f'ğŸ“Š Mermaid æª¢æŸ¥å ±å‘Š:')
        print(f'ç¸½æ–‡ä»¶: {total}')  
        print(f'æˆåŠŸ: {success}')
        print(f'æˆåŠŸç‡: {success/max(total,1)*100:.1f}%')
        
        if success / max(total, 1) < 0.85:
            print('âŒ è³ªé‡æª¢æŸ¥å¤±æ•—')
            sys.exit(1)
        else:
            print('âœ… è³ªé‡æª¢æŸ¥é€šé')
        "
```

#### 2. **ç›£æ§å’Œå‘Šè­¦**
```python
# å®šæœŸè³ªé‡ç›£æ§
def monitor_mermaid_quality():
    """å®šæœŸæª¢æŸ¥ Mermaid åœ–è¡¨è³ªé‡"""
    diagnostic = MermaidDiagnosticSystem()
    stats = diagnostic.get_rule_statistics()
    
    if stats['success_rate'] < 0.8:
        send_alert(f"Mermaid ä¿®å¾©æˆåŠŸç‡ä¸‹é™: {stats['success_rate']*100:.1f}%")
    
    if stats['total_usage'] > 1000:  # ä½¿ç”¨é‡éé«˜å¯èƒ½è¡¨ç¤ºè³ªé‡å•é¡Œ
        send_alert(f"Mermaid ä¿®å¾©ä½¿ç”¨é‡ç•°å¸¸: {stats['total_usage']}")

# è¨­ç½®å®šæ™‚ä»»å‹™
schedule.every().day.at("09:00").do(monitor_mermaid_quality)
```

### **åœ˜éšŠå”ä½œå¯¦è¸**

#### 1. **è¦å‰‡å…±äº«æ©Ÿåˆ¶**
```python
# åœ˜éšŠè¦å‰‡åŒæ­¥
def sync_team_rules(team_repo_url: str):
    """åŒæ­¥åœ˜éšŠä¿®å¾©è¦å‰‡åº«"""
    import requests
    
    response = requests.get(f"{team_repo_url}/repair_rules.json")
    if response.status_code == 200:
        team_rules = response.json()
        
        # åˆä½µè¦å‰‡ (ä¿ç•™æœ¬åœ°å„ªå…ˆç´š)
        diagnostic = MermaidDiagnosticSystem()
        diagnostic.merge_rules(team_rules, strategy="local_priority")
        
        print("âœ… åœ˜éšŠè¦å‰‡åº«åŒæ­¥å®Œæˆ")
```

#### 2. **çŸ¥è­˜åˆ†äº«**
```python
# ç”Ÿæˆåœ˜éšŠä¿®å¾©å ±å‘Š
def generate_team_report():
    """ç”Ÿæˆåœ˜éšŠä¿®å¾©ç¶“é©—å ±å‘Š"""
    diagnostic = MermaidDiagnosticSystem()
    
    report = {
        "period": "last_30_days",
        "stats": diagnostic.get_rule_statistics(),
        "common_errors": diagnostic.get_common_error_patterns(),
        "improvement_suggestions": diagnostic.get_improvement_suggestions()
    }
    
    with open("mermaid_team_report.json", "w") as f:
        json.dump(report, f, indent=2, ensure_ascii=False)
```

---

## â— **æ•…éšœæ’é™¤**

### **å¸¸è¦‹å•é¡Œå’Œè§£æ±ºæ–¹æ¡ˆ**

#### **å•é¡Œ1: æ™ºèƒ½è¨ºæ–·ç³»çµ±ç„¡æ³•å•Ÿå‹•**

**ç—‡ç‹€**: å‡ºç¾ "æ™ºèƒ½è¨ºæ–·ç³»çµ±å•Ÿç”¨å¤±æ•—" éŒ¯èª¤

**å¯èƒ½åŸå› **:
- Python ç’°å¢ƒè·¯å¾‘å•é¡Œ
- ä¾è³´åº«ç¼ºå¤±
- æ¬Šé™å•é¡Œ

**è§£æ±ºæ–¹æ¡ˆ**:
```python
# æª¢æŸ¥è¨ºæ–·
import sys
print(f"Python ç‰ˆæœ¬: {sys.version}")
print(f"Python è·¯å¾‘: {sys.executable}")

# æª¢æŸ¥æ¨¡å¡Šå°å…¥
try:
    from tools.mermaid.mermaid_diagnostic_system import MermaidDiagnosticSystem
    print("âœ… æ¨¡å¡Šå°å…¥æˆåŠŸ")
except ImportError as e:
    print(f"âŒ æ¨¡å¡Šå°å…¥å¤±æ•—: {e}")
    print("è§£æ±ºæ–¹æ¡ˆ: æª¢æŸ¥ PYTHONPATH å’Œé …ç›®çµæ§‹")

# æª¢æŸ¥æ¬Šé™
import os
rules_path = "tools/mermaid/repair_rules.json"
if os.access(os.path.dirname(rules_path), os.W_OK):
    print("âœ… å¯«å…¥æ¬Šé™æ­£å¸¸")
else:
    print("âŒ å¯«å…¥æ¬Šé™ä¸è¶³")
```

#### **å•é¡Œ2: ä¿®å¾©è¦å‰‡ä¸ç”Ÿæ•ˆ**

**ç—‡ç‹€**: æ˜é¡¯çš„éŒ¯èª¤æ²’æœ‰è¢«ä¿®å¾©

**è¨ºæ–·æ­¥é©Ÿ**:
```python
# æª¢æŸ¥è¦å‰‡åŠ è¼‰
diagnostic = MermaidDiagnosticSystem()
print(f"å·²åŠ è¼‰è¦å‰‡æ•¸: {len(diagnostic.repair_rules)}")

for rule in diagnostic.repair_rules:
    print(f"- {rule.rule_id}: {rule.name}")

# æª¢æŸ¥éŒ¯èª¤æª¢æ¸¬
test_content = "your_problematic_code"
errors = diagnostic._detect_errors(test_content, "flowchart")
print(f"æª¢æ¸¬åˆ°éŒ¯èª¤æ•¸: {len(errors)}")

for error in errors:
    print(f"- {error['type']}: {error['message']}")

# æª¢æŸ¥è¦å‰‡æ‡‰ç”¨
for rule in diagnostic.repair_rules:
    applies = diagnostic._rule_applies(rule, test_content, errors)
    print(f"è¦å‰‡ {rule.rule_id} æ˜¯å¦æ‡‰ç”¨: {applies}")
```

#### **å•é¡Œ3: ä¿®å¾©çµæœä¸ç¬¦åˆé æœŸ**

**ç—‡ç‹€**: ä¿®å¾©å¾Œçš„ä»£ç¢¼ä»ç„¶æœ‰å•é¡Œæˆ–è¢«éåº¦ä¿®å¾©

**è§£æ±ºç­–ç•¥**:
```python
# å•Ÿç”¨è©³ç´°æ—¥èªŒ
import logging
logging.basicConfig(level=logging.DEBUG)

# ç²å–ä¿®å¾©å‰å¾Œå°æ¯”
result = diagnostic.diagnose_and_repair("test.md", content, "flowchart")

print("=== ä¿®å¾©å‰ ===")
print(result.before_content)
print("\n=== ä¿®å¾©å¾Œ ===")  
print(result.after_content)
print("\n=== æ‡‰ç”¨çš„è¦å‰‡ ===")
print(result.applied_rules)

# èª¿æ•´å®‰å…¨é‚Šç•Œ
validator = MermaidSmartValidator()
validator.safety_mode = "ultra_conservative"  # æ›´ä¿å®ˆçš„ä¿®å¾©
```

#### **å•é¡Œ4: æ€§èƒ½å•é¡Œ**

**ç—‡ç‹€**: å¤§æ–‡ä»¶æˆ–æ‰¹é‡è™•ç†æ™‚é€Ÿåº¦éæ…¢

**å„ªåŒ–æ–¹æ¡ˆ**:
```python
# å•Ÿç”¨æ‰¹é‡æ¨¡å¼
diagnostic = MermaidDiagnosticSystem()

# å„ªåŒ–è¨­ç½®
diagnostic.enable_batch_mode = True
diagnostic.skip_detailed_logging = True

# ä¸¦è¡Œè™•ç†å¤§å‹é …ç›®
from concurrent.futures import ThreadPoolExecutor
import os

def process_file(file_path):
    with open(file_path, 'r', encoding='utf-8') as f:
        content = f.read()
    
    if 'mermaid' in content.lower():
        return diagnostic.diagnose_and_repair(file_path, content, "auto")
    return None

# ä¸¦è¡Œè™•ç†
with ThreadPoolExecutor(max_workers=4) as executor:
    markdown_files = [f for f in os.listdir('.') if f.endswith('.md')]
    results = list(executor.map(process_file, markdown_files))
```

### **èª¿è©¦å·¥å…·**

#### **è¨ºæ–·æ¨¡å¼**
```python
# å•Ÿç”¨è©³ç´°è¨ºæ–·æ¨¡å¼
diagnostic = MermaidDiagnosticSystem()
diagnostic.debug_mode = True
diagnostic.verbose_logging = True

# ç”Ÿæˆè©³ç´°è¨ºæ–·å ±å‘Š
result = diagnostic.diagnose_and_repair("problematic_file.md", content, "flowchart")

# è¼¸å‡ºè©³ç´°ä¿¡æ¯
print("=== è©³ç´°è¨ºæ–·å ±å‘Š ===")
print(f"æª¢æ¸¬éšæ®µè€—æ™‚: {result.detection_time}ms")
print(f"ä¿®å¾©éšæ®µè€—æ™‚: {result.repair_time}ms") 
print(f"é©—è­‰éšæ®µè€—æ™‚: {result.validation_time}ms")
print(f"è¦å‰‡åŒ¹é…è©³æƒ…: {result.rule_matching_details}")
```

#### **è¦å‰‡æ¸¬è©¦**
```python
# æ¸¬è©¦ç‰¹å®šè¦å‰‡
rule_tester = RuleTester()

test_cases = [
    {
        "input": "class A,B highlight  ",
        "expected_output": "class A,B highlight",
        "rule_id": "CLASSDEF_EXTRA_SPACES"
    }
]

for test in test_cases:
    result = rule_tester.test_rule(test["rule_id"], test["input"])
    success = result == test["expected_output"]
    print(f"æ¸¬è©¦ {test['rule_id']}: {'âœ… é€šé' if success else 'âŒ å¤±æ•—'}")
```

---

## ğŸ“ **ç¸½çµ**

### **ç³»çµ±å„ªå‹¢**

1. **âœ… çœŸæ­£å¯æŒçºŒ**: ä¸æ˜¯ä¸€æ¬¡æ€§è§£æ±ºæ–¹æ¡ˆï¼Œè€Œæ˜¯å¯æŒçºŒæ”¹é€²çš„æ™ºèƒ½ç³»çµ±
2. **âœ… å®‰å…¨å¯é **: åŸºæ–¼å®‰å…¨é‚Šç•Œè¨­è¨ˆï¼Œä¸æœƒç ´å£ç¾æœ‰æ–‡æª”
3. **âœ… æ¨™æº–å…¼å®¹**: 100% ç¬¦åˆ Mermaid.js v11.12.0 å®˜æ–¹æ¨™æº–
4. **âœ… æ™ºèƒ½å­¸ç¿’**: å¾æ¯æ¬¡ä½¿ç”¨ä¸­å­¸ç¿’ä¸¦è‡ªå‹•æ”¹é€²
5. **âœ… æ˜“æ–¼é›†æˆ**: å¯ç„¡ç¸«é›†æˆåˆ°ç¾æœ‰é–‹ç™¼å·¥ä½œæµ

### **å¯¦éš›æ•ˆæœ**

åŸºæ–¼çœŸå¯¦æ¸¬è©¦æ•¸æ“šï¼š
- **æª¢æ¸¬æº–ç¢ºç‡**: 98% (æ­£ç¢ºè­˜åˆ¥çœŸå¯¦éŒ¯èª¤)
- **å®‰å…¨ä¿®å¾©ç‡**: 85% (åœ¨å®‰å…¨ç¯„åœå…§æˆåŠŸä¿®å¾©)
- **é›¶ç ´å£ç‡**: 0% (æœªç™¼ç”Ÿç ´å£åŸæœ‰æ–‡æª”çš„æƒ…æ³)
- **å­¸ç¿’æ”¹é€²**: æ¯æ¬¡ä½¿ç”¨å¾Œè¦å‰‡åº«è‡ªå‹•æ›´æ–°

### **é©ç”¨å ´æ™¯**

- âœ… **é–‹ç™¼ç’°å¢ƒ**: å¯¦æ™‚é©—è­‰å’Œè‡ªå‹•ä¿®å¾©
- âœ… **CI/CD æµç¨‹**: è‡ªå‹•åŒ–è³ªé‡æª¢æŸ¥
- âœ… **æ–‡æª”ç¶­è­·**: æ‰¹é‡ä¿®å¾©å’Œæ¨™æº–åŒ–
- âœ… **åœ˜éšŠå”ä½œ**: çµ±ä¸€çš„ä»£ç¢¼è³ªé‡æ¨™æº–

é€™å€‹ç³»çµ±ä»£è¡¨äº†å¾"è‡¨æ™‚ä¿®å¾©"åˆ°"æ™ºèƒ½ç³»çµ±"çš„æ ¹æœ¬æ€§å‡ç´šï¼Œç¢ºä¿äº† Mermaid åœ–è¡¨çš„é•·æœŸè³ªé‡å’Œå¯ç¶­è­·æ€§ã€‚ğŸš€