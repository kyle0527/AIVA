flowchart TB
    n1([開始])
    n2([結束])
    n3[&amp;&#35;39;執行 RAG 增強的智能決策與工具執行.\n\n        Args:\n     ...]
    n4[logger.info&#40;&amp;&#35;39;&#91;啟動&#93; 收到新任務: %s&amp;&...]
    n5[logger.info&#40;&amp;&#35;39;&#91;資料&#93; &#91;步驟 1/5&#93...]
    n6[retrieved_chunks = self.knowledge_base....]
    n7[logger.info&#40;&amp;&#35;39;   &#91;V&#93; 檢索到 %d 個相關程式碼...]
    n8{for &#40;i, chunk&#41; in enumerate&#40;retriev...}
    n9[logger.info&#40;&amp;&#35;39;     %d. %s - %s &#40;分數: %s...]
    n10[]
    n11[context_str = &amp;&#35;39;\n\n&amp;&#35;39;.join&#40;&#4...]
    n12[logger.info&#40;&amp;&#35;39;&#91;數值&#93; &#91;步驟 2/5&#93...]
    n13[query_hash = sum&#40;&#40;ord&#40;c&#41; for c in...]
    n14[context_hash = sum&#40;&#40;ord&#40;c&#41; for c in...]
    n15[seed = query_hash + context...]
    n16[np.random.seed&#40;seed&#41;]
    n17[query_embedding = np.random.randn&#40;512&#41;...]
    n18[logger.info&#40;&amp;&#35;39;   生成 512 維嵌入向量 &#40;種子: %d&...]
    n19[logger.info&#40;&amp;&#35;39;&#91;神經網路&#93; &#91;步驟 3/5&#...]
    n20[decision_logits = self.decision_core.f...]
    n21[logger.info&#40;&amp;&#35;39;   決策邏輯值範圍: &#91;%.2f, %.2f&...]
    n22[logger.info&#40;&amp;&#35;39;&#91;計算&#93; &#91;步驟 4/5&#93...]
    n23[&#40;_, confidence&#41; = self.anti_hallucinat...]
    n24[logger.info&#40;&amp;&#35;39;   信心度: %.2f%%&amp;&#35;39;,...]
    n25[logger.info&#40;&amp;&#35;39;   已停用信心度檢查,所有決策都會執行&amp;&#3...]
    n26[logger.info&#40;&amp;&#35;39;&#91;調整&#93; &#91;步驟 5/5&#93...]
    n27[chosen_tool_index = int&#40;np.argmax&#40;decisi...]
    n28[chosen_tool = self.tools&#91;chosen_to...]
    n29[chosen_tool_name = chosen_tool&#91;&amp;&#35;39;name&amp;...]
    n30[tool_confidence = float&#40;decision_logit...]
    n31[logger.info&#40;&amp;&#35;39;   選擇工具: %s&amp;&#35;39;, ch...]
    n32[logger.info&#40;&amp;&#35;39;   工具描述: %s&amp;&#35;39;, ch...]
    n33[logger.info&#40;&amp;&#35;39;   選擇信心度: %.2f%%&amp;&#35;39...]
    n34[tool_instance = self.tool_instances....]
    n35{if tool_instance}
    n36[logger.info&#40;&amp;&#35;39;   正在執行工具...&amp;&#35;39;&#41;]
    n37[tool_result = tool_instance.execut...]
    n38[logger.info&#40;&amp;&#35;39;   工具執行完成: %s&amp;&#35;39;, ...]
    n39[tool_result = &#123;&amp;&#35;39;status&amp;&#35;39;: &am...]
    n40[logger.error&#40;&amp;&#35;39;工具未實作: %s&amp;&#35;39;, cho...]
    n41[]
    n42[response = &#123;&amp;&#35;39;status&amp;&#35;39;: &amp;&...]
    n43[self.history.append&#40;response&#41;]
    n44[logger.info&#40;&amp;&#35;39;%s&amp;&#35;39;, &amp;&#35;3...]
    n45[logger.info&#40;&amp;&#35;39;&#91;已&#93; 任務完成!&amp;&#35;3...]
    n46[logger.info&#40;&amp;&#35;39;%s&amp;&#35;39;, &amp;&#35;3...]
    n47[return response]
    n1 --> n3
    n3 --> n4
    n4 --> n5
    n5 --> n6
    n6 --> n7
    n7 --> n8
    n8 -->|Yes| n9
    n8 -->|No| n10
    n9 --> n8
    n10 --> n11
    n11 --> n12
    n12 --> n13
    n13 --> n14
    n14 --> n15
    n15 --> n16
    n16 --> n17
    n17 --> n18
    n18 --> n19
    n19 --> n20
    n20 --> n21
    n21 --> n22
    n22 --> n23
    n23 --> n24
    n24 --> n25
    n25 --> n26
    n26 --> n27
    n27 --> n28
    n28 --> n29
    n29 --> n30
    n30 --> n31
    n31 --> n32
    n32 --> n33
    n33 --> n34
    n34 --> n35
    n35 -->|Yes| n36
    n35 -->|No| n39
    n36 --> n37
    n37 --> n38
    n38 --> n41
    n39 --> n40
    n40 --> n41
    n41 --> n42
    n42 --> n43
    n43 --> n44
    n44 --> n45
    n45 --> n46
    n46 --> n47
    n47 --> n2