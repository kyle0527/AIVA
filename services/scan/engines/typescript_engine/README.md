# AIVA TypeScript æƒæå¼•æ“ - å®Œæ•´ä½¿ç”¨æ‰‹å†Š

**å°èˆª**: [â† è¿”å› Scan ç¸½è¦½](../../README.md) | [ğŸ“Š å®Œæ•´æµç¨‹åœ–](../../SCAN_FLOW_DIAGRAMS.md) | [ğŸ”§ å¼•æ“æ¯”è¼ƒ](../ENGINE_COMPLETION_ANALYSIS.md)

**æ›´æ–°æ—¥æœŸ**: 2025-11-20  
**ç‰ˆæœ¬**: 1.0.0  
**æŠ€è¡“æ£§**: Node.js 20+ | TypeScript 5.3+ | Playwright 1.41+  
**ç•¶å‰ç‹€æ…‹**: ğŸŸ¡ **70% å®Œæˆ** - éœ€è¦ä¿®å¾©æ ¸å¿ƒå•é¡Œæ‰èƒ½å¯¦éš›é‹ä½œ

ä½¿ç”¨ Node.js + Playwright å¯¦ç¾çš„é«˜æ€§èƒ½å‹•æ…‹ç¶²é æƒæå¼•æ“ï¼Œå°ˆç‚º SPA æ‡‰ç”¨ã€AJAX è«‹æ±‚ã€WebSocket æª¢æ¸¬è¨­è¨ˆã€‚

---

## ğŸ“‹ ç›®éŒ„

### æ ¸å¿ƒèªªæ˜
- [âš ï¸ å¯¦éš›é‹ä½œéšœç¤™](#å¯¦éš›é‹ä½œéšœç¤™) - **å¿…è®€ï¼šç•¶å‰ç„¡æ³•ç›´æ¥ä½¿ç”¨**
- [ğŸ¯ åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [ğŸ“‹ ç’°å¢ƒè¦æ±‚](#ç’°å¢ƒè¦æ±‚)
- [ğŸš€ å¿«é€Ÿé–‹å§‹](#å¿«é€Ÿé–‹å§‹)
  - [æ­¥é©Ÿ 1: å®‰è£ä¾è³´](#æ­¥é©Ÿ-1-å®‰è£ä¾è³´)
  - [æ­¥é©Ÿ 2: ç·¨è­¯ TypeScript](#æ­¥é©Ÿ-2-ç·¨è­¯-typescript)
  - [æ­¥é©Ÿ 3: é…ç½®èªªæ˜](#æ­¥é©Ÿ-3-é…ç½®èªªæ˜)
  - [æ­¥é©Ÿ 4: å•Ÿå‹•å¼•æ“](#æ­¥é©Ÿ-4-å•Ÿå‹•å¼•æ“)

### æŠ€è¡“æ·±å…¥
- [ğŸ”„ é‹ä½œæµç¨‹](#é‹ä½œæµç¨‹)
  - [æµç¨‹åœ–ç¸½è¦½](#æµç¨‹åœ–ç¸½è¦½)
  - [æµç¨‹åœ– 1: ä»»å‹™æ¥æ”¶èˆ‡åˆå§‹åŒ–](#æµç¨‹åœ–-1-ä»»å‹™æ¥æ”¶èˆ‡åˆå§‹åŒ–)
  - [æµç¨‹åœ– 2: é é¢æƒææµç¨‹](#æµç¨‹åœ–-2-é é¢æƒææµç¨‹)
  - [æµç¨‹åœ– 3: ç¶²è·¯æ””æˆªæµç¨‹](#æµç¨‹åœ–-3-ç¶²è·¯æ””æˆªæµç¨‹)
  - [æµç¨‹åœ– 4: SPA æ¡†æ¶æª¢æ¸¬](#æµç¨‹åœ–-4-spa-æ¡†æ¶æª¢æ¸¬)
  - [æµç¨‹åœ– 5: è³‡ç”¢æ•´ç†èˆ‡ç™¼é€](#æµç¨‹åœ–-5-è³‡ç”¢æ•´ç†èˆ‡ç™¼é€)
  - [æ™‚åºåœ–è©³è§£](#æ™‚åºåœ–è©³è§£)
  - [æ•¸æ“šæµç¨‹è©³è§£](#æ•¸æ“šæµç¨‹è©³è§£)
- [ğŸ—ï¸ æ¶æ§‹è¨­è¨ˆ](#æ¶æ§‹è¨­è¨ˆ)
  - [ç³»çµ±æ¶æ§‹åœ–](#ç³»çµ±æ¶æ§‹åœ–)
  - [æ¨¡å¡Šæ¶æ§‹](#æ¨¡å¡Šæ¶æ§‹)
  - [é¡åˆ¥é—œä¿‚åœ–](#é¡åˆ¥é—œä¿‚åœ–)
  - [æ•¸æ“šæ¨¡å‹](#æ•¸æ“šæ¨¡å‹)

### é–‹ç™¼èˆ‡ç¶­è­·
- [ğŸ§ª æ¸¬è©¦é©—è­‰](#æ¸¬è©¦é©—è­‰)
- [ğŸ”§ æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [ğŸ“¦ ä¾è³´èªªæ˜](#ä¾è³´èªªæ˜) - **åŒ…å« node_modules å®Œæ•´åˆ†æï¼ˆ213 å¥—ä»¶ / 5,905 æª”æ¡ˆ / 100MBï¼‰**
- [ğŸ”— ç›¸é—œæ–‡ä»¶](#ç›¸é—œæ–‡ä»¶)
- [ğŸ“ æ”¹å–„è¨ˆåŠƒ](#æ”¹å–„è¨ˆåŠƒ)

---

## âš ï¸ å¯¦éš›é‹ä½œéšœç¤™

> **é‡è¦æç¤º**: æœ¬å¼•æ“ç•¶å‰**ç„¡æ³•ç›´æ¥ç”¨æ–¼æƒæçœŸå¯¦ç¶²é **ï¼Œéœ€è¦å®Œæˆä»¥ä¸‹ä¿®å¾©å·¥ä½œã€‚

### ğŸ”´ Critical å•é¡Œï¼ˆå¿…é ˆä¿®å¾©ï¼‰

#### 1. **RabbitMQ æ•´åˆæ¶æ§‹éŒ¯èª¤**
**å•é¡Œ**: Worker (Python) èˆ‡ Engine (Node.js) é€šä¿¡æ©Ÿåˆ¶ä¸åŒ¹é…
- âŒ Worker ä½¿ç”¨è‡¨æ™‚æ–‡ä»¶ (`AIVA_SCAN_TASK_FILE`) å‚³éä»»å‹™
- âŒ Engine è¨­è¨ˆç‚ºç›£è½ RabbitMQ éšŠåˆ— (`task.scan.dynamic`)
- âŒ Worker å•Ÿå‹• Node.js å­é€²ç¨‹å¾Œç«‹å³é€€å‡ºï¼Œç„¡æ³•ç²å–çµæœ

**å½±éŸ¿**: å®Œå…¨ç„¡æ³•æ¥æ”¶ä»»å‹™å’Œè¿”å›çµæœ

**ä¿®å¾©æ–¹æ¡ˆ**: é¸æ“‡ä»¥ä¸‹ä¹‹ä¸€
- æ–¹æ¡ˆ A: ä¿®æ”¹ Workerï¼Œæ”¹ç”¨ RabbitMQ ç™¼é€ä»»å‹™ï¼ˆæ¨è–¦ï¼Œç¬¦åˆæ¶æ§‹è¨­è¨ˆï¼‰
- æ–¹æ¡ˆ B: ä¿®æ”¹ Engineï¼Œæ”¹ç‚ºå–®æ¬¡åŸ·è¡Œæ¨¡å¼è®€å–æ–‡ä»¶

**å·¥ä½œé‡**: 2-3 å°æ™‚

---

#### 2. **éšŠåˆ—åç¨±ä¸çµ±ä¸€**
**å•é¡Œ**: Worker èˆ‡ Engine ç›£è½ä¸åŒçš„éšŠåˆ—
- Worker ç™¼é€åˆ°: `task.scan.phase1` (æ–°æ¨™æº–)
- Engine ç›£è½: `task.scan.dynamic` (èˆŠåç¨±)

**å½±éŸ¿**: ä»»å‹™æ°¸é ç„¡æ³•è¢«æ¥æ”¶

**ä¿®å¾©æ–¹æ¡ˆ**: çµ±ä¸€ä½¿ç”¨ `task.scan.phase1` å’Œ `results.scan.completed`

**å·¥ä½œé‡**: 30 åˆ†é˜

---

#### 3. **è³‡ç”¢æ ¼å¼ä¸åŒ¹é…**
**å•é¡Œ**: Engine è¼¸å‡ºæ ¼å¼èˆ‡ AIVA Common çš„ `Asset` é¡åˆ¥ä¸å®Œå…¨å…¼å®¹
- âŒ ç¼ºå°‘ `scan_id`ã€`discovered_at`ã€`confidence` ç­‰æ¬„ä½
- âŒ `metadata` çµæ§‹ä¸ç¬¦åˆ AIVA æ¨™æº–

**å½±éŸ¿**: ä¸‹æ¸¸è™•ç†æ¨¡å¡Šå¯èƒ½ç„¡æ³•æ­£ç¢ºè§£æè³‡ç”¢

**ä¿®å¾©æ–¹æ¡ˆ**: åƒè€ƒ `python/src/aiva/common/models/asset.py` èª¿æ•´æ ¼å¼

**å·¥ä½œé‡**: 1-2 å°æ™‚

---

### ğŸŸ¡ Medium å•é¡Œï¼ˆå»ºè­°ä¿®å¾©ï¼‰

- **å»é‡é‚è¼¯ä¸å®Œæ•´**: å¯èƒ½ç”¢ç”Ÿé‡è¤‡çš„ URL å’Œ API ç«¯é»
- **éŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶**: ç€è¦½å™¨å´©æ½°å¾Œç„¡æ³•è‡ªå‹•é‡è©¦
- **è¨˜æ†¶é«”ç®¡ç†**: é•·æ™‚é–“é‹è¡Œå¯èƒ½å°è‡´è¨˜æ†¶é«”æ´©æ¼

**å·¥ä½œé‡**: 2-3 å°æ™‚

---

### ğŸ“… ä¿®å¾©æ™‚ç¨‹ä¼°è¨ˆ

| éšæ®µ | å·¥ä½œå…§å®¹ | é è¨ˆæ™‚é–“ |
|------|---------|----------|
| **Phase 1** | ä¿®å¾© RabbitMQ æ•´åˆ | 2-3 å°æ™‚ |
| **Phase 2** | çµ±ä¸€éšŠåˆ—åç¨± | 30 åˆ†é˜ |
| **Phase 3** | èª¿æ•´è³‡ç”¢æ ¼å¼ | 1-2 å°æ™‚ |
| **Phase 4** | æ¸¬è©¦èˆ‡é©—è­‰ | 1 å°æ™‚ |
| **ç¸½è¨ˆ** | | **4-6 å°æ™‚** |

**è©³ç´°ä¿®å¾©è¨ˆåŠƒ**: è«‹åƒé–± [IMPROVEMENT_PLAN.md](./IMPROVEMENT_PLAN.md)

---

## ğŸ“ ç›®éŒ„

- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [ç’°å¢ƒè¦æ±‚](#ç’°å¢ƒè¦æ±‚)
- [å¿«é€Ÿé–‹å§‹](#å¿«é€Ÿé–‹å§‹)
- [é…ç½®èªªæ˜](#é…ç½®èªªæ˜)
- [ä½¿ç”¨æ–¹å¼](#ä½¿ç”¨æ–¹å¼)
- [é‹ä½œæµç¨‹](#é‹ä½œæµç¨‹)
- [æ¶æ§‹è¨­è¨ˆ](#æ¶æ§‹è¨­è¨ˆ)
- [æ¸¬è©¦é©—è­‰](#æ¸¬è©¦é©—è­‰)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [ä¾è³´èªªæ˜](#ä¾è³´èªªæ˜)

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### Phase1 æ·±åº¦æƒæèƒ½åŠ›
- âœ… **çœŸå¯¦ç€è¦½å™¨æ¸²æŸ“**: ä½¿ç”¨ Playwright Chromium å¼•æ“
- âœ… **SPA æ¡†æ¶æª¢æ¸¬**: Reactã€Vueã€Angularã€Svelte
- âœ… **å‹•æ…‹è·¯ç”±ç™¼ç¾**: History API ç›£è½ã€Hash è·¯ç”±æå–
- âœ… **AJAX æ””æˆª**: XHRã€Fetch API å®Œæ•´æ•ç²
- âœ… **WebSocket æª¢æ¸¬**: å¯¦æ™‚é€£æ¥ç›£æ§
- âœ… **è¡¨å–®èˆ‡è¼¸å…¥æ¡†**: è‡ªå‹•æå–æ‰€æœ‰äº’å‹•å…ƒç´ 
- âœ… **ç¶²è·¯è«‹æ±‚åˆ†æ**: API ç«¯é»è­˜åˆ¥ã€è«‹æ±‚æ¨¡å¼åˆ†æ
- âœ… **æ·±åº¦çˆ¬å–**: å¯é…ç½®æœ€å¤§æ·±åº¦å’Œé é¢æ•¸

---

## ğŸ“‹ ç’°å¢ƒè¦æ±‚

### å¿…éœ€ä¾è³´
- **Node.js**: >= 20.0.0
- **npm**: >= 10.0.0
- **RabbitMQ**: 3.12+ (é‹è¡Œä¸­)
- **Python**: 3.11+ (ç”¨æ–¼ worker.py)

### ç³»çµ±è¦æ±‚
- **è¨˜æ†¶é«”**: >= 2GB (Chromium éœ€è¦)
- **ç£ç¢Ÿ**: >= 500MB (Playwright ç€è¦½å™¨)
- **ä½œæ¥­ç³»çµ±**: Windows 10+, Linux, macOS

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### æ­¥é©Ÿ 1: å®‰è£ä¾è³´

```powershell
# é€²å…¥ TypeScript å¼•æ“ç›®éŒ„
cd C:\D\fold7\AIVA-git\services\scan\engines\typescript_engine

# å®‰è£ Node.js ä¾è³´
npm install

# å®‰è£ Playwright Chromium ç€è¦½å™¨
npm run install:browsers
```

### æ­¥é©Ÿ 2: ç·¨è­¯ TypeScript

```powershell
# ç·¨è­¯ç‚º JavaScript (è¼¸å‡ºåˆ° dist/)
npm run build

# é©—è­‰ç·¨è­¯ç”¢ç‰©
ls dist\index.js
```

**é æœŸè¼¸å‡º**:
```
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a---         2025/11/18   ä¸‹åˆ 2:30      10240 index.js
```

### æ­¥é©Ÿ 3: é…ç½®èªªæ˜

**ç ”ç™¼éšæ®µç„¡éœ€é…ç½®**ï¼šæ‰€æœ‰é€£æ¥ä½¿ç”¨é è¨­å€¼ï¼Œé–‹ç®±å³ç”¨ã€‚

é è¨­é…ç½®ï¼š
```javascript
// è‡ªå‹•ä½¿ç”¨ä»¥ä¸‹é è¨­å€¼
RABBITMQ_URL = "amqp://guest:guest@localhost:5672/"
TASK_QUEUE = "task.scan.dynamic"
RESULT_QUEUE = "findings.new"
// ç„¡éœ€è¨­ç½®ä»»ä½•ç’°å¢ƒè®Šæ•¸
```

**ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²æ™‚**ï¼ˆæœªä¾†ï¼‰æ‰éœ€è¦è¦†è“‹ï¼š
```bash
# åªéœ€è¨­ç½®ä¸€å€‹ç’°å¢ƒè®Šæ•¸
export RABBITMQ_URL="amqp://prod_user:password@prod-host:5672/"
```

### æ­¥é©Ÿ 4: å•Ÿå‹•å¼•æ“

**é¸é … A: ç›´æ¥å•Ÿå‹• Node.js** (ç¨ç«‹æ¨¡å¼)
```powershell
# å¿…é ˆåœ¨ typescript_engine ç›®éŒ„ä¸‹åŸ·è¡Œ
cd C:\D\fold7\AIVA-git\services\scan\engines\typescript_engine

# ç›´æ¥å•Ÿå‹•ï¼ˆç„¡éœ€è¨­ç½®ç’°å¢ƒè®Šæ•¸ï¼‰
node dist/index.js
```
```

**é¸é … B: é€šé Python Worker** (æ¨è–¦ï¼Œæ•´åˆæ¨¡å¼)
```powershell
# å¾å°ˆæ¡ˆæ ¹ç›®éŒ„åŸ·è¡Œ
cd C:\D\fold7\AIVA-git
$env:PYTHONPATH="C:\D\fold7\AIVA-git"

# å•Ÿå‹• Python Worker (æœƒè‡ªå‹•èª¿ç”¨ Node.js)
python -m services.scan.engines.typescript_engine.worker
```

---

## âš™ï¸ é…ç½®èªªæ˜

### ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸ | èªªæ˜ | é è¨­å€¼ | å¿…è¦æ€§ |
|------|------|--------|--------|
| `RABBITMQ_URL` | RabbitMQ é€£æ¥ URL | `amqp://guest:guest@localhost:5672/` | âŒ é–‹ç™¼ç’°å¢ƒå¯é¸ |
| `LOG_LEVEL` | æ—¥èªŒç´šåˆ¥ | `info` | âŒ å¯é¸ |

**ç ”ç™¼éšæ®µ**ï¼šç„¡éœ€è¨­ç½®ä»»ä½•ç’°å¢ƒè®Šæ•¸ï¼Œç›´æ¥ä½¿ç”¨é è¨­å€¼ã€‚

**ç”Ÿç”¢ç’°å¢ƒ**ï¼š
```bash
# Linux/macOS
export RABBITMQ_URL="amqp://prod_user:password@prod-host:5672/"
export LOG_LEVEL="warn"

# Windows PowerShell
$env:RABBITMQ_URL="amqp://prod_user:password@prod-host:5672/"
$env:LOG_LEVEL="warn"
```

---

## ğŸ“– ä½¿ç”¨æ–¹å¼

### 1. é–‹ç™¼æ¨¡å¼

```powershell
# ç†±é‡è¼‰é–‹ç™¼ (ä¿®æ”¹ä»£ç¢¼è‡ªå‹•é‡å•Ÿ)
npm run dev
```

### 2. ç”Ÿç”¢æ¨¡å¼

```powershell
# ç·¨è­¯
npm run build

# å•Ÿå‹• (éœ€è¦ç’°å¢ƒè®Šæ•¸)
npm start
```

### 3. ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥

```powershell
# ESLint æª¢æŸ¥
npm run lint

# Prettier æ ¼å¼åŒ–
npm run format
```

```powershell
# Prettier æ ¼å¼åŒ–
npm run format
```

---

## ğŸ”„ é‹ä½œæµç¨‹

### æµç¨‹åœ–ç¸½è¦½

```mermaid
graph TB
    Start([é–‹å§‹æƒæ]) --> Init[åˆå§‹åŒ–å¼•æ“]
    Init --> Browser[å•Ÿå‹• Chromium]
    Browser --> Listen[ç›£è½ RabbitMQ]
    Listen --> Receive{æ”¶åˆ°ä»»å‹™?}
    Receive -->|å¦| Listen
    Receive -->|æ˜¯| Parse[è§£æä»»å‹™]
    Parse --> CreateContext[å‰µå»ºç€è¦½å™¨ä¸Šä¸‹æ–‡]
    CreateContext --> SetupInterceptor[è¨­ç½®ç¶²è·¯æ””æˆªå™¨]
    SetupInterceptor --> Loop{é‚„æœ‰ URL?}
    
    Loop -->|æ˜¯| Navigate[å°èˆªåˆ°é é¢]
    Navigate --> Wait[ç­‰å¾…é é¢è¼‰å…¥]
    Wait --> CheckSPA{æª¢æ¸¬ SPA?}
    
    CheckSPA -->|æ˜¯| ExtractRoutes[æå– SPA è·¯ç”±]
    CheckSPA -->|å¦| ExtractAssets[æå–æ¨™æº–è³‡ç”¢]
    ExtractRoutes --> ExtractAssets
    
    ExtractAssets --> Forms[æå–è¡¨å–®]
    Forms --> Inputs[æå–è¼¸å…¥æ¡†]
    Inputs --> Links[æå–é€£çµ]
    Links --> APIs[åˆ†æ API ç«¯é»]
    APIs --> WebSocket[æª¢æ¸¬ WebSocket]
    WebSocket --> CheckDepth{æ·±åº¦ < æœ€å¤§?}
    
    CheckDepth -->|æ˜¯| AddQueue[é€£çµåŠ å…¥éšŠåˆ—]
    CheckDepth -->|å¦| NextURL[ä¸‹ä¸€å€‹ URL]
    AddQueue --> NextURL
    NextURL --> Loop
    
    Loop -->|å¦| Aggregate[æ•´ç†è³‡ç”¢]
    Aggregate --> Dedupe[å»é™¤é‡è¤‡]
    Dedupe --> Classify[åˆ†é¡è³‡ç”¢]
    Classify --> GenerateReport[ç”Ÿæˆå ±å‘Š]
    GenerateReport --> SendResult[ç™¼é€çµæœåˆ° RabbitMQ]
    SendResult --> Cleanup[æ¸…ç†è³‡æº]
    Cleanup --> End([çµæŸ])
    
    style Start fill:#90EE90
    style End fill:#FFB6C1
    style CheckSPA fill:#FFD700
    style CheckDepth fill:#FFD700
    style Receive fill:#FFD700
    style Loop fill:#FFD700
```

---

### å®Œæ•´æƒææµç¨‹åœ–ï¼ˆæ™‚åºåœ–ï¼‰

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ¶/API
    participant RMQ as RabbitMQ
    participant Worker as Python Worker
    participant Node as Node.js Service
    participant Browser as Playwright Browser
    participant Target as ç›®æ¨™ç¶²ç«™

    User->>RMQ: 1. ç™¼é€æƒæä»»å‹™<br/>(task.scan.phase1)
    Note over RMQ: ä»»å‹™å…§å®¹:<br/>- scan_id<br/>- targets[]<br/>- max_depth<br/>- selected_engines
    
    RMQ->>Node: 2. æ¨é€ä»»å‹™åˆ° Node.js
    Note over Node: Node.js æŒçºŒç›£è½<br/>task.scan.phase1 éšŠåˆ—
    
    Node->>Node: 3. è§£æä»»å‹™
    Note over Node: æå–ç›®æ¨™ URL<br/>é…ç½®æƒæåƒæ•¸
    
    Node->>Browser: 4. å•Ÿå‹• Chromium
    Browser-->>Node: ç€è¦½å™¨å°±ç·’
    
    Node->>Browser: 5. å‰µå»ºé é¢ä¸Šä¸‹æ–‡
    Note over Browser: - è¨­ç½® viewport<br/>- é…ç½® User-Agent<br/>- å•Ÿå‹•ç¶²è·¯æ””æˆª
    
    loop å°æ¯å€‹ç›®æ¨™ URL
        Node->>Browser: 6. å°èˆªåˆ°ç›®æ¨™
        Browser->>Target: HTTP GET Request
        Target-->>Browser: HTML Response
        
        Browser->>Browser: 7. åŸ·è¡Œ JavaScript
        Note over Browser: - æ¸²æŸ“ DOM<br/>- åŸ·è¡Œè…³æœ¬<br/>- è§¸ç™¼äº‹ä»¶
        
        Browser->>Node: 8. æ””æˆªç¶²è·¯è«‹æ±‚
        Note over Node: è¨˜éŒ„:<br/>- XHR/Fetch<br/>- API èª¿ç”¨<br/>- WebSocket
        
        Node->>Browser: 9. æª¢æ¸¬ SPA æ¡†æ¶
        Note over Browser: æª¢æŸ¥:<br/>- React<br/>- Vue<br/>- Angular
        
        alt æª¢æ¸¬åˆ° SPA
            Node->>Browser: 10a. æå– SPA è·¯ç”±
            Note over Browser: ç›£è½ History API<br/>æå– Hash è·¯ç”±
        end
        
        Node->>Browser: 11. æå–é é¢è³‡ç”¢
        Note over Browser: æå–:<br/>- è¡¨å–® (forms)<br/>- è¼¸å…¥æ¡† (inputs)<br/>- é€£çµ (links)
        
        Node->>Browser: 12. æå–é€£çµ
        Browser-->>Node: è¿”å›åŒåŸŸé€£çµåˆ—è¡¨
        
        alt æ·±åº¦ < max_depth
            Node->>Node: 13. å°‡é€£çµåŠ å…¥éšŠåˆ—
            Note over Node: æº–å‚™ä¸‹ä¸€è¼ªæƒæ
        end
    end
    
    Node->>Node: 14. æ•´ç†æƒæçµæœ
    Note over Node: åˆ†é¡è³‡ç”¢:<br/>- SPA è·¯ç”±<br/>- API ç«¯é»<br/>- è¡¨å–®<br/>- WebSocket
    
    Node->>Node: 15. ç”Ÿæˆæƒæå ±å‘Š
    Note over Node: çµ±è¨ˆ:<br/>- é é¢æ•¸<br/>- è³‡ç”¢æ•¸<br/>- åŸ·è¡Œæ™‚é–“
    
    Node->>RMQ: 16. ç™¼é€çµæœ<br/>(findings.new)
    Note over RMQ: çµæœåŒ…å«:<br/>- assets[]<br/>- metadata<br/>- vulnerabilities[]
    
    RMQ->>User: 17. è¿”å›æƒæçµæœ
    
    Node->>Browser: 18. æ¸…ç†è³‡æº
    Browser-->>Node: é—œé–‰ç€è¦½å™¨
```

---

### æ•¸æ“šæµç¨‹è©³è§£

#### æµç¨‹åœ– 1: ä»»å‹™æ¥æ”¶èˆ‡åˆå§‹åŒ–

```mermaid
flowchart LR
    A[RabbitMQ ä»»å‹™] --> B{è§£æ JSON}
    B --> C[æå– scan_id]
    B --> D[æå– targets]
    B --> E[æå– max_depth]
    C --> F[å‰µå»º ScanTask]
    D --> F
    E --> F
    F --> G[å•Ÿå‹• Chromium]
    G --> H[å‰µå»º BrowserContext]
    H --> I[å‰µå»º Page]
    I --> J[è¨­ç½®æ””æˆªå™¨]
    J --> K[é–‹å§‹æƒæ]
    
    style A fill:#E1F5FF
    style K fill:#C8E6C9
```

---

#### æµç¨‹åœ– 2: é é¢æƒææµç¨‹

```mermaid
flowchart TD
    A[é é¢ URL] --> B[page.goto]
    B --> C{è¼‰å…¥æˆåŠŸ?}
    C -->|å¦| D[è¨˜éŒ„éŒ¯èª¤]
    C -->|æ˜¯| E[ç­‰å¾… networkidle]
    E --> F[åŸ·è¡Œ JavaScript]
    F --> G{æª¢æ¸¬ SPA?}
    
    G -->|æ˜¯ React| H1[æå– React Router]
    G -->|æ˜¯ Vue| H2[æå– Vue Router]
    G -->|æ˜¯ Angular| H3[æå– Angular Router]
    G -->|å¦| H4[æ¨™æº–çˆ¬å–]
    
    H1 --> I[ç›£è½ History API]
    H2 --> I
    H3 --> I
    H4 --> I
    
    I --> J[æå–è¡¨å–®]
    J --> K[æå–è¼¸å…¥æ¡†]
    K --> L[æå–é€£çµ]
    L --> M[æå– API ç«¯é»]
    M --> N[æª¢æ¸¬ WebSocket]
    N --> O{æ·±åº¦æª¢æŸ¥}
    
    O -->|< max_depth| P[é€£çµå…¥éšŠ]
    O -->|>= max_depth| Q[è·³éé€£çµ]
    
    P --> R[è¿”å›è³‡ç”¢]
    Q --> R
    D --> R
    
    style A fill:#FFF9C4
    style R fill:#C8E6C9
    style G fill:#FFE082
    style O fill:#FFE082
```

---

#### æµç¨‹åœ– 3: ç¶²è·¯æ””æˆªæµç¨‹

```mermaid
flowchart TB
    Start[å•Ÿå‹•æ””æˆª] --> Listen[ç›£è½ Page äº‹ä»¶]
    Listen --> Req[on request]
    Listen --> Res[on response]
    Listen --> WS[on websocket]
    Listen --> Fail[on requestfailed]
    
    Req --> ReqLog[è¨˜éŒ„è«‹æ±‚]
    ReqLog --> ReqData{è«‹æ±‚é¡å‹?}
    ReqData -->|XHR| XHR[æ¨™è¨˜ç‚º AJAX]
    ReqData -->|Fetch| Fetch[æ¨™è¨˜ç‚º API]
    ReqData -->|WebSocket| WSMark[æ¨™è¨˜ç‚º WS]
    ReqData -->|å…¶ä»–| Other[æ¨™è¨˜ç‚º Other]
    
    Res --> ResLog[è¨˜éŒ„éŸ¿æ‡‰]
    ResLog --> ResData[ä¿å­˜ç‹€æ…‹ç¢¼]
    ResData --> ResHeaders[ä¿å­˜éŸ¿æ‡‰é ­]
    
    WS --> WSLog[è¨˜éŒ„ WS URL]
    WSLog --> WSFrame[ç›£è½ frame]
    
    Fail --> FailLog[è¨˜éŒ„å¤±æ•—]
    
    XHR --> Store[å­˜å…¥ requests]
    Fetch --> Store
    WSMark --> Store
    Other --> Store
    ResHeaders --> Store
    WSFrame --> Store
    FailLog --> Store
    
    Store --> Analysis[åˆ†æè«‹æ±‚æ¨¡å¼]
    Analysis --> Filter{éæ¿¾å™¨}
    Filter -->|API| APIList[API ç«¯é»åˆ—è¡¨]
    Filter -->|AJAX| AJAXList[AJAX è«‹æ±‚åˆ—è¡¨]
    Filter -->|WebSocket| WSList[WebSocket åˆ—è¡¨]
    
    style Start fill:#90EE90
    style Store fill:#FFE082
    style Analysis fill:#FFD700
```

---

#### æµç¨‹åœ– 4: SPA æ¡†æ¶æª¢æ¸¬

```mermaid
flowchart TD
    Start[é–‹å§‹æª¢æ¸¬] --> Eval[page.evaluate]
    Eval --> CheckReact{React?}
    
    CheckReact -->|æ˜¯| React[æª¢æ¸¬åˆ° React]
    CheckReact -->|å¦| CheckVue{Vue?}
    
    CheckVue -->|æ˜¯| Vue[æª¢æ¸¬åˆ° Vue]
    CheckVue -->|å¦| CheckAngular{Angular?}
    
    CheckAngular -->|æ˜¯| Angular[æª¢æ¸¬åˆ° Angular]
    CheckAngular -->|å¦| CheckSvelte{Svelte?}
    
    CheckSvelte -->|æ˜¯| Svelte[æª¢æ¸¬åˆ° Svelte]
    CheckSvelte -->|å¦| CheckGeneric{é€šç”¨ SPA?}
    
    CheckGeneric -->|æ˜¯| Generic[æœªçŸ¥ SPA]
    CheckGeneric -->|å¦| NotSPA[é SPA]
    
    React --> ExtractR[æå– React Router]
    Vue --> ExtractV[æå– Vue Router]
    Angular --> ExtractA[æå– Angular Router]
    Svelte --> ExtractS[æª¢æŸ¥è·¯ç”±é…ç½®]
    Generic --> ExtractG[ç›£è½ History API]
    NotSPA --> Standard[æ¨™æº–éˆæ¥çˆ¬å–]
    
    ExtractR --> Routes[è·¯ç”±åˆ—è¡¨]
    ExtractV --> Routes
    ExtractA --> Routes
    ExtractS --> Routes
    ExtractG --> Routes
    Standard --> End[å®Œæˆ]
    
    Routes --> Inject[æ³¨å…¥ç›£è½å™¨]
    Inject --> Monitor[ç›£è½è·¯ç”±è®ŠåŒ–]
    Monitor --> End
    
    style Start fill:#E1F5FF
    style End fill:#C8E6C9
    style Routes fill:#FFE082
```

---

#### æµç¨‹åœ– 5: è³‡ç”¢æ•´ç†èˆ‡ç™¼é€

```mermaid
flowchart LR
    A[åŸå§‹è³‡ç”¢] --> B[è¡¨å–®è³‡ç”¢]
    A --> C[ç¶²è·¯è³‡ç”¢]
    A --> D[SPA è³‡ç”¢]
    A --> E[WebSocket è³‡ç”¢]
    
    B --> F[åˆä½µ]
    C --> F
    D --> F
    E --> F
    
    F --> G{å»é‡}
    G --> H[æŒ‰é¡å‹åˆ†çµ„]
    H --> I[form çµ„]
    H --> J[api çµ„]
    H --> K[spa_route çµ„]
    H --> L[websocket çµ„]
    
    I --> M[æ·»åŠ  metadata]
    J --> M
    K --> M
    L --> M
    
    M --> N[ç”Ÿæˆçµ±è¨ˆ]
    N --> O[pages_scanned]
    N --> P[duration_seconds]
    N --> Q[spa_detected]
    N --> R[ajax_requests_found]
    
    O --> S[çµ„è£çµæœ]
    P --> S
    Q --> S
    R --> S
    M --> S
    
    S --> T[åºåˆ—åŒ– JSON]
    T --> U[ç™¼é€åˆ° RabbitMQ]
    
    style A fill:#E1F5FF
    style U fill:#C8E6C9
    style G fill:#FFE082
```

---

#### éšæ®µ 1: ä»»å‹™æ¥æ”¶ (æ­¥é©Ÿ 1-3)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RabbitMQ Message (JSON)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                               â”‚
â”‚   "scan_id": "scan-001",                        â”‚
â”‚   "targets": ["http://localhost:3000"],        â”‚
â”‚   "max_depth": 3,                               â”‚
â”‚   "max_pages": 100,                             â”‚
â”‚   "enable_javascript": true                     â”‚
â”‚ }                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node.js Service (index.ts)                      â”‚
â”‚ - consumeTasks() ç›£è½éšŠåˆ—                        â”‚
â”‚ - è§£æ JSON ç‚º ScanTask å°è±¡                     â”‚
â”‚ - èª¿ç”¨ scanService.scan(task)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### éšæ®µ 2: ç€è¦½å™¨åˆå§‹åŒ– (æ­¥é©Ÿ 4-5)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ScanService.scan()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser Context Creation                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ const context = await browser.newContextâ”‚
â”‚ ({                                       â”‚
â”‚   viewport: { width: 1920, height: 1080}â”‚
â”‚   userAgent: "AIVA-Scanner/1.0"         â”‚
â”‚ });                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Page Creation & Interception Setup       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. const page = await context.newPage() â”‚
â”‚ 2. networkInterceptor.startInterception()â”‚
â”‚ 3. setupWebSocketMonitoring()           â”‚
â”‚ 4. setupSpaMonitoring()                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### éšæ®µ 3: é é¢æƒæ (æ­¥é©Ÿ 6-13)

```
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ è¨ªå•é é¢     â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                 â”‚
        â†“                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DOM è§£æ      â”‚              â”‚ ç¶²è·¯è«‹æ±‚æ””æˆª      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - æå–è¡¨å–®    â”‚              â”‚ - XHR/Fetch      â”‚
â”‚ - æå–è¼¸å…¥æ¡†  â”‚              â”‚ - API ç«¯é»       â”‚
â”‚ - æå–é€£çµ    â”‚              â”‚ - WebSocket      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ SPA æ¡†æ¶æª¢æ¸¬     â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚ - React?        â”‚
          â”‚ - Vue?          â”‚
          â”‚ - Angular?      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
            â”‚ æ˜¯ SPA?     â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“ Yes               â†“ No
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æå– SPA è·¯ç”±   â”‚    â”‚ ç¹¼çºŒæ¨™æº–çˆ¬å–    â”‚
â”‚ - History API  â”‚    â”‚ - æå–é€£çµ      â”‚
â”‚ - Hash è·¯ç”±    â”‚    â”‚ - åŠ å…¥éšŠåˆ—      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### éšæ®µ 4: çµæœæ•´ç† (æ­¥é©Ÿ 14-17)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŸå§‹è³‡ç”¢æ”¶é›†                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ è¡¨å–®è³‡ç”¢  â”‚ â”‚ ç¶²è·¯è³‡ç”¢  â”‚ â”‚ SPA è³‡ç”¢ â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è³‡ç”¢åˆ†é¡èˆ‡å»é‡                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - æŒ‰é¡å‹åˆ†é¡ (form/api/spa_route/websocket)   â”‚
â”‚ - å»é™¤é‡è¤‡é …                                   â”‚
â”‚ - æ·»åŠ  metadata                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”Ÿæˆæƒæçµæœ                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                              â”‚
â”‚   scan_id: "scan-001",                         â”‚
â”‚   assets: [...],                               â”‚
â”‚   vulnerabilities: [],                         â”‚
â”‚   metadata: {                                  â”‚
â”‚     pages_scanned: 15,                         â”‚
â”‚     duration_seconds: 18.5,                    â”‚
â”‚     spa_detected: true,                        â”‚
â”‚     websockets_found: 1,                       â”‚
â”‚     ajax_requests_found: 23                    â”‚
â”‚   }                                            â”‚
â”‚ }                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç™¼é€åˆ° RabbitMQ (findings.new)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ æ¶æ§‹è¨­è¨ˆ

### ç³»çµ±æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AIVA ç³»çµ±                             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   Web API    â”‚         â”‚   Scan CLI   â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â”‚                        â”‚                          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                      â†“                                       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚         â”‚   RabbitMQ Broker      â”‚                          â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                          â”‚
â”‚         â”‚  â”‚ task.scan.phase1 â”‚  â”‚  â† ä»»å‹™éšŠåˆ—              â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                          â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                          â”‚
â”‚         â”‚  â”‚   findings.new   â”‚  â”‚  â† çµæœéšŠåˆ—              â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                 â”‚                                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚     â†“           â†“           â†“               â†“              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ Python â”‚ â”‚  Rust  â”‚ â”‚   Go   â”‚ â”‚   TypeScript     â”‚     â”‚
â”‚ â”‚ Worker â”‚ â”‚ Worker â”‚ â”‚ Worker â”‚ â”‚   Worker         â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                              â”‚              â”‚
â”‚                                              â†“              â”‚
â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                                  â”‚  Node.js Service      â”‚ â”‚
â”‚                                  â”‚  (TypeScript Engine)  â”‚ â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â†“
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   Playwright Framework     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â†“
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   Chromium Browser         â”‚
                              â”‚  - JavaScript Engine       â”‚
                              â”‚  - Network Interceptor     â”‚
                              â”‚  - DOM Manipulation        â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â†“
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚     Target Website         â”‚
                              â”‚  (Juice Shop, DVWA, etc)   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ¨¡å¡Šæ¶æ§‹

```
typescript_engine/
â”‚
â”œâ”€â”€ src/                          # TypeScript æºä»£ç¢¼
â”‚   â”œâ”€â”€ index.ts                  # ğŸšª ä¸»å…¥å£ - RabbitMQ ç›£è½
â”‚   â”‚   â”œâ”€â†’ é€£æ¥ RabbitMQ
â”‚   â”‚   â”œâ”€â†’ å•Ÿå‹• Chromium
â”‚   â”‚   â”œâ”€â†’ ç›£è½ä»»å‹™éšŠåˆ—
â”‚   â”‚   â””â”€â†’ èª¿ç”¨ ScanService
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                 # æ ¸å¿ƒæœå‹™
â”‚   â”‚   â”œâ”€â”€ scan-service.ts       # ğŸ” æƒææœå‹™ (440 è¡Œ)
â”‚   â”‚   â”‚   â”œâ”€â†’ é é¢å°èˆª
â”‚   â”‚   â”‚   â”œâ”€â†’ SPA æª¢æ¸¬
â”‚   â”‚   â”‚   â”œâ”€â†’ è³‡ç”¢æå–
â”‚   â”‚   â”‚   â”œâ”€â†’ é€£çµçˆ¬å–
â”‚   â”‚   â”‚   â””â”€â†’ çµæœæ•´åˆ
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ network-interceptor.service.ts  # ğŸŒ ç¶²è·¯æ””æˆª
â”‚   â”‚   â”‚   â”œâ”€â†’ Request ç›£è½
â”‚   â”‚   â”‚   â”œâ”€â†’ Response ç›£è½
â”‚   â”‚   â”‚   â”œâ”€â†’ API ç«¯é»è­˜åˆ¥
â”‚   â”‚   â”‚   â””â”€â†’ AJAX è«‹æ±‚éæ¿¾
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ enhanced-content-extractor.service.ts  # ğŸ“„ å…§å®¹æå–
â”‚   â”‚   â”‚   â”œâ”€â†’ è¡¨å–®æå–
â”‚   â”‚   â”‚   â”œâ”€â†’ è¼¸å…¥æ¡†è­˜åˆ¥
â”‚   â”‚   â”‚   â”œâ”€â†’ äº‹ä»¶è™•ç†å™¨
â”‚   â”‚   â”‚   â””â”€â†’ API ç«¯é»åˆ†æ
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ interaction-simulator.service.ts  # ğŸ–±ï¸ äº’å‹•æ¨¡æ“¬
â”‚   â”‚       â”œâ”€â†’ é»æ“Šæ“ä½œ
â”‚   â”‚       â”œâ”€â†’ è¼¸å…¥æ¨¡æ“¬
â”‚   â”‚       â”œâ”€â†’ æ»¾å‹•è§¸ç™¼
â”‚   â”‚       â””â”€â†’ æ‡¸åœæ“ä½œ
â”‚   â”‚
â”‚   â”œâ”€â”€ interfaces/               # TypeScript ä»‹é¢
â”‚   â”‚   â””â”€â”€ dynamic-scan.interfaces.ts
â”‚   â”‚       â”œâ”€â†’ ScanTask
â”‚   â”‚       â”œâ”€â†’ Asset
â”‚   â”‚       â”œâ”€â†’ ScanResult
â”‚   â”‚       â””â”€â†’ NetworkRequest
â”‚   â”‚
â”‚   â””â”€â”€ utils/                    # å·¥å…·å‡½æ•¸
â”‚       â””â”€â”€ logger.ts             # ğŸ“ Pino æ—¥èªŒé…ç½®
â”‚
â”œâ”€â”€ dist/                         # ç·¨è­¯ç”¢ç‰© (JavaScript)
â”‚   â”œâ”€â”€ index.js                  # ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ index.js.map             # Source Map
â”‚   â”œâ”€â”€ services/                # ç·¨è­¯å¾Œçš„æœå‹™
â”‚   â””â”€â”€ utils/                   # ç·¨è­¯å¾Œçš„å·¥å…·
â”‚
â”œâ”€â”€ worker.py                     # ğŸ Python Worker (æ•´åˆå±¤)
â”‚   â”œâ”€â†’ è¨‚é–± task.scan.phase1
â”‚   â”œâ”€â†’ å•Ÿå‹• Node.js å­é€²ç¨‹
â”‚   â”œâ”€â†’ è§£ææƒæçµæœ
â”‚   â””â”€â†’ ç™¼é€åˆ° results.scan.completed
â”‚
â”œâ”€â”€ test_typescript_engine.py    # ğŸ§ª æ¸¬è©¦è…³æœ¬
â”œâ”€â”€ package.json                 # ğŸ“¦ Node.js é…ç½®
â”œâ”€â”€ tsconfig.json                # âš™ï¸ TypeScript é…ç½®
â”œâ”€â”€ .eslintrc.json              # ğŸ” ESLint é…ç½®
â””â”€â”€ README.md                    # ğŸ“– æœ¬æ–‡ä»¶
```

---

### é¡åˆ¥é—œä¿‚åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     index.ts                             â”‚
â”‚  (Main Entry Point)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - getRabbitMQURL(): string                             â”‚
â”‚  + initialize(): Promise<void>                          â”‚
â”‚  + consumeTasks(): Promise<void>                        â”‚
â”‚  + shutdown(): Promise<void>                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ creates
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ScanService                                 â”‚
â”‚  (Core Scanning Logic)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - browser: Browser                                      â”‚
â”‚  - networkInterceptor: NetworkInterceptor               â”‚
â”‚  + scan(task: ScanTask): Promise<ScanResult>           â”‚
â”‚  - extractAssets(page): Promise<Asset[]>               â”‚
â”‚  - extractLinks(page, baseUrl): Promise<string[]>      â”‚
â”‚  - detectSpaFramework(page): Promise<SpaInfo>          â”‚
â”‚  - extractSpaRoutes(page): Promise<string[]>           â”‚
â”‚  - setupWebSocketMonitoring(page): void                â”‚
â”‚  - setupSpaMonitoring(page): Promise<string[]>         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ uses
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           NetworkInterceptor                             â”‚
â”‚  (Network Request Interception)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - requests: NetworkRequest[]                           â”‚
â”‚  - isActive: boolean                                    â”‚
â”‚  + startInterception(page): Promise<void>              â”‚
â”‚  + stopInterception(): NetworkRequest[]                â”‚
â”‚  + getApiRequests(): NetworkRequest[]                  â”‚
â”‚  + getAjaxRequests(): NetworkRequest[]                 â”‚
â”‚  + getWebSocketRequests(): NetworkRequest[]            â”‚
â”‚  + analyzeRequestPatterns(): RequestAnalysis           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        â”‚ monitors
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Playwright Page                             â”‚
â”‚  (Browser Context)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Events:                                                â”‚
â”‚  â€¢ on('request')     â†’ æ””æˆªè«‹æ±‚                         â”‚
â”‚  â€¢ on('response')    â†’ æ””æˆªéŸ¿æ‡‰                         â”‚
â”‚  â€¢ on('websocket')   â†’ WebSocket é€£æ¥                   â”‚
â”‚  â€¢ on('console')     â†’ æ§åˆ¶å°è¼¸å‡º                       â”‚
â”‚  â€¢ on('pageerror')   â†’ é é¢éŒ¯èª¤                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ•¸æ“šæ¨¡å‹

```typescript
// æƒæä»»å‹™
interface ScanTask {
  scan_id: string;           // æƒæ ID
  target_url: string;        // ç›®æ¨™ URL
  max_depth: number;         // æœ€å¤§æ·±åº¦
  max_pages: number;         // æœ€å¤§é é¢æ•¸
  enable_javascript: boolean; // å•Ÿç”¨ JS
}

// è³‡ç”¢
interface Asset {
  type: string;              // é¡å‹ (form/api/spa_route/websocket)
  value: string;             // å€¼ (URL/åç¨±)
  metadata: {                // å…ƒæ•¸æ“š
    url?: string;            // æ‰€åœ¨é é¢
    method?: string;         // HTTP æ–¹æ³•
    framework?: string;      // SPA æ¡†æ¶
    [key: string]: any;      // å…¶ä»–å±¬æ€§
  };
}

// æƒæçµæœ
interface ScanResult {
  scan_id: string;           // æƒæ ID
  assets: Asset[];           // ç™¼ç¾çš„è³‡ç”¢
  vulnerabilities: any[];    // æ¼æ´ (Phase2)
  metadata: {                // å…ƒæ•¸æ“š
    pages_scanned: number;   // æƒæé é¢æ•¸
    duration_seconds: number; // åŸ·è¡Œæ™‚é–“
    start_time: string;      // é–‹å§‹æ™‚é–“
    end_time: string;        // çµæŸæ™‚é–“
    spa_detected: boolean;   // æ˜¯å¦ SPA
    websockets_found: number;// WebSocket æ•¸
    ajax_requests_found: number; // AJAX è«‹æ±‚æ•¸
  };
}

// ç¶²è·¯è«‹æ±‚
interface NetworkRequest {
  url: string;               // è«‹æ±‚ URL
  method: string;            // HTTP æ–¹æ³•
  headers: object;           // è«‹æ±‚é ­
  post_data?: string;        // POST æ•¸æ“š
  timestamp: number;         // æ™‚é–“æˆ³
  response_status?: number;  // éŸ¿æ‡‰ç‹€æ…‹ç¢¼
  response_headers?: object; // éŸ¿æ‡‰é ­
}
```

---

## ğŸ§ª æ¸¬è©¦é©—è­‰

### æ¸¬è©¦ 1: é©—è­‰ç’°å¢ƒé…ç½®

```powershell
# 1. æª¢æŸ¥ Node.js ç‰ˆæœ¬
node --version
# é æœŸ: v20.x.x æˆ–æ›´é«˜

# 2. æª¢æŸ¥ npm ç‰ˆæœ¬
npm --version
# é æœŸ: 10.x.x æˆ–æ›´é«˜

# 3. æª¢æŸ¥ RabbitMQ ç‹€æ…‹
docker ps --filter "name=rabbitmq"
# é æœŸ: aiva-rabbitmq å®¹å™¨é‹è¡Œä¸­

# 4. é©—è­‰ç·¨è­¯ç”¢ç‰©
Test-Path "dist\index.js"
# é æœŸ: True
```

### æ¸¬è©¦ 2: ç¨ç«‹å•Ÿå‹•æ¸¬è©¦

```powershell
# åˆ‡æ›åˆ°æ­£ç¢ºç›®éŒ„ (â— é‡è¦)
cd C:\D\fold7\AIVA-git\services\scan\engines\typescript_engine

# ç›´æ¥å•Ÿå‹•ï¼ˆç„¡éœ€è¨­ç½®ç’°å¢ƒè®Šæ•¸ï¼‰
node dist/index.js
```

**é æœŸè¼¸å‡º**:
```
{"level":30,"time":"2025-11-18T...","msg":"ğŸš€ åˆå§‹åŒ– AIVA Scan Node..."}
{"level":30,"time":"2025-11-18T...","msg":"ğŸŒ å•Ÿå‹• Chromium ç€è¦½å™¨..."}
{"level":30,"time":"2025-11-18T...","msg":"âœ… ç€è¦½å™¨å·²å•Ÿå‹•"}
{"level":30,"time":"2025-11-18T...","msg":"ğŸ“¡ é€£æ¥ RabbitMQ..."}
{"level":30,"time":"2025-11-18T...","msg":"âœ… RabbitMQ å·²é€£æ¥"}
{"level":30,"time":"2025-11-18T...","msg":"âœ… åˆå§‹åŒ–å®Œæˆ,é–‹å§‹ç›£è½ä»»å‹™..."}
```

### æ¸¬è©¦ 3: é¶å ´æƒææ¸¬è©¦

**å‰ç½®æ¢ä»¶**: Juice Shop é‹è¡Œåœ¨ http://localhost:3000

```powershell
# ä½¿ç”¨ Python æ¸¬è©¦è…³æœ¬
cd C:\D\fold7\AIVA-git
$env:PYTHONPATH="C:\D\fold7\AIVA-git"

# ç›´æ¥åŸ·è¡Œæ¸¬è©¦ï¼ˆç„¡éœ€è¨­ç½®é€£æ¥ç’°å¢ƒè®Šæ•¸ï¼‰
python services/scan/engines/typescript_engine/test_typescript_engine.py
```

**é æœŸçµæœ**:
- âœ… Node.js å¯ç”¨æ€§æª¢æŸ¥é€šé
- âœ… ç·¨è­¯ç”¢ç‰©å­˜åœ¨
- âœ… é¶å ´é€£æ¥æˆåŠŸ
- âœ… æƒæä»»å‹™å®Œæˆ
- âœ… ç™¼ç¾è³‡ç”¢ (forms, inputs, links, apis)

---

## ğŸ”§ æ•…éšœæ’é™¤

### å•é¡Œ 1: `Error: Cannot find module 'C:\D\fold7\AIVA-git\dist\index.js'`

**åŸå› **: ç•¶å‰å·¥ä½œç›®éŒ„ä¸æ­£ç¢º

**è§£æ±º**:
```powershell
# å¿…é ˆåœ¨ typescript_engine ç›®éŒ„ä¸‹åŸ·è¡Œ
cd C:\D\fold7\AIVA-git\services\scan\engines\typescript_engine
node dist/index.js
```

### å•é¡Œ 2: RabbitMQ é€£æ¥éŒ¯èª¤

**åŸå› **: RabbitMQ æœå‹™æœªå•Ÿå‹•

**è§£æ±º**:
```powershell
# ç¢ºèª RabbitMQ ç‹€æ…‹
docker ps --filter "name=rabbitmq"

# å¦‚æœæœªé‹è¡Œï¼Œå•Ÿå‹• RabbitMQ
docker start aiva-rabbitmq

# æª¢æŸ¥åŸ è™Ÿ
netstat -an | Select-String "5672"
```

**è§£æ±º**:
```powershell
# å•Ÿå‹• RabbitMQ
docker start aiva-rabbitmq

# æˆ–å¾é ­å•Ÿå‹•
cd C:\D\fold7\AIVA-git
docker-compose up -d rabbitmq
```

### å•é¡Œ 4: Playwright ç€è¦½å™¨æœªå®‰è£

**éŒ¯èª¤**: `browserType.launch: Executable doesn't exist`

**è§£æ±º**:
```powershell
npm run install:browsers
```

### å•é¡Œ 5: Python Worker æ‰¾ä¸åˆ°æ¨¡çµ„

**éŒ¯èª¤**: `ModuleNotFoundError: No module named 'services'`

**è§£æ±º**:
```powershell
# è¨­ç½® PYTHONPATH
$env:PYTHONPATH="C:\D\fold7\AIVA-git"

# ç¢ºèªè™›æ“¬ç’°å¢ƒå·²å•Ÿå‹•
& C:/D/fold7/AIVA-git/.venv/Scripts/Activate.ps1
```

---

## ğŸ—ï¸ æ¶æ§‹èªªæ˜

### ç›®éŒ„çµæ§‹

```
typescript_engine/
â”œâ”€â”€ src/                        # TypeScript æºä»£ç¢¼
â”‚   â”œâ”€â”€ index.ts               # ä¸»å…¥å£ (RabbitMQ ç›£è½)
â”‚   â”œâ”€â”€ services/              # æƒææœå‹™
â”‚   â”‚   â”œâ”€â”€ scan-service.ts   # æ ¸å¿ƒæƒæé‚è¼¯
â”‚   â”‚   â””â”€â”€ network-interceptor.service.ts  # ç¶²è·¯æ””æˆª
â”‚   â”œâ”€â”€ interfaces/            # å‹åˆ¥å®šç¾©
â”‚   â””â”€â”€ utils/                 # å·¥å…·å‡½æ•¸
â”œâ”€â”€ dist/                       # ç·¨è­¯ç”¢ç‰© (JavaScript)
â”œâ”€â”€ worker.py                   # Python Worker (æ•´åˆå±¤)
â”œâ”€â”€ package.json               # Node.js é…ç½®
â”œâ”€â”€ tsconfig.json              # TypeScript é…ç½®
â””â”€â”€ README.md                  # æœ¬æ–‡ä»¶
```

### è³‡æ–™æµç¨‹

```
Phase1 è«‹æ±‚ (RabbitMQ)
    â†“
Python Worker (worker.py)
    â†“
å•Ÿå‹• Node.js å­é€²ç¨‹ (dist/index.js)
    â†“
Playwright ç€è¦½å™¨è‡ªå‹•åŒ–
    â†“
ScanService æƒæé‚è¼¯
    â”œâ”€ é é¢è¨ªå•
    â”œâ”€ SPA æª¢æ¸¬
    â”œâ”€ ç¶²è·¯æ””æˆª (NetworkInterceptor)
    â”œâ”€ WebSocket ç›£è½
    â””â”€ è³‡ç”¢æå–
    â†“
è¿”å›æƒæçµæœ
    â†“
Python Worker è™•ç†
    â†“
ç™¼é€çµæœ (RabbitMQ)
```

### æ ¸å¿ƒçµ„ä»¶

| çµ„ä»¶ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| **å…¥å£** | `src/index.ts` | RabbitMQ é€£æ¥ã€ä»»å‹™ç›£è½ |
| **æƒææœå‹™** | `src/services/scan-service.ts` | Playwright æƒæé‚è¼¯ã€SPA æª¢æ¸¬ |
| **ç¶²è·¯æ””æˆª** | `src/services/network-interceptor.service.ts` | AJAXã€API è«‹æ±‚æ””æˆª |
| **Python æ©‹æ¥** | `worker.py` | Python â†” Node.js æ©‹æ¥å±¤ |

---

## ğŸ“Š æ•ˆèƒ½æŒ‡æ¨™

| æŒ‡æ¨™ | æ•¸å€¼ | èªªæ˜ |
|------|------|------|
| **é é¢è¼‰å…¥** | ~2s/é  | å« JavaScript æ¸²æŸ“ |
| **æ·±åº¦ 3 æƒæ** | ~15-30s | å–æ±ºæ–¼ç›®æ¨™ç¶²ç«™ |
| **è¨˜æ†¶é«”ä½¿ç”¨** | ~300-500MB | å« Chromium |
| **CPU ä½¿ç”¨** | ~10-30% | å–®æ ¸å¿ƒ |

---

## ğŸ“š ä¾è³´èªªæ˜

> **å®Œæ•´ä¾è³´åˆ†æ**: [NODE_MODULES_GUIDE.md](./NODE_MODULES_GUIDE.md) - åŒ…å«æ‰€æœ‰ 213 å€‹å¥—ä»¶çš„è©³ç´°èªªæ˜

### ğŸ“Š çµ±è¨ˆè³‡è¨Š

TypeScript Engine ä½¿ç”¨ **213 å€‹ npm å¥—ä»¶**ï¼ŒåŒ…å« **5,905 å€‹æª”æ¡ˆ**ï¼Œç¸½å¤§å° **100.07 MB**ï¼ˆä¸å« Playwright ç€è¦½å™¨ï¼Œç€è¦½å™¨é¡å¤–éœ€è¦ç´„ 300MBï¼‰ã€‚

| æŒ‡æ¨™ | æ•¸å€¼ | èªªæ˜ |
|------|------|------|
| **ç¸½å¥—ä»¶æ•¸** | 213 å€‹ | åŒ…å«æ‰€æœ‰ç›´æ¥å’Œé–“æ¥ä¾è³´ |
| **ç¸½æª”æ¡ˆæ•¸** | 5,905 å€‹ | åŒ…å«æ‰€æœ‰åŸå§‹ç¢¼ã€é¡å‹å®šç¾©ã€æ–‡æª” |
| **ç¸½å¤§å°** | 100.07 MB | ä¸å« Playwright ç€è¦½å™¨ï¼ˆç€è¦½å™¨é¡å¤– ~300MBï¼‰ |
| **å¯åŸ·è¡Œå‘½ä»¤** | 68 å€‹ | ä½æ–¼ `node_modules/.bin` |
| **ç›´æ¥ä¾è³´** | 13 å€‹ | package.json ä¸­å®šç¾© |
| **Scoped å¥—ä»¶** | 13 å€‹ | ä»¥ @ é–‹é ­çš„çµ„ç¹”å¥—ä»¶ |

---

### ğŸ¯ æ ¸å¿ƒä¾è³´ï¼ˆ4 å€‹ç”Ÿç”¢å¥—ä»¶ï¼‰

#### 1. **playwright@1.56.1** â­â­â­ é—œéµ

#### 1. **playwright@1.56.1** â­â­â­ é—œéµ
- **ç”¨é€”**: ç€è¦½å™¨è‡ªå‹•åŒ–æ ¸å¿ƒå¼•æ“ï¼ˆChromium/Firefox/WebKitï¼‰
- **å¤§å°**: ~40 MBï¼ˆä¸å«ç€è¦½å™¨ï¼‰
- **åŠŸèƒ½**: é é¢æ§åˆ¶ã€ç¶²è·¯æ””æˆªã€WebSocket ç›£è½ã€æˆªåœ–

#### 2. **amqplib@0.10.9** â­â­â­ é—œéµ
- **ç”¨é€”**: RabbitMQ å®¢æˆ¶ç«¯åº«
- **å¤§å°**: ~200 KB
- **åŠŸèƒ½**: é€£æ¥ RabbitMQã€ç™¼é€/æ¥æ”¶è¨Šæ¯ã€éšŠåˆ—ç®¡ç†

#### 3. **pino@8.21.0** â­â­ é‡è¦
- **ç”¨é€”**: é«˜æ€§èƒ½ JSON æ—¥èªŒè¨˜éŒ„
- **å¤§å°**: ~100 KB
- **åŠŸèƒ½**: çµæ§‹åŒ–æ—¥èªŒã€å¤šå±¤ç´šè¨˜éŒ„ã€æ•ˆèƒ½å„ªåŒ–

#### 4. **pino-pretty@11.2.2** â­ è¼”åŠ©
- **ç”¨é€”**: æ—¥èªŒç¾åŒ–è¼¸å‡ºï¼ˆé–‹ç™¼ç”¨ï¼‰
- **å¤§å°**: ~50 KB
- **åŠŸèƒ½**: å½©è‰²æ ¼å¼åŒ–ã€æ™‚é–“æˆ³ç¾åŒ–

---

### ğŸ› ï¸ é–‹ç™¼å·¥å…·ï¼ˆ9 å€‹é–‹ç™¼å¥—ä»¶ï¼‰

- **typescript@5.9.3**: TypeScript ç·¨è­¯å™¨ï¼ˆ17.69 MBï¼‰
- **eslint@9.16.0**: ç¨‹å¼ç¢¼æª¢æŸ¥å·¥å…·ï¼ˆ2.91 MBï¼‰
- **prettier@3.4.2**: ç¨‹å¼ç¢¼æ ¼å¼åŒ–å·¥å…·ï¼ˆ7.93 MBï¼‰
- **vitest@2.1.8**: å–®å…ƒæ¸¬è©¦æ¡†æ¶ï¼ˆ9.85 MBï¼‰
- **tsx@4.19.2**: TypeScript ç›´æ¥åŸ·è¡Œå·¥å…·ï¼ˆ9.61 MBï¼‰
- **@types/node@22.10.1**: Node.js é¡å‹å®šç¾©ï¼ˆ3.89 MBï¼‰
- **@typescript-eslint/***: TypeScript ESLint æ’ä»¶ï¼ˆ1.86 MBï¼‰

---

### ğŸ“– è©³ç´°æ–‡æª”é€£çµ

**å®Œæ•´å¥—ä»¶åˆ†æ**: [NODE_MODULES_GUIDE.md](./NODE_MODULES_GUIDE.md)

è©²æ–‡æª”åŒ…å«ï¼š
- âœ… 213 å€‹å¥—ä»¶å®Œæ•´åˆ—è¡¨å’Œèªªæ˜
- âœ… æ¯å€‹å¥—ä»¶çš„åŠŸèƒ½ã€å¤§å°ã€ä½¿ç”¨ç¯„ä¾‹
- âœ… ä¾è³´æ¨¹çµæ§‹ã€å­˜å„²ç©ºé–“åˆ†æ
- âœ… 68 å€‹å¯åŸ·è¡Œå‘½ä»¤åˆ—è¡¨
- âœ… é–‹ç™¼/ç”Ÿç”¢/CI-CD ä½¿ç”¨å ´æ™¯
- âœ… FAQ å¸¸è¦‹å•é¡Œ

---

## ğŸ”— ç›¸é—œæ–‡ä»¶

### ğŸ“¦ NODE_MODULES_GUIDE.md - ä¾è³´å¥—ä»¶å®Œæ•´æŒ‡å—
> **[âœ æŸ¥çœ‹å®Œæ•´æ–‡æª”](./NODE_MODULES_GUIDE.md)**

**æ¶µè“‹å…§å®¹**: 213 å€‹å¥—ä»¶ã€5,905 å€‹æª”æ¡ˆã€100.07 MB å®Œæ•´åˆ†æ

**ç« ç¯€å°èˆª**:
- [ğŸ“Š ç¸½é«”æ¦‚è¦½](./NODE_MODULES_GUIDE.md#ç¸½é«”æ¦‚è¦½) - åŸºæœ¬çµ±è¨ˆå’Œæª”æ¡ˆåˆ†å¸ƒ
- [ğŸ¯ æ ¸å¿ƒä¾è³´å¥—ä»¶](./NODE_MODULES_GUIDE.md#æ ¸å¿ƒä¾è³´å¥—ä»¶) - 4 å€‹ç”Ÿç”¢ç’°å¢ƒå¥—ä»¶è©³è§£
  - [playwright](./NODE_MODULES_GUIDE.md#1-playwright1561-é—œéµ) - ç€è¦½å™¨è‡ªå‹•åŒ–å¼•æ“
  - [amqplib](./NODE_MODULES_GUIDE.md#2-amqplib0109-é—œéµ) - RabbitMQ å®¢æˆ¶ç«¯
  - [pino](./NODE_MODULES_GUIDE.md#3-pino8210-é‡è¦) - æ—¥èªŒè¨˜éŒ„ç³»çµ±
- [ğŸ› ï¸ é–‹ç™¼ä¾è³´å¥—ä»¶](./NODE_MODULES_GUIDE.md#é–‹ç™¼ä¾è³´å¥—ä»¶) - 9 å€‹é–‹ç™¼å·¥å…·
- [ğŸ“¦ å®Œæ•´å¥—ä»¶æ¸…å–®](./NODE_MODULES_GUIDE.md#å®Œæ•´å¥—ä»¶æ¸…å–®) - æ‰€æœ‰ 213 å€‹å¥—ä»¶åˆ—è¡¨
- [ğŸ’» å¯åŸ·è¡Œå‘½ä»¤](./NODE_MODULES_GUIDE.md#å¯åŸ·è¡Œå‘½ä»¤) - 68 å€‹ CLI å·¥å…·
- [â“ FAQ å¸¸è¦‹å•é¡Œ](./NODE_MODULES_GUIDE.md#faq-å¸¸è¦‹å•é¡Œ)

---

### ğŸ”§ IMPROVEMENT_PLAN.md - æ”¹å–„è¨ˆåŠƒèˆ‡ä¿®å¾©æŒ‡å—
> **[âœ æŸ¥çœ‹å®Œæ•´æ–‡æª”](./IMPROVEMENT_PLAN.md)**

**ç•¶å‰ç‹€æ…‹**: ğŸŸ¡ 70% å®Œæˆ | **é è¨ˆå·¥ä½œé‡**: 4-6 å°æ™‚

**ç« ç¯€å°èˆª**:
- [ğŸ“Š åŠŸèƒ½å®Œæ•´åº¦åˆ†æ](./IMPROVEMENT_PLAN.md#åŠŸèƒ½å®Œæ•´åº¦åˆ†æ) - å·²å®Œæˆ vs å¾…ä¿®å¾©åŠŸèƒ½
- [ğŸ”´ Critical å•é¡Œè©³è§£](./IMPROVEMENT_PLAN.md#critical-å•é¡Œè©³è§£) - 3 å€‹å¿…é ˆä¿®å¾©çš„æ ¸å¿ƒå•é¡Œ
  - [å•é¡Œ 1: RabbitMQ æ•´åˆæ¶æ§‹éŒ¯èª¤](./IMPROVEMENT_PLAN.md#å•é¡Œ-1-worker-èˆ‡-nodejs-é€šä¿¡æ©Ÿåˆ¶éŒ¯èª¤) - Worker ç„¡æ³•é€šä¿¡
  - [å•é¡Œ 2: éšŠåˆ—åç¨±ä¸çµ±ä¸€](./IMPROVEMENT_PLAN.md#å•é¡Œ-2-éšŠåˆ—åç¨±ä¸ä¸€è‡´) - ä»»å‹™æ¥æ”¶å¤±æ•—
  - [å•é¡Œ 3: è³‡ç”¢æ ¼å¼ä¸åŒ¹é…](./IMPROVEMENT_PLAN.md#å•é¡Œ-3-è³‡ç”¢æ ¼å¼ä¸åŒ¹é…) - ä¸‹æ¸¸è™•ç†å•é¡Œ
- [ğŸ¯ æ”¹å–„è¨ˆåŠƒ](./IMPROVEMENT_PLAN.md#æ”¹å–„è¨ˆåŠƒ) - åˆ†éšæ®µä¿®å¾©æ–¹æ¡ˆ
  - [Phase A: ä¿®å¾©æ ¸å¿ƒé€šä¿¡æ©Ÿåˆ¶](./IMPROVEMENT_PLAN.md#phase-a-ä¿®å¾©æ ¸å¿ƒé€šä¿¡æ©Ÿåˆ¶-2-3-å°æ™‚) - 2-3 å°æ™‚
  - [Phase B: å„ªåŒ–èˆ‡å¢å¼·](./IMPROVEMENT_PLAN.md#phase-b-å„ªåŒ–èˆ‡å¢å¼·-2-3-å°æ™‚) - 2-3 å°æ™‚
- [ğŸ“‹ å¯¦æ–½å„ªå…ˆç´š](./IMPROVEMENT_PLAN.md#å¯¦æ–½å„ªå…ˆç´š) - P0/P1/P2 å„ªå…ˆç´šåˆ†é¡
- [ğŸ¯ å®Œæˆå¾Œçš„ç‹€æ…‹](./IMPROVEMENT_PLAN.md#å®Œæˆå¾Œçš„ç‹€æ…‹) - é”æˆç›®æ¨™
- [ğŸš€ ä½¿ç”¨æ–¹å¼ï¼ˆå®Œæˆå¾Œï¼‰](./IMPROVEMENT_PLAN.md#ä½¿ç”¨æ–¹å¼å®Œæˆå¾Œ) - å®Œæ•´ä½¿ç”¨æµç¨‹
- [ğŸ“Š æŠ•è³‡å›å ±åˆ†æ](./IMPROVEMENT_PLAN.md#æŠ•è³‡å›å ±åˆ†æ) - 4-6 å°æ™‚æ›å–å®Œæ•´åŠŸèƒ½

---

### ğŸ“‹ VALIDATION_STATUS.md - é©—è­‰ç‹€æ…‹å ±å‘Š
> **[âœ æŸ¥çœ‹å®Œæ•´æ–‡æª”](./VALIDATION_STATUS.md)**

**åŠŸèƒ½**: è¨˜éŒ„æ¸¬è©¦é©—è­‰çµæœå’Œå·²çŸ¥å•é¡Œ

---

### ğŸŒ å¤–éƒ¨è³‡æº
- **[VALIDATION_STATUS.md](./VALIDATION_STATUS.md)** - é©—è­‰ç‹€æ…‹å ±å‘Š
- [AIVA Common è¦ç¯„](../../../aiva_common/README.md)
- [æƒææµç¨‹åœ–](../SCAN_FLOW_DIAGRAMS.md)
- [å¼•æ“å®Œæˆåº¦åˆ†æ](../ENGINE_COMPLETION_ANALYSIS.md)
- [Playwright å®˜æ–¹æ–‡æª”](https://playwright.dev/)

---

## âœ… æª¢æŸ¥æ¸…å–®

ä½¿ç”¨å‰è«‹ç¢ºèª:

- [ ] Node.js >= 20.0.0
- [ ] npm install å®Œæˆ
- [ ] Playwright ç€è¦½å™¨å·²å®‰è£
- [ ] RabbitMQ å®¹å™¨é‹è¡Œä¸­
- [ ] TypeScript ç·¨è­¯å®Œæˆ (dist/ å­˜åœ¨)
- [ ] ç’°å¢ƒè®Šæ•¸å·²è¨­ç½® (USER, PASSWORD)
- [ ] ç•¶å‰ç›®éŒ„æ­£ç¢º (typescript_engine/)

---

**ç¶­è­·è€…**: AIVA é–‹ç™¼åœ˜éšŠ  
**æœ€å¾Œæ›´æ–°**: 2025-11-18  
**å•é¡Œå›å ±**: GitHub Issues

