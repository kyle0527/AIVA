# GO 掃描器建置設定
version: '3.8'

name: aiva-go-scanners

services:
  # SSRF 掃描器
  ssrf-scanner:
    build:
      context: ./
      dockerfile: shared/Dockerfile
    ports:
      - "8081:8081"
    environment:
      SCANNER_TYPE: ssrf
      SCANNER_PORT: 8081
      RABBITMQ_URL: ${RABBITMQ_URL:-amqp://guest:guest@localhost:5672/}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
    volumes:
      - ./logs:/root/logs
      - ./reports:/root/reports
    networks:
      - go-scanners
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8081/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # CSPM 掃描器  
  cspm-scanner:
    build:
      context: ./
      dockerfile: shared/Dockerfile
    ports:
      - "8082:8082"
    environment:
      SCANNER_TYPE: cspm
      SCANNER_PORT: 8082
      RABBITMQ_URL: ${RABBITMQ_URL:-amqp://guest:guest@localhost:5672/}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
    volumes:
      - ./logs:/root/logs
      - ./reports:/root/reports
    networks:
      - go-scanners
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8082/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # SCA 掃描器
  sca-scanner:
    build:
      context: ./
      dockerfile: shared/Dockerfile
    ports:
      - "8083:8083"
    environment:
      SCANNER_TYPE: sca
      SCANNER_PORT: 8083
      RABBITMQ_URL: ${RABBITMQ_URL:-amqp://guest:guest@localhost:5672/}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
    volumes:
      - ./logs:/root/logs
      - ./reports:/root/reports
    networks:
      - go-scanners
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8083/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

networks:
  go-scanners:
    driver: bridge

volumes:
  go_scanner_logs:
    driver: local
  go_scanner_reports:
    driver: local