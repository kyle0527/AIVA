version: 1.0.0
metadata:
  description: AIVA跨語言Schema統一定義 - 以手動維護版本為準
  generated_note: 此配置已同步手動維護的Schema定義，確保單一事實原則
  last_updated: '2025-10-28T10:24:34.374262'
  sync_source: 手動維護Schema (base.py, findings.py)
base_types:
  MessageHeader:
    description: 訊息標頭 - 用於所有訊息的統一標頭格式
    fields:
      message_id:
        type: str
        required: true
        description: ''
      trace_id:
        type: str
        required: true
        description: ''
      correlation_id:
        type: Optional[str]
        required: false
        description: ''
      source_module:
        type: ModuleName
        required: true
        description: ''
      timestamp:
        type: datetime
        required: false
        description: ''
      version:
        type: str
        required: false
        description: ''
        default: '1.0'
  Target:
    description: 目標資訊 - 漏洞所在位置
    fields:
      url:
        type: Any
        required: true
        description: ''
      parameter:
        type: Optional[str]
        required: false
        description: ''
      method:
        type: Optional[str]
        required: false
        description: ''
      headers:
        type: Dict[str, Any]
        required: false
        description: ''
      params:
        type: Dict[str, Any]
        required: false
        description: ''
      body:
        type: Optional[str]
        required: false
        description: ''
  Vulnerability:
    description: '漏洞基本資訊 - 用於 Finding 中的漏洞描述


      符合標準：

      - CWE: Common Weakness Enumeration (MITRE)

      - CVE: Common Vulnerabilities and Exposures

      - CVSS: Common Vulnerability Scoring System v3.1/v4.0

      - OWASP: Open Web Application Security Project'
    fields:
      name:
        type: Any
        required: true
        description: ''
      cwe:
        type: Optional[str]
        required: false
        description: 'CWE ID (格式: CWE-XXX)，參考 https://cwe.mitre.org/'
      cve:
        type: Optional[str]
        required: false
        description: 'CVE ID (格式: CVE-YYYY-NNNNN)，參考 https://cve.mitre.org/'
      severity:
        type: Any
        required: true
        description: ''
      confidence:
        type: Any
        required: true
        description: ''
      description:
        type: Optional[str]
        required: false
        description: ''
      cvss_score:
        type: Any
        required: false
        description: CVSS v3.1 Base Score (0.0-10.0)，參考 https://www.first.org/cvss/
      cvss_vector:
        type: Optional[str]
        required: false
        description: 'CVSS v3.1 Vector String，例如: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H'
      owasp_category:
        type: Optional[str]
        required: false
        description: 'OWASP Top 10 分類，例如: A03:2021-Injection'
  Asset:
    description: 資產基本資訊
    fields:
      asset_id:
        type: str
        required: true
        description: ''
      type:
        type: str
        required: true
        description: ''
      value:
        type: str
        required: true
        description: ''
      parameters:
        type: List[str]
        required: false
        description: ''
      has_form:
        type: bool
        required: false
        description: ''
        default: false
  Authentication:
    description: 認證資訊
    fields:
      method:
        type: str
        required: false
        description: ''
        default: none
      credentials:
        type: Dict[str, Any]
        required: false
        description: ''
  ExecutionError:
    description: 執行錯誤統一格式
    fields:
      error_id:
        type: str
        required: true
        description: ''
      error_type:
        type: str
        required: true
        description: ''
      message:
        type: str
        required: true
        description: ''
      payload:
        type: Optional[str]
        required: false
        description: ''
      vector:
        type: Optional[str]
        required: false
        description: ''
      timestamp:
        type: datetime
        required: false
        description: ''
      attempts:
        type: int
        required: false
        description: ''
        default: 1
  Fingerprints:
    description: 技術指紋
    fields:
      web_server:
        type: Dict[str, Any]
        required: false
        description: ''
      framework:
        type: Dict[str, Any]
        required: false
        description: ''
      language:
        type: Dict[str, Any]
        required: false
        description: ''
      waf_detected:
        type: bool
        required: false
        description: ''
        default: false
      waf_vendor:
        type: Optional[str]
        required: false
        description: ''
  RateLimit:
    description: 速率限制
    fields:
      requests_per_second:
        type: int
        required: false
        description: ''
        default: 25
      burst:
        type: int
        required: false
        description: ''
        default: 50
  RiskFactor:
    description: 風險因子
    fields:
      factor_name:
        type: str
        required: true
        description: 風險因子名稱
      weight:
        type: float
        required: true
        description: 權重
      value:
        type: float
        required: true
        description: 因子值
      description:
        type: Optional[str]
        required: false
        description: 因子描述
  ScanScope:
    description: 掃描範圍
    fields:
      exclusions:
        type: List[str]
        required: false
        description: ''
      include_subdomains:
        type: bool
        required: false
        description: ''
        default: true
      allowed_hosts:
        type: List[str]
        required: false
        description: ''
  Summary:
    description: 掃描摘要
    fields:
      urls_found:
        type: int
        required: false
        description: ''
        default: 0
      forms_found:
        type: int
        required: false
        description: ''
        default: 0
      apis_found:
        type: int
        required: false
        description: ''
        default: 0
      scan_duration_seconds:
        type: int
        required: false
        description: ''
        default: 0
  TaskDependency:
    description: 任務依賴
    fields:
      dependency_type:
        type: str
        required: true
        description: 依賴類型
      dependent_task_id:
        type: str
        required: true
        description: 依賴任務ID
      condition:
        type: Optional[str]
        required: false
        description: 依賴條件
      required:
        type: bool
        required: false
        description: 是否必需
        default: true
  AIVerificationRequest:
    description: AI 驅動漏洞驗證請求
    fields:
      verification_id:
        type: str
        required: true
        description: ''
      finding_id:
        type: str
        required: true
        description: ''
      scan_id:
        type: str
        required: true
        description: ''
      vulnerability_type:
        type: Any
        required: true
        description: ''
      target:
        type: Any
        required: true
        description: ''
      evidence:
        type: Any
        required: true
        description: ''
      verification_mode:
        type: str
        required: false
        description: ''
        default: non_destructive
      context:
        type: Dict[str, Any]
        required: false
        description: ''
  AIVerificationResult:
    description: AI 驅動漏洞驗證結果
    fields:
      verification_id:
        type: str
        required: true
        description: ''
      finding_id:
        type: str
        required: true
        description: ''
      verification_status:
        type: str
        required: true
        description: ''
      confidence_score:
        type: float
        required: true
        description: ''
      verification_method:
        type: str
        required: true
        description: ''
      test_steps:
        type: List[str]
        required: false
        description: ''
      observations:
        type: List[str]
        required: false
        description: ''
      recommendations:
        type: List[str]
        required: false
        description: ''
      timestamp:
        type: datetime
        required: false
        description: ''
  CodeLevelRootCause:
    description: 程式碼層面根因分析結果
    fields:
      analysis_id:
        type: str
        required: true
        description: ''
      vulnerable_component:
        type: str
        required: true
        description: ''
      affected_findings:
        type: List[str]
        required: true
        description: ''
      code_location:
        type: Optional[str]
        required: false
        description: ''
      vulnerability_pattern:
        type: Optional[str]
        required: false
        description: ''
      fix_recommendation:
        type: Optional[str]
        required: false
        description: ''
  FindingEvidence:
    description: 漏洞證據
    fields:
      payload:
        type: Optional[str]
        required: false
        description: ''
      response_time_delta:
        type: Any
        required: false
        description: ''
      db_version:
        type: Optional[str]
        required: false
        description: ''
      request:
        type: Optional[str]
        required: false
        description: ''
      response:
        type: Optional[str]
        required: false
        description: ''
      proof:
        type: Optional[str]
        required: false
        description: ''
  FindingImpact:
    description: 漏洞影響描述
    fields:
      description:
        type: Optional[str]
        required: false
        description: ''
      business_impact:
        type: Optional[str]
        required: false
        description: ''
      technical_impact:
        type: Optional[str]
        required: false
        description: ''
      affected_users:
        type: Any
        required: false
        description: ''
      estimated_cost:
        type: Any
        required: false
        description: ''
  FindingPayload:
    description: 漏洞發現 Payload - 統一的漏洞報告格式
    fields:
      finding_id:
        type: str
        required: true
        description: ''
      task_id:
        type: str
        required: true
        description: ''
      scan_id:
        type: str
        required: true
        description: ''
      status:
        type: str
        required: true
        description: ''
      vulnerability:
        type: Any
        required: true
        description: ''
      target:
        type: Any
        required: true
        description: ''
      strategy:
        type: Optional[str]
        required: false
        description: ''
      evidence:
        type: Any
        required: false
        description: ''
      impact:
        type: Any
        required: false
        description: ''
      recommendation:
        type: Any
        required: false
        description: ''
      metadata:
        type: Dict[str, Any]
        required: false
        description: ''
      created_at:
        type: datetime
        required: false
        description: ''
      updated_at:
        type: datetime
        required: false
        description: ''
  FindingRecommendation:
    description: 漏洞修復建議
    fields:
      fix:
        type: Optional[str]
        required: false
        description: ''
      priority:
        type: Optional[str]
        required: false
        description: ''
      remediation_steps:
        type: List[str]
        required: false
        description: ''
      references:
        type: List[str]
        required: false
        description: ''
  FindingTarget:
    description: 目標資訊 - 漏洞所在位置
    fields:
      url:
        type: Any
        required: true
        description: ''
      parameter:
        type: Optional[str]
        required: false
        description: ''
      method:
        type: Optional[str]
        required: false
        description: ''
      headers:
        type: Dict[str, Any]
        required: false
        description: ''
      params:
        type: Dict[str, Any]
        required: false
        description: ''
      body:
        type: Optional[str]
        required: false
        description: ''
  JavaScriptAnalysisResult:
    description: JavaScript 分析結果
    fields:
      analysis_id:
        type: str
        required: true
        description: ''
      url:
        type: str
        required: true
        description: ''
      source_size_bytes:
        type: int
        required: true
        description: ''
      dangerous_functions:
        type: List[str]
        required: false
        description: ''
      external_resources:
        type: List[str]
        required: false
        description: ''
      data_leaks:
        type: Dict[str, Any]
        required: false
        description: ''
      findings:
        type: List[str]
        required: false
        description: ''
      apis_called:
        type: List[str]
        required: false
        description: ''
      ajax_endpoints:
        type: List[str]
        required: false
        description: ''
      suspicious_patterns:
        type: List[str]
        required: false
        description: ''
      risk_score:
        type: float
        required: false
        description: ''
        default: 0.0
      security_score:
        type: int
        required: false
        description: ''
        default: 100
      timestamp:
        type: datetime
        required: false
        description: ''
  SASTDASTCorrelation:
    description: SAST-DAST 資料流關聯結果
    fields:
      correlation_id:
        type: str
        required: true
        description: ''
      sast_finding_id:
        type: str
        required: true
        description: ''
      dast_finding_id:
        type: str
        required: true
        description: ''
      data_flow_path:
        type: List[str]
        required: true
        description: ''
      verification_status:
        type: str
        required: true
        description: ''
      confidence_score:
        type: float
        required: true
        description: ''
      explanation:
        type: Optional[str]
        required: false
        description: ''
  SensitiveMatch:
    description: 敏感資訊匹配結果
    fields:
      match_id:
        type: str
        required: true
        description: ''
      pattern_name:
        type: str
        required: true
        description: ''
      matched_text:
        type: str
        required: true
        description: ''
      context:
        type: str
        required: true
        description: ''
      confidence:
        type: float
        required: true
        description: ''
      line_number:
        type: Any
        required: false
        description: ''
      file_path:
        type: Optional[str]
        required: false
        description: ''
      url:
        type: Optional[str]
        required: false
        description: ''
      severity:
        type: Any
        required: false
        description: ''
        default: medium
  VulnerabilityCorrelation:
    description: 漏洞關聯分析結果
    fields:
      correlation_id:
        type: str
        required: true
        description: ''
      correlation_type:
        type: str
        required: true
        description: ''
      related_findings:
        type: List[str]
        required: true
        description: ''
      confidence_score:
        type: float
        required: true
        description: ''
      root_cause:
        type: Optional[str]
        required: false
        description: ''
      common_components:
        type: List[str]
        required: false
        description: ''
      explanation:
        type: Optional[str]
        required: false
        description: ''
      timestamp:
        type: datetime
        required: false
        description: ''
messaging:
  AivaMessage:
    description: AIVA統一訊息格式 - 所有跨服務通訊的標準信封
    fields:
      header:
        type: MessageHeader
        required: true
        description: 訊息標頭
      topic:
        type: str
        required: true
        description: 訊息主題
        validation:
          enum:
          - tasks
          - findings
          - events
          - commands
          - responses
      schema_version:
        type: str
        required: true
        default: '1.0'
        description: Schema版本
      payload:
        type: Dict[str, Any]
        required: true
        description: 訊息載荷
  AIVARequest:
    description: 統一請求格式 - 模組間請求通訊
    fields:
      request_id:
        type: str
        required: true
        description: 請求識別碼
      source_module:
        type: str
        required: true
        description: 來源模組
      target_module:
        type: str
        required: true
        description: 目標模組
      request_type:
        type: str
        required: true
        description: 請求類型
      payload:
        type: Dict[str, Any]
        required: true
        description: 請求載荷
      trace_id:
        type: Optional[str]
        required: false
        description: 追蹤識別碼
      timeout_seconds:
        type: int
        required: true
        default: 30
        description: 逾時秒數
        validation:
          minimum: 1
          maximum: 300
      metadata:
        type: Dict[str, Any]
        required: false
        default: {}
        description: 中繼資料
      timestamp:
        type: str
        required: true
        description: 時間戳
  AIVAResponse:
    description: 統一響應格式 - 模組間響應通訊
    fields:
      request_id:
        type: str
        required: true
        description: 對應的請求識別碼
      response_type:
        type: str
        required: true
        description: 響應類型
      success:
        type: bool
        required: true
        description: 執行是否成功
      payload:
        type: Optional[Dict[str, Any]]
        required: false
        description: 響應載荷
      error_code:
        type: Optional[str]
        required: false
        description: 錯誤代碼
      error_message:
        type: Optional[str]
        required: false
        description: 錯誤訊息
      metadata:
        type: Dict[str, Any]
        required: false
        default: {}
        description: 中繼資料
      timestamp:
        type: str
        required: true
        description: 時間戳
tasks:
  FunctionTaskPayload:
    description: 功能任務載荷 - 掃描任務的標準格式
    fields:
      task_id:
        type: str
        required: true
        description: 任務識別碼
      scan_id:
        type: str
        required: true
        description: 掃描識別碼
      priority:
        type: int
        required: true
        description: 任務優先級
        validation:
          minimum: 0
          maximum: 10
      target:
        type: FunctionTaskTarget
        required: true
        description: 掃描目標
      context:
        type: FunctionTaskContext
        required: true
        description: 任務上下文
      strategy:
        type: str
        required: true
        description: 掃描策略
        validation:
          enum:
          - fast
          - deep
          - aggressive
          - stealth
      custom_payloads:
        type: List[str]
        required: false
        default: []
        description: 自訂載荷
      test_config:
        type: FunctionTaskTestConfig
        required: true
        description: 測試配置
  FunctionTaskTarget:
    description: 功能任務目標
    extends: Target
    additional_fields:
      parameter_location:
        type: str
        required: true
        description: 參數位置
        validation:
          enum:
          - url
          - query
          - form
          - json
          - header
          - cookie
      cookies:
        type: Dict[str, str]
        required: false
        default: {}
        description: Cookie資料
      form_data:
        type: Dict[str, Any]
        required: false
        default: {}
        description: 表單資料
      json_data:
        type: Optional[Dict[str, Any]]
        required: false
        description: JSON資料
  FunctionTaskContext:
    description: 功能任務上下文
    fields:
      db_type_hint:
        type: Optional[str]
        required: false
        description: 資料庫類型提示
        validation:
          enum:
          - mysql
          - postgresql
          - mssql
          - oracle
          - sqlite
          - mongodb
      waf_detected:
        type: bool
        required: true
        default: false
        description: 是否檢測到WAF
      related_findings:
        type: List[str]
        required: false
        default: []
        description: 相關發現
  FunctionTaskTestConfig:
    description: 功能任務測試配置
    fields:
      payloads:
        type: List[str]
        required: true
        description: 標準載荷列表
      custom_payloads:
        type: List[str]
        required: false
        default: []
        description: 自訂載荷列表
      blind_xss:
        type: bool
        required: true
        default: false
        description: 是否進行Blind XSS測試
      dom_testing:
        type: bool
        required: true
        default: false
        description: 是否進行DOM測試
      timeout:
        type: Optional[float]
        required: false
        description: 請求逾時(秒)
        validation:
          minimum: 0.1
          maximum: 60.0
  ScanTaskPayload:
    description: 掃描任務載荷 - 用於SCA/SAST等需要項目URL的掃描任務
    fields:
      task_id:
        type: str
        required: true
        description: 任務識別碼
      scan_id:
        type: str
        required: true
        description: 掃描識別碼
      priority:
        type: int
        required: true
        description: 任務優先級
        validation:
          minimum: 0
          maximum: 10
      target:
        type: Target
        required: true
        description: 掃描目標 (包含URL)
      scan_type:
        type: str
        required: true
        description: 掃描類型
        validation:
          enum:
          - sca
          - sast
          - secret
          - license
          - dependency
      repository_info:
        type: Optional[Dict[str, Any]]
        required: false
        description: 代碼倉庫資訊 (分支、commit等)
      timeout:
        type: Optional[int]
        required: false
        description: 掃描逾時(秒)
        validation:
          minimum: 60
          maximum: 3600
findings:
  FindingPayload:
    description: 漏洞發現載荷 - 掃描結果的標準格式
    fields:
      finding_id:
        type: str
        required: true
        description: 發現識別碼
      task_id:
        type: str
        required: true
        description: 任務識別碼
      scan_id:
        type: str
        required: true
        description: 掃描識別碼
      status:
        type: str
        required: true
        description: 發現狀態
        validation:
          enum:
          - new
          - confirmed
          - false_positive
          - fixed
          - ignored
      vulnerability:
        type: Vulnerability
        required: true
        description: 漏洞資訊
      target:
        type: Target
        required: true
        description: 目標資訊
      strategy:
        type: Optional[str]
        required: false
        description: 使用的策略
      evidence:
        type: Optional[FindingEvidence]
        required: false
        description: 證據資料
      impact:
        type: Optional[FindingImpact]
        required: false
        description: 影響評估
      recommendation:
        type: Optional[FindingRecommendation]
        required: false
        description: 修復建議
      metadata:
        type: Dict[str, Any]
        required: false
        default: {}
        description: 中繼資料
      created_at:
        type: datetime
        required: true
        description: 建立時間
      updated_at:
        type: datetime
        required: true
        description: 更新時間
  FindingEvidence:
    description: 漏洞證據
    fields:
      payload:
        type: Optional[str]
        required: false
        description: 攻擊載荷
      response_time_delta:
        type: Optional[float]
        required: false
        description: 響應時間差異
      db_version:
        type: Optional[str]
        required: false
        description: 資料庫版本
      request:
        type: Optional[str]
        required: false
        description: HTTP請求
      response:
        type: Optional[str]
        required: false
        description: HTTP響應
      proof:
        type: Optional[str]
        required: false
        description: 證明資料
  FindingImpact:
    description: 漏洞影響評估
    fields:
      description:
        type: Optional[str]
        required: false
        description: 影響描述
      business_impact:
        type: Optional[str]
        required: false
        description: 業務影響
      technical_impact:
        type: Optional[str]
        required: false
        description: 技術影響
      affected_users:
        type: Optional[int]
        required: false
        description: 受影響用戶數
        validation:
          minimum: 0
      estimated_cost:
        type: Optional[float]
        required: false
        description: 估計成本
        validation:
          minimum: 0.0
  FindingRecommendation:
    description: 漏洞修復建議
    fields:
      fix:
        type: Optional[str]
        required: false
        description: 修復方法
      priority:
        type: Optional[str]
        required: false
        description: 修復優先級
        validation:
          enum:
          - critical
          - high
          - medium
          - low
      remediation_steps:
        type: List[str]
        required: false
        default: []
        description: 修復步驟
      references:
        type: List[str]
        required: false
        default: []
        description: 參考資料
generation_config:
  python:
    target_dir: services/aiva_common/schemas/generated
    base_imports:
    - from __future__ import annotations
    - from typing import Any, Dict, List, Optional
    - from datetime import datetime
    - from pydantic import BaseModel, Field
    field_mapping:
      str: str
      int: int
      float: float
      bool: bool
      datetime: datetime
      Dict[str, Any]: Dict[str, Any]
      Dict[str, str]: Dict[str, str]
      List[str]: List[str]
      Optional[str]: Optional[str]
  go:
    target_dir: services/features/common/go/aiva_common_go/schemas/generated
    base_imports:
    - package schemas
    - import "time"
    field_mapping:
      str: string
      int: int
      float: float64
      bool: bool
      datetime: time.Time
      Any: interface{}
      Dict[str, Any]: map[string]interface{}
      Dict[str, str]: map[string]string
      List[str]: '[]string'
      Optional[str]: '*string'
  rust:
    target_dir: services/scan/info_gatherer_rust/src/schemas/generated
    base_imports:
    - use serde::{Deserialize, Serialize};
    - use std::collections::HashMap;
    - use chrono::{DateTime, Utc};
    field_mapping:
      str: String
      int: i32
      float: f64
      bool: bool
      datetime: DateTime<Utc>
      Dict[str, Any]: HashMap<String, serde_json::Value>
      Dict[str, str]: HashMap<String, String>
      List[str]: Vec<String>
      Optional[str]: Option<String>
enums:
  Severity:
    description: 漏洞嚴重程度枚舉
    values:
      critical: 嚴重漏洞
      high: 高風險漏洞
      medium: 中等風險漏洞
      low: 低風險漏洞
      info: 資訊性發現
  Confidence:
    description: 漏洞信心度枚舉
    values:
      confirmed: 已確認
      firm: 確實
      tentative: 暫定
  FindingStatus:
    description: 發現狀態枚舉
    values:
      new: 新發現
      confirmed: 已確認
      resolved: 已解決
      false_positive: 誤報
