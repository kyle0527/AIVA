"""
AIVA 預設配置值
所有配置的預設值定義在此，環境變數只在需要覆蓋預設值時使用
"""

from pathlib import Path


# ============================================================================
# 資料庫連接池配置 (PostgreSQL)
# ============================================================================
DB_POOL_SIZE = 10
DB_MAX_OVERFLOW = 20
DB_POOL_TIMEOUT = 30
DB_POOL_RECYCLE = 1800  # 30 minutes


# ============================================================================
# 消息隊列配置 (RabbitMQ)
# ============================================================================
RABBITMQ_PORT = 5672
RABBITMQ_VHOST = "/"
MQ_EXCHANGE = "aiva.topic"
MQ_DLX = "aiva.dlx"
MQ_PREFETCH_COUNT = 10


# ============================================================================
# 監控配置
# ============================================================================
ENABLE_PROMETHEUS = True
RATE_LIMIT_RPS = 20  # Requests per second
RATE_LIMIT_BURST = 60  # Burst capacity


# ============================================================================
# 掃描引擎配置
# ============================================================================
SCAN_TIMEOUT = 30.0  # seconds
SCAN_MAX_RETRIES = 3
SCAN_CONCURRENT = 5


# ============================================================================
# AI 引擎配置
# ============================================================================
MODEL_CACHE_SIZE = 1000
BIO_NEURON_INPUT_SIZE = 1024
BIO_NEURON_HIDDEN_SIZE = 2048


# ============================================================================
# 整合模組子路徑配置 (自動推導)
# ============================================================================
# 這些路徑從 AIVA_INTEGRATION_DATA_DIR 推導，不需要單獨設置環境變數

def get_integration_paths(base_dir: str | Path) -> dict:
    """
    根據基礎目錄自動生成整合模組的所有路徑
    
    Args:
        base_dir: 整合模組資料根目錄
        
    Returns:
        包含所有子路徑的字典
    """
    base = Path(base_dir)
    
    return {
        "attack_graph_file": base / "attack_paths" / "attack_graph.pkl",
        "experience_db_url": f"sqlite:///{base / 'experiences' / 'experience.db'}",
        "training_dataset_dir": base / "training_datasets",
        "model_checkpoint_dir": base / "models",
        "raw_data_dir": base / "raw_data",
        "processed_data_dir": base / "processed_data",
    }


# ============================================================================
# CORS 配置
# ============================================================================
CORS_ORIGINS_DEFAULT = [
    "http://localhost:3000",
    "http://localhost:8000",
    "http://127.0.0.1:3000",
    "http://127.0.0.1:8000",
]


# ============================================================================
# 安全配置
# ============================================================================
JWT_ALGORITHM = "HS256"


# ============================================================================
# 日誌配置
# ============================================================================
LOG_FORMAT = "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
LOG_DATE_FORMAT = "%Y-%m-%d %H:%M:%S"


# ============================================================================
# 性能配置
# ============================================================================
REQUEST_TIMEOUT = 30
MAX_CONCURRENT_REQUESTS = 100


# ============================================================================
# 開發模式預設值
# ============================================================================
DEVELOPMENT_DEFAULTS = {
    "DATABASE_URL": "postgresql://postgres:aiva123@localhost:5432/aiva_db",
    "RABBITMQ_URL": "amqp://guest:guest@localhost:5672/",
    "LOG_LEVEL": "INFO",
    "ENVIRONMENT": "development",
}


# ============================================================================
# 生產模式預設值
# ============================================================================
PRODUCTION_DEFAULTS = {
    "LOG_LEVEL": "WARNING",
    "ENVIRONMENT": "production",
    "ENABLE_PROMETHEUS": True,
    "RATE_LIMIT_RPS": 50,  # 生產環境提高限流
}
