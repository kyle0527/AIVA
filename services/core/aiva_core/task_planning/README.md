# ğŸ¯ Task Planning - ä»»å‹™è¦åŠƒèˆ‡åŸ·è¡Œ

**å°èˆª**: [â† è¿”å› AIVA Core](../README.md)

> **ç‰ˆæœ¬**: 3.0.0-alpha  
> **ç‹€æ…‹**: ç”Ÿç”¢å°±ç·’ï¼Œæ¸¬è©¦é€šé  
> **ğŸ§ª æ¸¬è©¦ç‹€æ…‹**: éšæ®µ 5 æ¸¬è©¦ 100% é€šé (3/3 çµ„ä»¶)  
> **è§’è‰²**: AIVA çš„ã€ŒåŸ·è¡Œå¤§è…¦ã€- å°‡ç­–ç•¥è½‰åŒ–ç‚ºä»»å‹™ä¸¦å”èª¿åŸ·è¡Œ  
> **æœ€å¾Œæ›´æ–°**: 2025å¹´11æœˆ16æ—¥

---

## ğŸ“‹ ç›®éŒ„

- [æ¨¡çµ„æ¦‚è¿°](#æ¨¡çµ„æ¦‚è¿°)
- [æ¶æ§‹è¨­è¨ˆ](#æ¶æ§‹è¨­è¨ˆ)
- [æ ¸å¿ƒçµ„ä»¶](#æ ¸å¿ƒçµ„ä»¶)
- [ä½¿ç”¨ç¯„ä¾‹](#ä½¿ç”¨ç¯„ä¾‹)
- [é–‹ç™¼æŒ‡å—](#é–‹ç™¼æŒ‡å—)
- [é–‹ç™¼è¦ç¯„](#é–‹ç™¼è¦ç¯„)

---

## ğŸ¯ æ¨¡çµ„æ¦‚è¿°

**Task Planning** æ˜¯ AIVA å…­å¤§æ¨¡çµ„æ¶æ§‹ä¸­çš„åŸ·è¡Œè¦åŠƒå±¤ï¼Œè² è²¬å°‡æŠ½è±¡çš„æ”»æ“Šç­–ç•¥è½‰åŒ–ç‚ºå…·é«”çš„å¯åŸ·è¡Œä»»å‹™ã€‚æ•´åˆäº† AI æŒ‡æ®ç³»çµ±ã€å‘½ä»¤è·¯ç”±ã€ä»»å‹™ç”Ÿæˆã€åŸ·è¡Œç·¨æ’ã€ç‹€æ…‹ç›£æ§ç­‰æ ¸å¿ƒèƒ½åŠ›ï¼Œç¢ºä¿æ”»æ“Šæµç¨‹é«˜æ•ˆæœ‰åºåœ°åŸ·è¡Œã€‚

### æ ¸å¿ƒè·è²¬
1. **AI æŒ‡æ®** - çµ±ä¸€æŒ‡æ®æ‰€æœ‰ AI çµ„ä»¶çš„å”èª¿ä¸­å¿ƒ
2. **ä»»å‹™ç”Ÿæˆ** - å°‡ç­–ç•¥è½‰æ›ç‚ºå…·é«”çš„åŠŸèƒ½æ¸¬è©¦ä»»å‹™
3. **åŸ·è¡Œç·¨æ’** - AST è§£æã€å·¥å…·é¸æ“‡ã€ä»»å‹™åºåˆ—åŒ–
4. **ä»»å‹™èª¿åº¦** - å„ªå…ˆç´šä½‡åˆ—ã€è² è¼‰å¹³è¡¡ã€ä¸¦è¡ŒåŸ·è¡Œ
5. **ç‹€æ…‹ç›£æ§** - Worker å¿ƒè·³ã€SLA è¿½è¹¤ã€å¥åº·æª¢æŸ¥
6. **å‘½ä»¤è·¯ç”±** - æ™ºèƒ½è·¯ç”±ã€è¤‡é›œåº¦åˆ†æã€åŸ·è¡Œæ¨¡å¼é¸æ“‡

### è¨­è¨ˆç†å¿µ
- **ç­–ç•¥é©…å‹•** - å¾é«˜å±¤ç­–ç•¥åˆ°åº•å±¤ä»»å‹™çš„è‡ªå‹•è½‰æ›
- **AI å¢å¼·** - æ•´åˆå¤šå€‹ AI çµ„ä»¶æ™ºèƒ½æ±ºç­–
- **ç•°æ­¥åŸ·è¡Œ** - æ”¯æ´ä¸¦è¡Œå’Œæµå¼åŸ·è¡Œæ¨¡å¼
- **å¯è§€æ¸¬æ€§** - å…¨ç¨‹è¿½è¹¤ä»»å‹™åŸ·è¡Œç‹€æ…‹

### ğŸ¯ æ ¸å¿ƒè·è²¬

- âœ… **AST è¦åŠƒ**: å°‡ AI æ±ºç­–è½‰æ›ç‚º AST æ”»æ“Šè¨ˆåŠƒ
---

## ğŸ—ï¸ æ¶æ§‹è¨­è¨ˆ

```
task_planning/
â”œâ”€â”€ ğŸ“ planner/                   # è¦åŠƒå™¨ (9 æª”æ¡ˆ) - [ğŸ“– README](./planner/README.md)
â”‚   â”œâ”€â”€ task_generator.py         # âœ… ä»»å‹™ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ orchestrator.py           # âœ… æ”»æ“Šç·¨æ’å™¨
â”‚   â”œâ”€â”€ execution_planner.py      # âœ… åŸ·è¡Œè¨ˆåŠƒå™¨
â”‚   â”œâ”€â”€ ast_parser.py             # âœ… AST æ”»æ“Šæµç¨‹åœ–è§£æ (281è¡Œ)
â”‚   â”œâ”€â”€ task_converter.py         # âœ… ä»»å‹™è½‰æ›å™¨
â”‚   â”œâ”€â”€ tool_selector.py          # âœ… å·¥å…·é¸æ“‡å™¨ (219è¡Œ)
â”‚   â”œâ”€â”€ plan_comparator.py        # âœ… è¨ˆç•«æ¯”è¼ƒå™¨
â”‚   â”œâ”€â”€ strategy_generator.py     # ğŸ”§ ç­–ç•¥ç”Ÿæˆå™¨ï¼ˆèˆŠç‰ˆï¼‰
â”‚   â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ ğŸ“ executor/                  # åŸ·è¡Œå™¨ (6 æª”æ¡ˆ) - [ğŸ“– README](./executor/README.md)
â”‚   â”œâ”€â”€ task_executor.py          # âœ… ä»»å‹™åŸ·è¡Œå™¨ (279è¡Œ)
â”‚   â”œâ”€â”€ task_queue_manager.py    # âœ… ä»»å‹™ä½‡åˆ—ç®¡ç†å™¨
â”‚   â”œâ”€â”€ execution_status_monitor.py  # âœ… åŸ·è¡Œç‹€æ…‹ç›£æ§å™¨
â”‚   â”œâ”€â”€ plan_executor.py          # âœ… è¨ˆç•«åŸ·è¡Œå™¨
â”‚   â”œâ”€â”€ attack_plan_mapper.py     # ğŸ”§ æ”»æ“Šè¨ˆç•«æ˜ å°„å™¨ï¼ˆèˆŠç‰ˆï¼‰
â”‚   â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ ai_commander.py               # âœ… AI æŒ‡æ®ç³»çµ±
â”œâ”€â”€ command_router.py             # âœ… å‘½ä»¤è·¯ç”±å™¨
â””â”€â”€ __init__.py

ç¸½è¨ˆ: 18 å€‹ Python æª”æ¡ˆ
```

### åŸ·è¡Œæµç¨‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Task Planning (ä»»å‹™è¦åŠƒèˆ‡åŸ·è¡Œ)                  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           AI Commander (AI æŒ‡æ®ä¸­å¿ƒ)              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚BioNeuronRAG â”‚  â”‚  RAG Engine â”‚  â”‚ Training â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   Agent     â”‚  â”‚   (çŸ¥è­˜)    â”‚  â”‚  (å­¸ç¿’)  â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       Command Router (å‘½ä»¤è·¯ç”±å™¨)                 â”‚  â”‚
â”‚  â”‚    æ™ºèƒ½è·¯ç”± â€¢ è¤‡é›œåº¦åˆ†æ â€¢ åŸ·è¡Œæ¨¡å¼é¸æ“‡           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â–¼                            â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚         â”‚                                   â”‚          â”‚
â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚  Planner  â”‚                      â”‚ Executor  â”‚   â”‚
â”‚    â”‚  (è¦åŠƒå™¨) â”‚                      â”‚ (åŸ·è¡Œå™¨)  â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                   â”‚          â”‚
â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚ Task Generator    â”‚         â”‚  Task Queue Mgr  â”‚ â”‚
â”‚    â”‚ Orchestrator      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Status Monitor  â”‚ â”‚
â”‚    â”‚ Execution Planner â”‚         â”‚  Task Executor   â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                â”‚                â”‚
     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
     â”‚  Core   â”‚     â”‚  Service  â”‚    â”‚Externalâ”‚
     â”‚Capabilityâ”‚     â”‚ Backbone  â”‚    â”‚Learningâ”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. ğŸ”€ Command Router (å‘½ä»¤è·¯ç”±å™¨)

#### `command_router.py` - æ™ºèƒ½å‘½ä»¤è·¯ç”±ç³»çµ±
**åŠŸèƒ½**: AI vs é AI è‡ªå‹•åˆ¤æ–·å’Œè¤‡é›œåº¦åˆ†æ
```python
from task_planning import CommandRouter, CommandContext

router = CommandRouter()

context = CommandContext(
    command="analyze_vulnerability",
    args={"target": "https://example.com"}
)

# è‡ªå‹•è·¯ç”±
route_info = router.route_command(context)
print(f"éœ€è¦ AI: {route_info['requires_ai']}")
```

### 3. ğŸ“ Planner (è¦åŠƒå™¨)

#### `task_generator.py` - ä»»å‹™ç”Ÿæˆå™¨
```python
from task_planning.planner import TaskGenerator

generator = TaskGenerator()
tasks = generator.from_strategy(attack_plan, scan_payload)
```

#### `orchestrator.py` - æ”»æ“Šç·¨æ’å™¨
```python
from task_planning.planner import AttackOrchestrator

orchestrator = AttackOrchestrator()
execution_plan = orchestrator.create_execution_plan(ast_input)
```

### 4. âš™ï¸ Executor (åŸ·è¡Œå™¨)

#### `task_queue_manager.py` - ä»»å‹™ä½‡åˆ—ç®¡ç†å™¨
```python
from task_planning.executor import TaskQueueManager

queue_manager = TaskQueueManager()
queue_manager.enqueue_task(topic, task_payload)
```

#### `execution_status_monitor.py` - åŸ·è¡Œç‹€æ…‹ç›£æ§å™¨
```python
from task_planning.executor import ExecutionStatusMonitor

monitor = ExecutionStatusMonitor()
monitor.record_task_start(task_id, worker_id)
```

---

## ğŸ“– ä½¿ç”¨ç¯„ä¾‹

### å®Œæ•´çš„ä»»å‹™è¦åŠƒèˆ‡åŸ·è¡Œæµç¨‹
```python
from task_planning import (
    AICommander,
    TaskGenerator,
    TaskQueueManager,
    ExecutionStatusMonitor
)

# åˆå§‹åŒ–çµ„ä»¶
ai_commander = AICommander()
generator = TaskGenerator()
queue_manager = TaskQueueManager()
monitor = ExecutionStatusMonitor()

await ai_commander.initialize()

# AI ç”Ÿæˆæ”»æ“Šç­–ç•¥
strategy = await ai_commander.execute_ai_task(
    task_type=AITaskType.ATTACK_PLANNING,
    context={"target": "https://example.com"}
)

# ç”Ÿæˆä»»å‹™
tasks = generator.from_strategy(strategy["attack_plan"], scan_payload)

# æ·»åŠ åˆ°ä½‡åˆ—
for topic, task in tasks:
    queue_manager.enqueue_task(topic, task)

# ç›£æ§åŸ·è¡Œ
stats = queue_manager.get_scan_statistics("scan_001")
print(f"é€²åº¦: {stats['completed']}/{stats['total']}")
```

---

## ğŸ› ï¸ é–‹ç™¼æŒ‡å—

### ğŸ”¨ aiva_common ä¿®å¾©è¦ç¯„

> **æ ¸å¿ƒåŸå‰‡**: æœ¬æ¨¡çµ„å¿…é ˆåš´æ ¼éµå¾ª [`services/aiva_common`](../../../aiva_common/README.md#-é–‹ç™¼æŒ‡å—) çš„ä¿®å¾©è¦ç¯„ã€‚

**å®Œæ•´è¦ç¯„**: [aiva_common é–‹ç™¼æŒ‡å—](../../../aiva_common/README.md#-é–‹ç™¼æŒ‡å—)

#### é—œéµåŸå‰‡

```python
# âœ… æ­£ç¢ºï¼šä½¿ç”¨ aiva_common æ¨™æº–
from aiva_common import TaskStatus, Severity, Confidence

# âŒ ç¦æ­¢ï¼šé‡è¤‡å®šç¾©
class TaskStatus(str, Enum): pass  # éŒ¯èª¤ï¼

# âœ… åˆç†çš„æ¨¡çµ„å°ˆå±¬æšèˆ‰ï¼ˆtask_converter.py ç¯„ä¾‹ï¼‰
class TaskPriority(str, Enum):
    """ä»»å‹™å„ªå…ˆç´š (AI è¦åŠƒå™¨å°ˆç”¨)"""
    LOW = "low"
    NORMAL = "normal"
    HIGH = "high"
    CRITICAL = "critical"
```

**åˆ¤æ–·æ¨™æº–**:
- âœ… æ¨¡çµ„å…§éƒ¨å°ˆç”¨ â†’ å¯è‡ªå®šç¾©
- âŒ é€šç”¨æ¦‚å¿µï¼ˆç‹€æ…‹ã€åš´é‡åº¦ï¼‰ â†’ å¿…é ˆç”¨ aiva_common

ğŸ“– **è©³ç´°èªªæ˜**: [ä¿®å¾©è¦ç¯„å®Œæ•´ç‰ˆ](../../../aiva_common/README.md#-é–‹ç™¼è¦ç¯„èˆ‡æœ€ä½³å¯¦è¸)

---

### æ·»åŠ æ–°çš„ä»»å‹™é¡å‹
```python
# åœ¨ TaskGenerator æ·»åŠ ç”Ÿæˆé‚è¼¯
class TaskGenerator:
    def from_strategy(self, plan, payload):
        tasks = []
        for index, x in enumerate(plan.get("custom", [])):
            tasks.append((
                Topic.TASK_FUNCTION_CUSTOM,
                FunctionTaskPayload(...)
            ))
        return tasks
```

### å¯¦ç¾è‡ªå®šç¾©å‘½ä»¤è™•ç†å™¨
```python
class CustomHandler(CommandHandler):
    async def handle(self, context):
        result = await self._process(context)
        return ExecutionResult(success=True, result=result)

router.register_handler("custom", CustomHandler())
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ¨™

- **ä»»å‹™ç”Ÿæˆé€Ÿåº¦**: 1000+ ä»»å‹™/ç§’
- **ä½‡åˆ—å®¹é‡**: 100,000+ ä»»å‹™
- **èª¿åº¦å»¶é²**: < 1ms
- **ä¸¦ç™¼ Worker**: 100+
- **AI éŸ¿æ‡‰æ™‚é–“**: 1-5 ç§’

---

## ğŸ”— ç›¸é—œæ¨¡çµ„

- **cognitive_core** - æä¾› BioNeuronRAG å’Œ RAG Engine
- **external_learning** - æä¾› Training Orchestrator
- **core_capabilities** - æ¥æ”¶ä¸¦åŸ·è¡Œç”Ÿæˆçš„ä»»å‹™
- **service_backbone** - æä¾›æ¶ˆæ¯ä»£ç†å’Œç‹€æ…‹ç®¡ç†

---

**æœ€å¾Œæ›´æ–°**: 2025-11-15  
**ç¶­è­·è€…**: AIVA Development Team  
**æˆæ¬Š**: MIT License
