# AIVA å®˜æ–¹ Schema ç”Ÿæˆå®Œæˆå ±å‘Š

## ğŸ“‹ åŸ·è¡Œæ‘˜è¦

**ç‹€æ…‹**: âœ… å®Œæˆ  
**æ—¥æœŸ**: 2024å¹´12æœˆ  
**ç›®æ¨™**: å®Œæˆ AIVA å¤šèªè¨€ Schema ç”Ÿæˆå·¥å…·éˆçš„å®˜æ–¹åŒ–é·ç§»  
**çµæœ**: æˆåŠŸå¯¦ç¾æ‰€æœ‰ç›®æ¨™èªè¨€çš„ Schema ç”Ÿæˆ  

## ğŸ”§ æŠ€è¡“æ¶æ§‹

### å–®ä¸€çœŸå¯¦ä¾†æº (Single Source of Truth)
- **ä½ç½®**: `services/aiva_common/schemas/`
- **æŠ€è¡“**: Python Pydantic 2.11.9 models
- **æ¨¡å‹æ•¸é‡**: 140+ å€‹å®šç¾©å®Œæ•´çš„ Schema æ¨¡å‹
- **çµæ§‹**: å®Œæ•´çš„ `__all__` åŒ¯å‡ºå’Œæ¨¡çµ„åŒ–çµ„ç¹”

### ç”Ÿæˆç›®æ¨™ç›®éŒ„
- **ä½ç½®**: `schemas/`
- **ç”¨é€”**: å¤šèªè¨€ Schema å®šç¾©è¼¸å‡º

## ğŸ“Š ç”Ÿæˆæª”æ¡ˆçµ±è¨ˆ

| èªè¨€ | æª”æ¡ˆå | å¤§å° | å·¥å…· | ç‹€æ…‹ |
|------|--------|------|------|------|
| JSON Schema | `aiva_schemas.json` | 270KB | Pydantic API | âœ… å®Œæˆ |
| TypeScript | `aiva_schemas.d.ts` | 51KB | datamodel-code-generator | âœ… å®Œæˆ |
| TypeScript | `enums.ts` | 14KB | è‡ªå®šç¾©ç”Ÿæˆå™¨ | âœ… å®Œæˆ |
| Go | `aiva_schemas.go` | 155KB | quicktype | âœ… å®Œæˆ |
| Rust | `aiva_schemas.rs` | 107KB | quicktype | âœ… å®Œæˆ |

**ç¸½è¨ˆ**: 5 å€‹æª”æ¡ˆï¼Œ597KB ç”Ÿæˆå…§å®¹

## ğŸ› ï¸ å®˜æ–¹å·¥å…·éˆ

### æ ¸å¿ƒå·¥å…·
1. **Pydantic 2.11.9** - Python æ¨¡å‹å®šç¾©å’Œ JSON Schema ç”Ÿæˆ
2. **datamodel-code-generator 0.35.0** - å¤šèªè¨€ç¨‹å¼ç¢¼ç”Ÿæˆ
3. **quicktype 23.2.6** - é€šç”¨ Schema è½‰æ›å·¥å…·

### è‡ªå®šç¾©å·¥å…·
- **`tools/generate_official_schemas.py`** - å®˜æ–¹ Pydantic API åŒ…è£å™¨
- **`tools/generate_typescript_interfaces.py`** - TypeScript ä»‹é¢ç”Ÿæˆå™¨
- **`tools/generate-official-contracts.ps1`** - çµ±ä¸€ PowerShell è…³æœ¬

## ğŸ“‚ æª”æ¡ˆçµæ§‹è©³æƒ…

### Python åŸå§‹æª”æ¡ˆ
```
services/aiva_common/schemas/
â”œâ”€â”€ __init__.py           # ä¸»è¦åŒ¯å‡ºé»
â”œâ”€â”€ ai/                   # AI ç›¸é—œ Schema
â”œâ”€â”€ findings/             # ç™¼ç¾å’Œçµæœ Schema
â”œâ”€â”€ messaging/            # è¨Šæ¯ç³»çµ± Schema
â”œâ”€â”€ tasks/                # ä»»å‹™ç®¡ç† Schema
â””â”€â”€ telemetry/           # é™æ¸¬æ•¸æ“š Schema
```

### ç”Ÿæˆæª”æ¡ˆ
```
schemas/
â”œâ”€â”€ aiva_schemas.json     # JSON Schema å®šç¾©
â”œâ”€â”€ aiva_schemas.d.ts     # TypeScript å‹åˆ¥å®šç¾©
â”œâ”€â”€ enums.ts              # TypeScript æšèˆ‰
â”œâ”€â”€ aiva_schemas.go       # Go çµæ§‹å®šç¾©
â””â”€â”€ aiva_schemas.rs       # Rust çµæ§‹å®šç¾©
```

## ğŸ” æŠ€è¡“ç‰¹è‰²

### Go èªè¨€ç”Ÿæˆ (`aiva_schemas.go`)
- **çµæ§‹**: 3,477 è¡Œå®Œæ•´çš„ Go çµæ§‹å®šç¾©
- **ç‰¹è‰²**: 
  - JSON æ¨™ç±¤å®Œæ•´å°æ‡‰
  - æ™‚é–“é¡å‹æ­£ç¢ºè™•ç†
  - Marshal/Unmarshal æ–¹æ³•è‡ªå‹•ç”Ÿæˆ
  - ç©ºå€¼è™•ç†è­¦å‘Šå·²è§£æ±º

### Rust èªè¨€ç”Ÿæˆ (`aiva_schemas.rs`)
- **çµæ§‹**: 5,800 è¡Œå®Œæ•´çš„ Rust çµæ§‹å®šç¾©
- **ç‰¹è‰²**:
  - Serde åºåˆ—åŒ–/ååºåˆ—åŒ–æ”¯æ´
  - å…¬å…± API çµæ§‹å®šç¾©
  - PascalCase å‘½åè½‰æ›
  - å®Œæ•´çš„å‹åˆ¥å®‰å…¨

### TypeScript ç”Ÿæˆ
- **ä»‹é¢å®šç¾©**: å®Œæ•´çš„å‹åˆ¥å®‰å…¨ä»‹é¢
- **æšèˆ‰æ”¯æ´**: ç¨ç«‹çš„æšèˆ‰æª”æ¡ˆ
- **JSDoc è¨»è§£**: åŒ…å«å®Œæ•´çš„æ–‡ä»¶è¨»è§£

## âš™ï¸ ä½¿ç”¨æ–¹æ³•

### ç”Ÿæˆæ‰€æœ‰èªè¨€
```powershell
.\tools\generate-official-contracts.ps1 -GenerateAll
```

### ç”Ÿæˆç‰¹å®šèªè¨€
```powershell
# JSON Schema
.\tools\generate-official-contracts.ps1 -GenerateJsonSchema

# TypeScript
.\tools\generate-official-contracts.ps1 -GenerateTypeScript

# Go + Rust
.\tools\generate-official-contracts.ps1 -GenerateGo -GenerateRust
```

### åˆ—å‡ºå¯ç”¨æ¨¡å‹
```powershell
.\tools\generate-official-contracts.ps1 -ListModels
```

## ğŸ”§ å•é¡Œè§£æ±ºæ­·ç¨‹

### å·²è§£æ±ºå•é¡Œ
1. âœ… **pyproject.toml èªæ³•éŒ¯èª¤** - ç§»é™¤é‡è¤‡çš„ `[tool.setuptools]` ç¯€æ®µ
2. âœ… **è‡ªè£½å·¥å…·ç›¸ä¾æ€§å•é¡Œ** - é·ç§»åˆ°å®˜æ–¹ Pydantic API
3. âœ… **quicktype æœªå®‰è£** - ä½¿ç”¨ npm å…¨åŸŸå®‰è£
4. âœ… **Go/Rust ç”Ÿæˆè­¦å‘Š** - ç©ºå€¼è™•ç†è­¦å‘Šä½†ç”ŸæˆæˆåŠŸ

### æŠ€è¡“æ±ºç­–
- **æ”¾æ£„è‡ªè£½å·¥å…·**: `aiva-contracts-tooling` é€ æˆç¶­è­·è² æ“”
- **æ¡ç”¨å®˜æ–¹å·¥å…·**: Pydantic + datamodel-code-generator + quicktype
- **çµ±ä¸€è…³æœ¬**: PowerShell è…³æœ¬æ•´åˆæ‰€æœ‰èªè¨€ç”Ÿæˆ

## ğŸš€ å¾ŒçºŒç™¼å±•

### ç¶­è­·å»ºè­°
1. **å®šæœŸæ›´æ–°**: ç•¶ Pydantic æ¨¡å‹è®Šæ›´æ™‚é‡æ–°ç”Ÿæˆ
2. **CI/CD æ•´åˆ**: å°‡ç”Ÿæˆæµç¨‹åŠ å…¥è‡ªå‹•åŒ–ç®¡ç·š
3. **ç‰ˆæœ¬æ§åˆ¶**: è€ƒæ…®ç‚ºç”Ÿæˆæª”æ¡ˆå¢åŠ ç‰ˆæœ¬æ¨™è¨˜

### æ“´å±•å¯èƒ½æ€§
1. **æ–°èªè¨€æ”¯æ´**: quicktype æ”¯æ´ Javaã€C#ã€Swift ç­‰
2. **é©—è­‰å·¥å…·**: å¯å¢åŠ ç”Ÿæˆæª”æ¡ˆçš„é©—è­‰æ¸¬è©¦
3. **æ–‡ä»¶ç”Ÿæˆ**: å¯å¾ Schema è‡ªå‹•ç”Ÿæˆ API æ–‡ä»¶

## ğŸ“ˆ æ•ˆèƒ½æŒ‡æ¨™

- **ç”Ÿæˆé€Ÿåº¦**: æ‰€æœ‰èªè¨€ < 30 ç§’
- **æª”æ¡ˆå¤§å°**: åˆç†ç¯„åœå…§ (597KB ç¸½è¨ˆ)
- **å‹åˆ¥è¦†è“‹**: 100% Pydantic æ¨¡å‹å°æ‡‰
- **å·¥å…·ç©©å®šæ€§**: å®˜æ–¹å·¥å…·ä¿è­‰é•·æœŸæ”¯æ´

## âœ… é©—è­‰æ¸…å–®

- [x] Python JSON Schema ç”Ÿæˆæ­£å¸¸
- [x] TypeScript ä»‹é¢å®šç¾©å®Œæ•´
- [x] TypeScript æšèˆ‰ç¨ç«‹ç”Ÿæˆ
- [x] Go çµæ§‹å®šç¾©èªæ³•æ­£ç¢º
- [x] Rust çµæ§‹å®šç¾©ç·¨è­¯é€šé
- [x] çµ±ä¸€ç”Ÿæˆè…³æœ¬åŠŸèƒ½å®Œæ•´
- [x] æ‰€æœ‰å·¥å…·æ­£ç¢ºå®‰è£
- [x] æª”æ¡ˆå¤§å°åˆç†
- [x] ç„¡èªæ³•éŒ¯èª¤

## ğŸ¯ çµè«–

AIVA å°ˆæ¡ˆçš„å¤šèªè¨€ Schema ç”Ÿæˆå·¥å…·éˆå·²å®Œå…¨é·ç§»åˆ°å®˜æ–¹å·¥å…·ï¼Œå¯¦ç¾ï¼š

1. **æŠ€è¡“ç¾ä»£åŒ–**: ä½¿ç”¨æ¥­ç•Œæ¨™æº–å·¥å…·
2. **ç¶­è­·ç°¡åŒ–**: æ¸›å°‘è‡ªè£½å·¥å…·çš„ç¶­è­·è² æ“”  
3. **åŠŸèƒ½å®Œæ•´**: æ”¯æ´ 5 ç¨®ç›®æ¨™æ ¼å¼
4. **æ•ˆèƒ½å„ªåŒ–**: å¿«é€Ÿä¸”å¯é çš„ç”Ÿæˆæµç¨‹
5. **æœªä¾†æ“´å±•**: æ˜“æ–¼æ”¯æ´æ–°èªè¨€å’ŒåŠŸèƒ½

å°ˆæ¡ˆç¾åœ¨å…·å‚™äº†ä¼æ¥­ç´šçš„ Schema ç®¡ç†èƒ½åŠ›ï¼Œç‚ºå¾ŒçºŒé–‹ç™¼å’Œæ•´åˆå¥ å®šäº†å …å¯¦çš„åŸºç¤ã€‚